<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>GizmoBox.io</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
/* Custom configuration to ensure full height and Inter font */
body {
Â  font-family: 'Inter', sans-serif;
Â  height: 100vh;
Â  margin: 0;
Â  display: flex;
Â  flex-direction: column;
}

/* Chrome, Safari, Edge - Custom scrollbar track */
#toolFrame::-webkit-scrollbar-track,
.sidebar::-webkit-scrollbar-track {
Â  Â  background: #f3f4f6; /* Tailwind gray-100 */
Â  Â  border-radius: 10px;
}

/* Chrome, Safari, Edge - Custom scrollbar thumb */
#toolFrame::-webkit-scrollbar-thumb,
.sidebar::-webkit-scrollbar-thumb {
Â  Â  background-color: #92A3AB;Â 
Â  Â  border-radius: 10px;
Â  Â  border: 3px solid #f3f4f6; /* Add a thin border the same color as the track for separation */
}

/* Remove scrollbar buttons for Chrome, Safari, and Edge */
.sidebar::-webkit-scrollbar-button,
#toolFrame::-webkit-scrollbar-button {
Â  Â  display: none;
Â  Â  height: 0;
Â  Â  width: 0;
}

#toolFrame, .sidebar {
Â  Â  scrollbar-width: thin; /* Firefox property for thin scrollbar */
Â  Â  scrollbar-color: #92A3AB #fff;
}

/* Sidebar Specific Styles */
.sidebar {
Â  width: 270px;Â 
Â  transition: transform 0.3s ease, width 0.3s ease;
}

.sidebar.collapsed {
Â  width: 60px;
}

/* Base link styling */
.nav-link {
Â  transition: all 0.2s ease;
Â  font-weight: 500;
Â  white-space: nowrap;
}

/* Define a custom shadow for the active border */
.active-shadow {
Â  box-shadow: inset 3px 0 0 #4f46e5; /* Indigo 600 for the active indicator line */
}

/* Ensure the collapsed sidebar only shows the icon */
.sidebar.collapsed .tool-label {
Â  display: none;
}
.sidebar.collapsed .favorite {
Â  display: none;
}

/* Mobile specific styling for the fixed sidebar */
@media (max-width: 767px) {
Â  .sidebar {
Â  Â  transform: translateX(-100%);
Â  Â  position: fixed;
Â  Â  top: 0;
Â  Â  bottom: 0;
Â  Â  z-index: 50;Â 
Â  Â  width: 80vw;Â 
Â  Â  max-width: 300px;
Â  Â  box-shadow: 4px 0 10px rgba(0,0,0,.3);
Â  }
Â  .sidebar.open {
Â  Â  transform: translateX(0);
Â  }
Â  #mobileToggleBtn {
Â  Â  display: flex;
Â  }
Â  #desktopToggleBtn {
Â  Â  display: none;
Â  }
}

/* Hide mobile toggle on desktop */
@media (min-width: 768px) {
Â  #mobileToggleBtn {
Â  Â  display: none !important;
Â  }
Â  #desktopToggleBtn {
Â  Â  display: flex;
Â  }
}

/* Style for the collapsible header button */
.nav-header{
Â  /*border-top: 1px dotted #CBCCDC;*/
}
.nav-header-button {
Â  Â  display: flex;
Â  Â  justify-content: space-between;
Â  Â  align-items: center;
Â  Â  width: 100%;
Â  Â  padding: 0;
Â  Â  border: none;
Â  Â  background: none;
Â  Â  text-align: left;
Â  Â  color: #6b7280; /* text-gray-500 */
Â  Â  cursor: pointer;
Â  Â  font-size: 0.75rem; /* text-xs */
Â  Â  font-weight: 600; /* font-semibold */
Â  Â  text-transform: uppercase;
}

/* Added style for the static Pinned/Favorites header */
.pinned-header {
Â  Â  padding: 8px 12px; /* px-3 py-2 */
Â  Â  margin-top: 8px; /* mt-2 */
Â  Â  color: #6b7280;
Â  Â  font-size: 0.75rem;
Â  Â  font-weight: 600;
Â  Â  text-transform: uppercase;
Â  Â  /* Ensure it has the same vertical padding as the nav-item headers */
}

</style>
</head>
<body class="bg-gray-100">

<header class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white p-1 shadow-xl flex justify-between items-center">
<h3 class="text-xl font-bold flex items-center">
Â  <svg width="41px" height="41px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#bac2ca" stroke="#bac2ca" stroke-width="0.00024000000000000003" class="mr-2">
Â  Â  <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.288"></g><g id="SVGRepo_iconCarrier"> <title>webhook</title> <rect width="24" height="24" fill="none"></rect> <path d="M10.46,19a4.59,4.59,0,0,1-6.37,1.15,4.63,4.63,0,0,1,2.49-8.38l0,1.43a3.17,3.17,0,0,0-2.36,1.36A3.13,3.13,0,0,0,5,18.91a3.11,3.11,0,0,0,4.31-.84,3.33,3.33,0,0,0,.56-1.44v-1l5.58,0,.07-.11a1.88,1.88,0,1,1,.67,2.59,1.77,1.77,0,0,1-.83-1l-4.07,0A5,5,0,0,1,10.46,19m7.28-7.14a4.55,4.55,0,1,1-1.12,9,4.63,4.63,0,0,1-3.43-2.21L14.43,18a3.22,3.22,0,0,0,2.32,1.45,3.05,3.05,0,1,0,.75-6.06,3.39,3.39,0,0,0-1.53.18l-.85.44L12.54,9.2h-.22a1.88,1.88,0,1,1,.13-3.76A1.93,1.93,0,0,1,14.3,7.39a1.88,1.88,0,0,1-.46,1.15l1.9,3.51a4.75,4.75,0,0,1,2-.19M8.25,9.14A4.54,4.54,0,1,1,16.62,5.6a4.61,4.61,0,0,1-.2,4.07L15.18,9a3.17,3.17,0,0,0,.09-2.73A3.05,3.05,0,1,0,9.65,8.6,3.21,3.21,0,0,0,11,10.11l.39.21-3.07,5a1.09,1.09,0,0,1,.1.19,1.88,1.88,0,1,1-2.56-.83,1.77,1.77,0,0,1,1.23-.17l2.31-3.77A4.41,4.41,0,0,1,8.25,9.14Z"></path>
Â  Â  </g>
Â  </svg>
Â  GizmoBox.io
</h3>
Â  <button id="mobileToggleBtn" class="p-1 rounded-md text-white hover:bg-white hover:text-indigo-600 transition-colors duration-200">
Â  Â  <i class="bi bi-list text-2xl"></i>
Â  </button>
</header>

<div class="flex-1 flex overflow-hidden">
Â Â 
Â  <nav class="sidebar flex flex-col bg-white border-r border-gray-200 overflow-y-auto" id="sidebar">
Â  Â Â 
Â  Â  <div class="hidden md:flex justify-end p-2 border-b border-gray-200 cursor-pointer sticky top-0 bg-white z-10" id="desktopToggleBtn">
Â  Â  Â  <i class="bi bi-chevron-left text-xl text-gray-600 hover:text-indigo-600 transition"></i>
Â  Â  </div>

Â  Â  <div class="pinned-header nav-header">
Â  Â  Â  Â  <span class="tool-label">Favorites</span>
Â  Â  </div>
Â  Â Â 
Â  Â  <ul class="flex flex-col border-b border-gray-200" id="pinnedTabs"></ul>
Â  Â Â 
Â  Â  <div class="h-2 bg-gray-50 border-y border-gray-200"></div>

Â  Â  <ul class="flex flex-col flex-1" id="toolTabs"></ul>
Â  Â Â 
Â  </nav>

Â  <div class="content flex-1 px-2 py-0 md:px-4 flex flex-col overflow-hidden" id="mainContent">
Â  Â  <iframe id="toolFrame" src="about:blank" class="w-full flex-grow border-none rounded-xl shadow-2xl bg-white"></iframe>
Â  Â  <footer class="text-right text-xs text-gray-500 py-2">
Â  Â  Â  Â  <a target="_blank" href="https://www.google.com" class="text-gray-500 hover:text-indigo-600 transition-colors duration-200">ğŸŒ Sandbox Browser</a>
Â  Â  Â  Â  <span class="mx-2 text-gray-400">|</span>
Â  Â  Â  Â  <span id="copyright-year">&copy; GizmoBox.io</span>
Â  Â  </footer>
Â  </div>
</div>

<script>
let allEntries = [];
let pinnedFiles = JSON.parse(localStorage.getItem("pinnedTools") || "[]");
let isDesktopCollapsed = false;
// New: Storage for collapsed headers
let collapsedGroups = JSON.parse(localStorage.getItem("collapsedGroups") || "[]");

// --- CSS Class Definitions ---
const UNPINNED_BASE = 'text-gray-700 hover:bg-gray-100';
const PINNED_BASE = 'bg-indigo-50 text-indigo-800 hover:bg-indigo-100';

const ACTIVE_UNPINNED = 'bg-gray-200 active-shadow';
const ACTIVE_PINNED = 'bg-indigo-100 active-shadow';

const STAR_ON = 'text-yellow-400 hover:text-yellow-500';
const STAR_OFF = 'text-gray-300 hover:text-yellow-400';

// The fallback content from the user's provided list
const mockIni = `
[Top Items]
csv_writer.html
color_picker.html
text_analyzer.html

[Small Systems]
party_planner.html
check_list.html
sticky_notes.html

[Main Tool Items]
Ping Tool v1,ping_tool.html,2
net_details.html
device_specs.html
user_info.html
keyboard_tester.html
mic_tester.html
website_security_checker.html

[AI Utilities]
text_to_speech.html
text_to_image.html,1
Analyzer,image_analyzer.html
Image to Text,image_to_text.html,2

[Web & Dev Utilities]
xml_editor.html
regex_tester.html
JSON Viewer/Editor,json_editor.html
Base64 Encoder/Decoder,base64_tool.html
jwt_decoder.html

[Productivity & Utilities]
Unit Conversion Calculator,converter.html,51
World Clock,time_tools.html,52
Clipboard Manager,clipboard_manager.html,53
Password Generator,password_generator.html,54

[Fun / Miscellaneous]
Name Generator,name_generator.html,61
image_coordinate_tracker.html
`; // UPDATED: Added headers and new entries

// The content of games.ini provided by the user
const gamesIni = `
Ouija Board,ouija_board.html
koopa_dodge.html
the_end3.html
blank_world.html
`;


// --- API Mock/Fetch ---

// Modified to load both pages.ini (or mockIni) AND games.ini
function loadPagesIni() {
Â  const deferred = $.Deferred();
Â  let iniContent = "";

Â  // 1. Attempt AJAX call to load the external pages.ini
Â  const pagesIniPromise = $.ajax({Â 
Â  Â  url: "pages.ini",Â 
Â  Â  method: "GET",Â 
Â  Â  dataType: "text"Â 
Â  })
Â  .done(function(data) {
Â  Â  console.log("pages.ini loaded successfully from external file.");
Â  Â  return data;
Â  })
Â  .fail(function(jqXHR, textStatus, errorThrown) {
Â  Â  console.warn(`pages.ini failed to load (${textStatus}: ${errorThrown}). Falling back to mock data.`);
Â  Â  return mockIni;
Â  });
Â Â 
Â  // 2. Attempt AJAX call to load the external games.ini
Â  const gamesIniPromise = $.ajax({Â 
Â  Â  url: "games.ini",Â 
Â  Â  method: "GET",Â 
Â  Â  dataType: "text"Â 
Â  })
Â  .done(function(data) {
Â  Â  console.log("games.ini loaded successfully from external file.");
Â  Â  return data;
Â  })
Â  .fail(function(jqXHR, textStatus, errorThrown) {
Â  Â  console.warn(`games.ini failed to load (${textStatus}: ${errorThrown}). Falling back to user-provided data.`);
Â  Â  return gamesIni;
Â  });

Â  // 3. Combine results
Â  $.when(pagesIniPromise.promise(), gamesIniPromise.promise())
Â  Â  .done(function(pagesData, gamesData) {
Â  Â  Â  Â  // pagesData[0] is the content of pages.ini or mockIni (from the first promise)
Â  Â  Â  Â  // gamesData[0] is the content of games.ini or gamesIni (from the second promise)

Â  Â  Â  Â  // Combine the content with a new [Games] header
Â  Â  Â  Â  const combinedContent = pagesData[0] + "\n\n[Games]\n" + gamesData[0];
Â  Â  Â  Â  deferred.resolve(combinedContent);
Â  Â  })
Â  Â  .fail(function(pagesFailure, gamesFailure) {
Â  Â  Â  Â  // Should not happen if .fail returns the fallback data, but as a safeguard:
Â  Â  Â  Â  console.error("Error combining INI files.");
Â  Â  Â  Â  deferred.resolve(mockIni + "\n\n[Games]\n" + gamesIni);
Â  Â  });
Â Â 
Â  return deferred.promise();
}

// --- Utility Functions ---

function prettifyTitle(str) {
Â  // Only prettify if it looks like a filename, otherwise return as-is
Â  if (str.toLowerCase().includes('.html')) {
Â  Â  Â  str = str.replace(/\.html$/i, "");
Â  Â  Â  str = str.replace(/[_\-]+/g, " ");
Â  Â  Â  str = str.replace(/\w\S*/g, w => w.charAt(0).toUpperCase() + w.substr(1).toLowerCase());
Â  }
Â  return str;
}

function getToolIcon(file) {
Â  file = file.toLowerCase();
Â  // New icon for Games section
Â  if (file.includes("board") || file.includes("koopa") || file.includes("end3") || file.includes("world")) return "bi-controller";
Â  Â Â 
Â  if(file.includes("csv") || file.includes("writer")) return "bi-file-spreadsheet";
Â  if(file.includes("color")) return "bi-palette";
Â  if(file.includes("keyboard")) return "bi-keyboard";
Â  if(file.includes("tts") || file.includes("speech")) return "bi-volume-up";
Â  if(file.includes("net") || file.includes("device") || file.includes("ping")) return "bi-wifi";
Â  if(file.includes("image") || file.includes("convert") || file.includes("tracker")) return "bi-image";
Â  if(file.includes("xml") || file.includes("text") || file.includes("analyzer")) return "bi-file-text";
Â  if(file.includes("security")) return "bi-shield-lock";
Â  if(file.includes("notes") || file.includes("sticky")) return "bi-stickies";
Â  if(file.includes("task") || file.includes("check")) return "bi-list-task";
Â  if(file.includes("converter") || file.includes("unit")) return "bi-calculator";
Â  if(file.includes("world") || file.includes("time")) return "bi-clock";
Â  if(file.includes("clipboard")) return "bi-clipboard-check";
Â  if(file.includes("password") || file.includes("generator")) return "bi-key";
Â  if(file.includes("json")) return "bi-braces";
Â  if(file.includes("base64")) return "bi-hash";
Â  if(file.includes("jwt")) return "bi-shield-check";
Â  if(file.includes("regex")) return "bi-terminal";
Â  return "bi-app-indicator";
}

function savePinnedFiles(){ localStorage.setItem("pinnedTools", JSON.stringify(pinnedFiles)); }
// New: Function to save the collapsed state
function saveCollapsedGroups(){ localStorage.setItem("collapsedGroups", JSON.stringify(collapsedGroups)); }

function setCopyrightYear() {
Â  Â  const currentYear = new Date().getFullYear();
Â  Â  const copyrightElement = document.getElementById('copyright-year');
Â  Â  if (copyrightElement) {
Â  Â  Â  Â  // Prepend the current year to the existing text (e.g., "Â© 2025 GizmoBox.io")
Â  Â  Â  Â  const originalText = copyrightElement.textContent;
Â  Â  Â  Â  copyrightElement.textContent = `Â© ${currentYear} ${originalText.replace('Â©', '').trim()}`;
Â  Â  }
}

// --- Main Logic ---

$(function(){
Â  const $sidebar = $("#sidebar");
Â  const $desktopToggleBtn = $("#desktopToggleBtn");
Â  const $mobileToggleBtn = $("#mobileToggleBtn");
Â  const $pinnedTabs = $("#pinnedTabs");
Â  const $tabs = $("#toolTabs");
Â  const $frame = $("#toolFrame");

Â  // --- Sidebar Toggle Handlers ---
Â Â 
Â  $desktopToggleBtn.on("click", function(){
Â  Â  $sidebar.toggleClass("collapsed");
Â  Â  isDesktopCollapsed = $sidebar.hasClass("collapsed");
Â  Â  const icon = isDesktopCollapsed ? "bi-chevron-right" : "bi-chevron-left";
Â  Â  $(this).find("i").attr("class", "bi " + icon);
Â  });
Â Â 
Â  $mobileToggleBtn.on("click", function(){
Â  Â  $sidebar.toggleClass("open");
Â  });

Â  $(document).on("click", ".nav-link", function(){
Â  Â  if (window.innerWidth < 768) {
Â  Â  Â  Â  $sidebar.removeClass("open");
Â  Â  }
Â  });
Â Â 
Â  // --- Header Collapse Handler ---
Â  $(document).on("click", ".nav-header-button", function(){
Â  Â  Â  const $button = $(this);
Â  Â  Â  const groupTitle = $button.data('group-title');
Â  Â  Â  const $icon = $button.find('i');
Â  Â  Â Â 
Â  Â  Â  // Get all subsequent tool items until the next header (nav-item containing a header) or the end of the list
Â  Â  Â  const $itemsToToggle = $button.closest('li.nav-item').nextUntil('li.nav-item.nav-header');
Â  Â  Â Â 
Â  Â  Â  $itemsToToggle.slideToggle(150, function() {
Â  Â  Â  Â  Â  // Toggle icon and update state after animation completes
Â  Â  Â  Â  Â  const isHidden = $itemsToToggle.is(':hidden');
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (isHidden) {
Â  Â  Â  Â  Â  Â  Â  $icon.removeClass('bi-chevron-down').addClass('bi-chevron-right');
Â  Â  Â  Â  Â  Â  Â  // Add to collapsedGroups if not already present
Â  Â  Â  Â  Â  Â  Â  if (!collapsedGroups.includes(groupTitle)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  collapsedGroups.push(groupTitle);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  $icon.removeClass('bi-chevron-right').addClass('bi-chevron-down');
Â  Â  Â  Â  Â  Â  Â  // Remove from collapsedGroups
Â  Â  Â  Â  Â  Â  Â  collapsedGroups = collapsedGroups.filter(t => t !== groupTitle);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  saveCollapsedGroups();
Â  Â  Â  });
Â  });

Â  // --- Initial Data Load ---
Â Â 
Â  loadPagesIni().done(function(data){
Â  Â  let lines = data.split(/\r?\n/).map(l => l.trim()).filter(l => l && !l.startsWith(";"));
Â  Â  let currentGroupIndex = 0;
Â  Â  let entries = [];

Â  Â  // 1. Parse INI File Content
Â  Â  lines.forEach(line => {
Â  Â  Â  Â  if (line.startsWith("[") && line.endsWith("]")) {
Â  Â  Â  Â  Â  Â  // It's a header/group
Â  Â  Â  Â  Â  Â  const title = line.substring(1, line.length - 1).trim();
Â  Â  Â  Â  Â  Â  // New: Check if the group is collapsed
Â  Â  Â  Â  Â  Â  const isCollapsed = collapsedGroups.includes(title);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  entries.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  type: 'header',Â 
Â  Â  Â  Â  Â  Â  Â  Â  title: title,Â 
Â  Â  Â  Â  Â  Â  Â  Â  groupIndex: currentGroupIndex++,
Â  Â  Â  Â  Â  Â  Â  Â  isCollapsed: isCollapsedÂ 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else if (!line.startsWith(";")) {
Â  Â  Â  Â  Â  Â  // It's a tool entry
Â  Â  Â  Â  Â  Â  let parts = line.split(",").map(s => s.trim()).filter(s => s.length > 0);
Â  Â  Â  Â  Â  Â  let file = "", title = "", index = 9999;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Determine Title, File, and Index based on parts length and content
Â  Â  Â  Â  Â  Â  if (parts.length === 3) {
Â  Â  Â  Â  Â  Â  Â  Â  // Title, file.html, index
Â  Â  Â  Â  Â  Â  Â  Â  [title, file, index] = [parts[0], parts[1], parseInt(parts[2], 10) || 9999];
Â  Â  Â  Â  Â  Â  } else if (parts.length === 2) {
Â  Â  Â  Â  Â  Â  Â  Â  if (parts[1].toLowerCase().includes('.html')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Title, file.html
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [title, file] = [parts[0], parts[1]];
Â  Â  Â  Â  Â  Â  Â  Â  } else if (parts[0].toLowerCase().includes('.html') && !isNaN(parts[1])) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // file.html, index
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [file, index] = [parts[0], parseInt(parts[1], 10) || 9999];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title = file;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (parts.length === 1) {
Â  Â  Â  Â  Â  Â  Â  Â  // file.html
Â  Â  Â  Â  Â  Â  Â  Â  file = parts[0];
Â  Â  Â  Â  Â  Â  Â  Â  title = file;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Re-normalize for consistency
Â  Â  Â  Â  Â  Â  file = file.toLowerCase().includes('.html') ? file : `${file}.html`;
Â  Â  Â  Â  Â  Â  title = prettifyTitle(title);
Â  Â  Â  Â  Â  Â  let fav = pinnedFiles.includes(file);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ensure title/file extraction is robust for cases like 'Analyzer,image_analyzer.html'
Â  Â  Â  Â  Â  Â  if (!file.toLowerCase().includes('.html') && parts.length === 2 && parts[1].toLowerCase().includes('.html')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â title = parts[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â file = parts[1];
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  entries.push({
Â  Â  Â  Â  Â  Â  Â  Â  type: 'tool',
Â  Â  Â  Â  Â  Â  Â  Â  title: title,Â 
Â  Â  Â  Â  Â  Â  Â  Â  file: file,Â 
Â  Â  Â  Â  Â  Â  Â  Â  index: parseInt(index, 10) || 9999,Â 
Â  Â  Â  Â  Â  Â  Â  Â  favorite: fav,Â 
Â  Â  Â  Â  Â  Â  Â  Â  idSuffix: Math.random().toString(36).substr(2,5),
Â  Â  Â  Â  Â  Â  Â  Â  groupIndex: currentGroupIndex > 0 ? currentGroupIndex - 1 : 0 // Assign to the last seen group
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // 2. Sort all entries (tools only, headers are order-dependent)
Â  Â  const toolEntries = entries.filter(e => e.type === 'tool');
Â  Â  const headerEntries = entries.filter(e => e.type === 'header');

Â  Â  // Sort tool entries by index
Â  Â  toolEntries.sort((a, b) => a.index - b.index);

Â  Â  // Reconstruct allEntries in the correct display order (headers in original position, tools interleaved, then sorted by index within group).
Â  Â  let finalEntries = [];
Â  Â  let groupMap = new Map();
Â  Â  // Initialize groups with headers
Â  Â  headerEntries.forEach(h => groupMap.set(h.groupIndex, {header: h, tools: []}));
Â  Â  // Place tools into their groups
Â  Â  toolEntries.forEach(t => {
Â  Â  Â  Â  let group = groupMap.get(t.groupIndex);
Â  Â  Â  Â  if(group) group.tools.push(t);
Â  Â  });
Â  Â Â 
Â  Â  // Sort tools within each group (already sorted, but to be sure)
Â  Â  groupMap.forEach(group => group.tools.sort((a, b) => a.index - b.index));

Â  Â  // Reassemble the list with headers and sorted tools
Â  Â  groupMap.forEach(group => {
Â  Â  Â  Â  if(group.header) finalEntries.push(group.header);
Â  Â  Â  Â  finalEntries.push(...group.tools);
Â  Â  });
Â  Â Â 
Â  Â  // Fallback for tools that had no preceding header
Â  Â  if (finalEntries.length === 0) finalEntries = toolEntries;
Â  Â Â 
Â  Â  allEntries = finalEntries; // This is the list for rendering

Â  Â  // Render Header Function (Updated)
Â  Â  function createHeader(entry) {
Â  Â  Â  Â  const iconClass = entry.isCollapsed ? 'bi-chevron-right' : 'bi-chevron-down';
Â  Â  Â  Â  const $header = $(`
Â  Â  Â  Â  Â  Â  <li class="nav-item nav-header px-3 py-2 mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="nav-header-button" data-group-title="${entry.title}" title="Toggle ${entry.title}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="tool-label">${entry.title}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="bi ${iconClass} text-base transition-transform duration-150"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  `);
Â  Â  Â  Â  $tabs.append($header);
Â  Â  }
Â  Â Â 
Â  Â  // Render Tab Function (modified to handle different base classes and initial visibility)
Â  Â  function createTab(entry, container){
Â  Â  Â  let id = "tab-" + entry.file.replace(/[^a-z0-9]/gi, "") + "-" + entry.idSuffix;
Â  Â  Â  let iconClass = getToolIcon(entry.file);
Â  Â  Â Â 
Â  Â  Â  let baseClasses = entry.favorite ? PINNED_BASE : UNPINNED_BASE;
Â  Â  Â  let starClasses = entry.favorite ? STAR_ON : STAR_OFF;
Â  Â  Â Â 
Â  Â  Â  // Determine initial visibility for unpinned items
Â  Â  Â  const groupEntry = allEntries.find(e => e.type === 'header' && e.groupIndex === entry.groupIndex);
Â  Â  Â  const isHidden = !entry.favorite && groupEntry && groupEntry.isCollapsed;
Â  Â  Â  const displayStyle = isHidden ? 'style="display: none;"' : '';

Â  Â  Â  let $tab = $(`
Â  Â  Â  Â  <li class="nav-item" ${displayStyle}>
Â  Â  Â  Â  Â  <a class="nav-link p-3 rounded-none flex items-center justify-between transition-colors duration-150 ${baseClasses}" id="${id}" href="#" title="${entry.title}">
Â  Â  Â  Â  Â  Â  <span class="tool-left flex items-center gap-3 flex-1 overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="bi ${iconClass} text-xl"></i>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="tool-label text-xs">${entry.title}</span>
Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  <i class="bi bi-star-fill favorite text-xl cursor-pointer ${starClasses}"></i>
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </li>
Â  Â  Â  `);
Â  Â  Â  container.append($tab);

Â  Â  Â  // Tab Click Handler
Â  Â  Â  $tab.find("a").on("click", function(e){
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. Remove active state from ALL tabs
Â  Â  Â  Â  $(".sidebar .nav-link").each(function() {
Â  Â  Â  Â  Â  Â  const $link = $(this);
Â  Â  Â  Â  Â  Â  $link.removeClass(ACTIVE_UNPINNED).removeClass(ACTIVE_PINNED).removeClass('active-shadow');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Re-apply correct base class if it was pinned/unpinned
Â  Â  Â  Â  Â  Â  // Find the entry using the idSuffix part
Â  Â  Â  Â  Â  Â  const idPart = $link.attr('id').split("tab-")[1];
Â  Â  Â  Â  Â  Â  const idSuffix = idPart ? idPart.split('-').pop() : null;
Â  Â  Â  Â  Â  Â  const currentEntry = allEntries.find(en => en.type === 'tool' && en.idSuffix === idSuffix);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (currentEntry) {
Â  Â  Â  Â  Â  Â  Â  Â  Â const baseClass = currentEntry.favorite ? PINNED_BASE : UNPINNED_BASE;
Â  Â  Â  Â  Â  Â  Â  Â  Â $link.addClass(baseClass);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. Add active state to the clicked tab
Â  Â  Â  Â  const activeClass = entry.favorite ? ACTIVE_PINNED : ACTIVE_UNPINNED;
Â  Â  Â  Â  $(this).removeClass(UNPINNED_BASE).removeClass(PINNED_BASE).addClass(activeClass);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 3. Load iframe - FIXED: added 'tools/' prefix
Â  Â  Â  Â  $frame.attr("src", 'tools/' + entry.file);
Â  Â  Â  });
Â  Â  }

Â  Â  // 3. Render all entries (Headers and Tools)
Â  Â  finalEntries.forEach(entry => {
Â  Â  Â  Â  if (entry.type === 'header') {
Â  Â  Â  Â  Â  Â  createHeader(entry);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Check for pinned status to render in the correct list
Â  Â  Â  Â  Â  Â  if (entry.favorite) {
Â  Â  Â  Â  Â  Â  Â  Â  createTab(entry, $pinnedTabs);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  createTab(entry, $tabs);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Load the first *tool* entry by default and mark it as active
Â  Â  const firstTool = finalEntries.find(e => e.type === 'tool');
Â  Â  if (firstTool) {
Â  Â  Â  Â  $(`#tab-${firstTool.file.replace(/[^a-z0-9]/gi,"")}-${firstTool.idSuffix}`).trigger('click');
Â  Â  }

Â  Â  setCopyrightYear();
Â  });

Â  // --- Favorite/Pin Click Handler ---
Â Â 
Â  $(document).on("click", ".favorite", function(e){
Â  Â  e.stopPropagation();
Â  Â  const $star = $(this);
Â  Â  const $tab = $star.closest("li.nav-item");
Â  Â  const $link = $star.closest("a");
Â  Â Â 
Â  Â  const idPart = $link.attr("id").split("tab-")[1];
Â  Â  // Find entry using the idSuffix part
Â  Â  const idSuffix = idPart.split('-').pop();
Â  Â  const entry = allEntries.find(en => en.type === 'tool' && en.idSuffix === idSuffix);

Â  Â  if (!entry) return;

Â  Â  entry.favorite = !entry.favorite;
Â  Â  const isActive = $link.hasClass(ACTIVE_UNPINNED) || $link.hasClass(ACTIVE_PINNED);
Â  Â Â 
Â  Â  // 1. Toggle Star Color
Â  Â  $star.removeClass(STAR_ON).removeClass(STAR_OFF).addClass(entry.favorite ? STAR_ON : STAR_OFF);

Â  Â  // 2. Toggle Background/Text Classes and position
Â  Â  $link.removeClass(UNPINNED_BASE).removeClass(PINNED_BASE).removeClass(ACTIVE_UNPINNED).removeClass(ACTIVE_PINNED);
Â  Â Â 
Â  Â  if (entry.favorite) {
Â  Â  Â  // Pin: Set Pinned Base, then detach/prepend
Â  Â  Â  $link.addClass(PINNED_BASE);
Â  Â  Â  $tab.show().detach().prependTo("#pinnedTabs"); // Ensure pinned items are visible
Â  Â  Â  if(isActive) $link.removeClass(PINNED_BASE).addClass(ACTIVE_PINNED); // If active, re-apply active pinned class
Â  Â  Â  if(!pinnedFiles.includes(entry.file)) pinnedFiles.push(entry.file);
Â  Â  } else {
Â  Â  Â  // Unpin: Set Unpinned Base, then detach/append back to the main list
Â  Â  Â  $link.addClass(UNPINNED_BASE);
Â  Â  Â Â 
Â  Â  Â  // Check if the group is collapsed and hide the unpinned item
Â  Â  Â  const groupEntry = allEntries.find(e => e.type === 'header' && e.groupIndex === entry.groupIndex);
Â  Â  Â  if (groupEntry && groupEntry.isCollapsed) {
Â  Â  Â  Â  Â  $tab.hide();
Â  Â  Â  } else {
Â  Â  Â  Â  Â  $tab.show();
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // Find the correct position in the main list ($tabs) to reinsert the unpinned item.
Â  Â  Â  let inserted = false;
Â  Â  Â  const entryIndex = allEntries.findIndex(e => e.idSuffix === entry.idSuffix);
Â  Â  Â Â 
Â  Â  Â  // Find where the tool should be reinserted (based on its position in the sorted allEntries list)
Â  Â  Â  for (let i = entryIndex + 1; i < allEntries.length; i++) {
Â  Â  Â  Â  const nextEntry = allEntries[i];
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Skip over favorited tools in the main list
Â  Â  Â  Â  if (nextEntry.type === 'tool' && nextEntry.favorite) continue;

Â  Â  Â  Â  if (nextEntry.type === 'tool' && !nextEntry.favorite) {
Â  Â  Â  Â  Â  // Found the next non-pinned tool, insert before it
Â  Â  Â  Â  Â  $tab.detach().insertBefore($(`#tab-${nextEntry.file.replace(/[^a-z0-9]/gi,"")}-${nextEntry.idSuffix}`).closest('li.nav-item'));
Â  Â  Â  Â  Â  inserted = true;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  } else if (nextEntry.type === 'header') {
Â  Â  Â  Â  Â  // Found the next header, insert before it
Â  Â  Â  Â  Â  // Find the list item containing the header button
Â  Â  Â  Â  Â  $tab.detach().insertBefore($(`.nav-header-button[data-group-title="${nextEntry.title}"]`).closest('li.nav-item'));
Â  Â  Â  Â  Â  inserted = true;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // If we didn't find a place to insert it (i.e., it's the last item in the list/group), check the item immediately before it.
Â  Â  Â  if (!inserted) {
Â  Â  Â  Â  Â  let prevTool = null;
Â  Â  Â  Â  Â  for (let i = entryIndex - 1; i >= 0; i--) {
Â  Â  Â  Â  Â  Â  Â  if (allEntries[i].type === 'tool' && !allEntries[i].favorite) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  prevTool = allEntries[i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  if (allEntries[i].type === 'header') break;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (prevTool) {
Â  Â  Â  Â  Â  Â  Â  $tab.detach().insertAfter($(`#tab-${prevTool.file.replace(/[^a-z0-9]/gi,"")}-${prevTool.idSuffix}`).closest('li.nav-item'));
Â  Â  Â  Â  Â  Â  Â  inserted = true;
Â  Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // If still not inserted (e.g., it's the first tool in a group), append to the toolTabs container
Â  Â  Â  if (!inserted) {
Â  Â  Â  Â  Â $tab.detach().appendTo("#toolTabs");
Â  Â  Â  }

Â  Â  Â  if(isActive) $link.removeClass(UNPINNED_BASE).addClass(ACTIVE_UNPINNED); // If active, re-apply active unpinned class
Â  Â  Â  pinnedFiles = pinnedFiles.filter(f => f !== entry.file);
Â  Â  }
Â  Â Â 
Â  Â  savePinnedFiles();
Â  });
});
</script>

</body>
</html>