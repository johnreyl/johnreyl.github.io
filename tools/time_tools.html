<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>World Map Clocks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <style>
    body { 
      background: #f3f4f6;
      font-family: 'Inter', sans-serif; 
      padding: 0;
      overflow-x: hidden;
    }
    #mapWrapper {
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      width: 100%;
      padding: 1rem 0;
      cursor: grab;
    }
    #mapContainer {
      position: relative;
      width: 1599px;
      height: 799px;
      margin: auto;
      background-color: #1e40af;
      background-image: url('files/world-map.jpg');
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      border: 3px solid #1e3a8a;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transform-origin: 0 0;
      transition: transform 0.2s ease-out;
    }

    /* Transparent cards */
    .clock-card {
      position: absolute;
      transform: translate(-50%, calc(-100% - 9px));
      width: 110px;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(4px);
      border-radius: 0.75rem;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      text-align: center;
      padding: 0.5rem;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
      z-index: 10;
      border: 1px solid #e5e7eb;
    }
    .clock-card::after {
      content: '';
      position: absolute;
      bottom: -9px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid rgba(255, 255, 255, 0.85);
      z-index: 5;
    }

    /* Local clock (same style as others, but with red corner marker) */
    .clock-card.local {
      width: 150px;
      transform: translate(-50%, calc(-120% - 9px)) scale(1.2);
      position: relative;
      z-index: 50;
    }
    .clock-card.local::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      width: 0;
      height: 0;
      border-top: 16px solid red;
      border-left: 16px solid transparent;
      border-top-right-radius: 0.75rem;
    }

    /* Hover - no green */
    .clock-card:hover {
      transform: translate(-50%, calc(-130% - 9px)) scale(1.3);
      background: rgba(31, 41, 55, 0.9);
      color: #fff;
      z-index: 100;
    }
    .clock-card:hover::after {
      border-top: 8px solid rgba(31, 41, 55, 0.9);
    }

    .clock-time { font-weight: 700; font-size: 1.25rem; line-height: 1; }
    .clock-date { font-size: 0.65rem; color: #6b7280; line-height: 1; margin-top: 0.1rem; margin-bottom: 0.1rem; }
    .clock-card:hover .clock-date { color: #fff; }

    .clock-offset { font-size: 0.7rem; font-weight: 600; margin-top: 0.1rem; margin-bottom: 0.1rem; color: #374151; }
    .clock-card:hover .clock-offset { color: #fff; }
    
    .clock-city { font-size: 0.75rem; color: #6b7280; line-height: 1; }

    /* Time-based themes */
    .clock-card.morning { background: rgba(254, 249, 195, 0.6); color: #1f2937; }
    .clock-card.afternoon { background: rgba(255, 255, 255, 0.6); color: #111827; }
    .clock-card.evening { background: rgba(0, 0, 0, 0.75); color: #f9fafb; } /* 6PM‚Äì11:59PM */
    .clock-card.midnight { background: rgba(0, 5, 105, 0.65); color: #f9fafb; } /* 12AM‚Äì5:59AM */

    .clock-icon { display: block; font-size: 1rem; margin-bottom: 0.2rem; }
  </style>
</head>
<body class="overflow-x-hidden">

<div class="container mx-auto p-4 md:p-6">
  <h1 class="text-3xl font-extrabold text-gray-900 mb-4 text-center">
    <span class="text-indigo-600">üåç</span> Global Time Zones
  </h1>

  <div class="flex flex-wrap justify-center gap-4 mb-6">
    <button id="zoomOutBtn" class="flex items-center space-x-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg shadow hover:bg-gray-300 transition duration-150 text-sm">
      <i class="bi bi-zoom-out"></i> <span>Zoom Out</span>
    </button>
    <button id="zoomInBtn" class="flex items-center space-x-1 px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700 transition duration-150 text-sm">
      <i class="bi bi-zoom-in"></i> <span>Zoom In</span>
    </button>

    <label class="relative inline-flex items-center cursor-pointer space-x-2 bg-white rounded-lg shadow">
      <input type="checkbox" id="toggleTimeFormat" class="sr-only peer" checked>
      <div class="w-11 h-6 bg-gray-300 rounded-full transition-colors duration-300 peer-checked:bg-blue-600"></div>
      <div class="absolute left-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5"></div>
      <span class="ml-14 text-gray-700 font-medium whitespace-nowrap">24H / 12H&nbsp;&nbsp;</span>
    </label>

    <label class="relative inline-flex items-center cursor-pointer space-x-2 bg-white rounded-lg shadow">
      <input type="checkbox" id="toggleClockVisibility" class="sr-only peer" checked>
      <div class="w-11 h-6 bg-gray-300 rounded-full transition-colors duration-300 peer-checked:bg-red-600"></div>
      <div class="absolute left-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5"></div>
      <span class="ml-14 text-gray-700 font-medium whitespace-nowrap" id="visibilityLabel">Hide Clocks&nbsp;&nbsp;</span>
    </label>
  </div>
</div>

<div id="mapWrapper" class="cursor-grab">
  <div id="mapContainer"></div>
</div>

<script>
const clocks = [
  { city: "Manila (Local)", tz: "Asia/Manila", x: 1340, y: 325, local:true },
  { city: "New York", tz: "America/New_York", x: 506, y: 165 },
  { city: "Los Angeles", tz: "America/Los_Angeles", x: 321, y: 200 },
  { city: "London", tz: "Europe/London", x: 790, y: 115 },
  { city: "Moscow", tz: "Europe/Moscow", x: 923, y: 97 },
  { city: "Dubai", tz: "Asia/Dubai", x: 1031, y: 253 },
  { city: "Beijing", tz: "Asia/Shanghai", x: 1261, y: 168 },
  { city: "Tokyo", tz: "Asia/Tokyo", x: 1352, y: 190 },
  { city: "Sydney", tz: "Australia/Sydney", x: 1417, y: 593 },
  { city: "Rio de Janeiro", tz: "America/Sao_Paulo", x: 600, y: 450 },
  { city: "Lagos", tz: "Africa/Lagos", x: 820, y: 400 },
  { city: "Antarctica (Troll)", tz: "Etc/GMT-1", x: 880, y: 750 },
  { city: "Jakarta", tz: "Asia/Jakarta", x: 1200, y: 390 },
  { city: "Bangkok", tz: "Asia/Bangkok", x: 1180, y: 280 },
  { city: "Rome", tz: "Europe/Rome", x: 850, y: 150 }
];

const MIN_ZOOM = 0.5;
const MAX_ZOOM = 2.0;
const ZOOM_STEP = 0.25;

let currentZoom = parseFloat(localStorage.getItem('mapZoom')) || 1.0;
let is24HourFormat = true; 
let isClocksVisible = true; 

function getTimeZoneOffset(tz) {
    try {
        const fixedDate = new Date(Date.UTC(2024, 0, 1, 12, 0, 0)); 
        const parts = new Intl.DateTimeFormat('en-US', {
            timeZone: tz,
            timeZoneName: 'longOffset',
        }).formatToParts(fixedDate);
        const offsetPart = parts.find(p => p.type === 'timeZoneName');
        if (offsetPart) return offsetPart.value; 
        return tz.split('/').pop().replace('_', ' '); 
    } catch (e) {
        return tz.split('/').pop().replace('_', ' ');
    }
}

function handleZoom(factor) {
    let newZoom = currentZoom + factor;
    newZoom = Math.min(Math.max(MIN_ZOOM, newZoom), MAX_ZOOM);
    if (newZoom !== currentZoom) {
        currentZoom = newZoom;
        $('#mapContainer').css('transform', `scale(${currentZoom})`);
        localStorage.setItem('mapZoom', currentZoom.toFixed(2));
        setTimeout(centerMapOnLocalClock, 250); 
    }
}

function renderClocks(){
  const $container = $("#mapContainer").empty();
  clocks.forEach(c=>{
    if (!c.offset) c.offset = getTimeZoneOffset(c.tz);
    const id = c.city.replace(/[^a-zA-Z0-9]/g,'');
    const $card = $(`
      <div class="clock-card ${c.local?'local':''}" id="clock-${id}">
        <div class="clock-icon">--</div>
        <div class="clock-time">--:--:--</div>
        <div class="clock-date">--</div>
        <div class="clock-offset">${c.offset}</div>
        <div class="clock-city">${c.city}</div>
      </div>
    `).css({left: c.x+'px', top: c.y+'px'});
    $container.append($card);
  });
  $('#mapContainer').css('transform', `scale(${currentZoom})`);
  $('#mapContainer .clock-card').toggleClass('hidden', !isClocksVisible);
}

function updateClocks(){
  const now = new Date();
  clocks.forEach(c=>{
    const localNow = new Date(now.toLocaleString("en-US",{timeZone: c.tz}));
    const hours = localNow.getHours();

    const timeString = localNow.toLocaleTimeString('en-US',{
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: !is24HourFormat 
    });
    const dateString = localNow.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric'
    });

    const id = c.city.replace(/[^a-zA-Z0-9]/g,'');
    const $card = $(`#clock-${id}`);

    $card.find(".clock-time").text(timeString);
    $card.find(".clock-date").text(dateString);

    // reset theme
    $card.removeClass("morning afternoon evening midnight");

    let icon = "‚è∞";
    if (hours >= 6 && hours < 12) {
      $card.addClass("morning"); icon = "üåÖ";
    } else if (hours >= 12 && hours < 18) {
      $card.addClass("afternoon"); icon = "‚òÄÔ∏è";
    } else if (hours >= 18 && hours < 24) {
      $card.addClass("evening"); icon = "üåô";
    } else {
      $card.addClass("midnight"); icon = "üåå";
    }

    $card.find(".clock-icon").text(icon);
  });
}

function isMobileView() {
    // Check if the current window width is less than or equal to 768px (a common mobile breakpoint)
    return $(window).width() <= 768; 
}

function centerMapOnLocalClock() {
    if (!isMobileView()) {
        return; 
    }

    const $wrapper = $('#mapWrapper');
    const wrapperWidth = $wrapper.width();
    const mapScaledWidth = $wrapper[0].scrollWidth; 
    const localClock = clocks.find(c => c.local);
    if (localClock && mapScaledWidth > wrapperWidth) {
        const targetX = localClock.x * currentZoom;
        let scrollX = targetX - (wrapperWidth / 2);
        const maxScrollX = mapScaledWidth - wrapperWidth;
        scrollX = Math.min(Math.max(0, scrollX), maxScrollX);
        $wrapper.scrollLeft(scrollX);
    }
}

$(function(){
  renderClocks();
  updateClocks();
  setInterval(updateClocks, 1000);
  centerMapOnLocalClock();
  $(window).on('resize', centerMapOnLocalClock);
  $('#zoomInBtn').on('click', () => handleZoom(ZOOM_STEP));
  $('#zoomOutBtn').on('click', () => handleZoom(-ZOOM_STEP));
  $('#toggleTimeFormat').on('change', function() {
      is24HourFormat = $(this).prop('checked');
      updateClocks();
  });
  $('#toggleClockVisibility').on('change', function() {
      isClocksVisible = $(this).prop('checked');
      if (isClocksVisible) {
          $('#visibilityLabel').text('Hide Clocks');
          $('#mapContainer .clock-card').removeClass('hidden');
      } else {
          $('#visibilityLabel').text('Show Clocks');
          $('#mapContainer .clock-card').addClass('hidden');
      }
  }).trigger('change');
});
</script>
</body>
</html>
