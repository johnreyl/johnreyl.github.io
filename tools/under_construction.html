<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario World Interactive Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* 1. Global & Font Setup */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center; 
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* 2. Scoreboard Styling */
        #scoreboard {
            width: 90%; 
            max-width: 600px;
            margin: 40px auto 0;
            display: flex;
            justify-content: space-between;
            background-color: #2d3748; /* Brand Charcoal */
            color: white;
            padding: 6px 12px;
            border-radius: 6px 6px 0 0; 
            font-weight: bold;
            font-size: 1rem; 
        }
        #current-score { 
            color: #f9d71c; 
            transition: opacity 0.2s; /* Smooth transition for blinking */
        }
        #top-score { color: #ed8936; }

        /* CSS for Blinking Score (NEW) */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }
        .blinking {
            animation: blink 0.5s step-end infinite alternate;
        }

        /* 3. Message Prompt Styling */
        #koopa-message-wrapper {
            width: 90%; 
            max-width: 600px;
            margin: 10px auto 30px; 
            text-align: center;
        }

        #koopa-message-content {
            display: inline-block;
        }

        /* 4. Mario World Section Styling */
        #mario-world-container {
            width: 90%; 
            max-width: 600px;
            height: 150px; 
            position: relative;
            overflow: hidden; 
            margin: 0 auto 0; 
            background-color: #79a1d1; 
            border-bottom: 5px solid #2d3748; 
            border-radius: 0 0 0 0;
        }

        /* CSS for the Animated Mario World Ground (Duration now set by JS) */
        #mario-world-ground {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 300%; 
            height: 25px;
            background: 
                repeating-linear-gradient(90deg, #5aa85d, #5aa85d 20px, #61b365 20px, #61b365 40px),
                repeating-linear-gradient(90deg, #965a3c, #965a3c 20px, #a06341 20px, #a06341 40px);
            background-size: 100% 5px, 100% 20px; 
            background-position: 0 0, 0 5px; 
            background-repeat: repeat-x;
            /* Animation properties split to allow dynamic duration change */
            animation-name: scroll-ground;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            animation-duration: 1.5s; /* Default duration */
        }

        @keyframes scroll-ground {
            from { background-position: 0 0, 0 5px; } 
            to { background-position: -40px 0, -40px 5px; }
        }

        /* Character Base Styling */
        .character {
            position: absolute;
            bottom: 25px; 
            z-index: 10;
            cursor: pointer;
            width: 55px;
            height: 55px;
        }
        
        /* Koopa Character */
        #koopa {
            left: 50px; 
            animation: run-bob 0.4s infinite alternate;
            transition: opacity 0.2s; 
        }

        /* Mario Character */
        #mario-character {
            left: -60px; 
            transition: opacity 0.2s; 
        }

        @keyframes run-bob {
            from { transform: translateY(0px); }
            to { transform: translateY(2px); }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-charcoal': '#2d3748', 
                        'brand-orange': '#ed8936',   
                        'text-gray': '#4a5568',      
                    }
                }
            }
        }

        $(document).ready(function() {
            // Standard jQuery easing functions for smooth jump animation arc
            $.easing.easeOutQuad = function (x, t, b, c, d) { return -c * (t /= d) * (t - 2) + b; };
            $.easing.easeInQuad = function (x, t, b, c, d) { return c * (t /= d) * t + b; };
            
            const $koopa = $('#koopa'); 
            const $mario = $('#mario-character'); 
            const $messageContainer = $('#koopa-message-content'); 
            const $currentScoreDisplay = $('#current-score');
            const $topScoreDisplay = $('#top-score');
            const $ground = $('#mario-world-ground'); 

            // --- Sound Elements ---
            const tapSound = document.getElementById('tapSound');
            const gameOverSound = document.getElementById('gameOverSound');
            const chaseMusic = document.getElementById('chaseMusic'); 

            // --- Constants ---
            const groundHeight = 25; 
            const jumpHeight = 60; 
            const originalLeft = 50; 
            const dragOffset = 40; 
            const MARIO_START_LEFT = -60;
            const MARIO_STEP_DURATION = 300; 
            const MARIO_STEP_DISTANCE = 5; 
            const DBLCLICK_DELAY = 300; 
            const TOUCH_MARGIN = 20; 
            const STORAGE_KEY = 'koopaTopScore';

            // --- Ground Speed Constants ---
            const ORIGINAL_GROUND_DURATION = 1.5; 
            const MIN_GROUND_DURATION = 0.15;    
            
            // --- Mario Movement Cap (NEW) ---
            // 80% of max-width (600px) is 480px. Mario's width is 55px.
            // Mario's left edge must stop at 480px - 55px = 425px.
            const MARIO_MAX_LEFT_EDGE = 425; 
            
            // --- State Management ---
            let isDoubleClicked = false;
            let isClickEnabled = true;
            let marioChaseInterval = null;
            let scoreInterval = null;
            let currentScore = 0;
            let startTime = 0;
            let currentGroundDuration = ORIGINAL_GROUND_DURATION; 

            // --- Sound Functions ---
            function playTapSound() {
                // DECREASED VOLUME FOR TAP EFFECT to 0.3
                tapSound.volume = 0.3;
                tapSound.currentTime = 0; 
                tapSound.play();
            }

            function playGameOverSound() {
                gameOverSound.volume = 1.0; 
                gameOverSound.currentTime = 0;
                gameOverSound.play();
            }
            
            function startChaseMusic() {
                // INCREASED BACKGROUND MUSIC VOLUME to 1.0
                chaseMusic.volume = 1.0; 
                chaseMusic.currentTime = 0; 
                chaseMusic.play().catch(e => console.log("Music play failed:", e)); 
            }

            function stopChaseMusic() {
                chaseMusic.pause();
                chaseMusic.currentTime = 0;
            }

            // --- Ground Speed Control ---
            function setGroundSpeed(duration) {
                // Ensures duration doesn't go below the limit
                currentGroundDuration = Math.max(duration, MIN_GROUND_DURATION); 
                // Applies the new speed to the CSS animation-duration property
                $ground.css('animation-duration', currentGroundDuration + 's');
            }


            // --- Score Logic Functions ---
            function loadTopScore() {
                const storedScore = localStorage.getItem(STORAGE_KEY);
                return storedScore ? parseInt(storedScore) : 0;
            }

            function updateTopScore(newScore) {
                const currentTopScore = loadTopScore();
                if (newScore > currentTopScore) {
                    localStorage.setItem(STORAGE_KEY, newScore);
                    $topScoreDisplay.text('Top Score: ' + newScore + ' ms');
                }
            }

            function startScoring() {
                $currentScoreDisplay.removeClass('blinking');
                currentScore = 0;
                $currentScoreDisplay.text('Score: 0 ms');

                if (scoreInterval) return;
                startTime = Date.now();
                scoreInterval = setInterval(() => {
                    if (parseInt($koopa.css('left')) !== originalLeft) {
                        currentScore = Date.now() - startTime;
                        $currentScoreDisplay.text('Score: ' + currentScore + ' ms');
                    }
                }, 10);
            }

            function stopScoring() {
                if (scoreInterval) {
                    clearInterval(scoreInterval);
                    scoreInterval = null;
                    updateTopScore(currentScore);
                    
                    $currentScoreDisplay.addClass('blinking');
                }
            }

            // Initialize scores on load
            $topScoreDisplay.text('Top Score: ' + loadTopScore() + ' ms');
            $currentScoreDisplay.text('Score: 0 ms');


            // --- Helper Functions ---

            function showMessage(msg) {
                const fadeInDuration = 100;
                const fadeOutDuration = 500;
                const holdTime = 2400; 

                $messageContainer.find('p').text(msg);
                $messageContainer.fadeIn(fadeInDuration);
                
                setTimeout(() => { 
                    $messageContainer.fadeOut(fadeOutDuration); 
                }, holdTime); 
            }

            function restoreKoopaAnimation() {
                 $koopa.css('animation', 'run-bob 0.4s infinite alternate');
            }

            function disableClick() {
                if (isClickEnabled) {
                    playGameOverSound();
                    stopChaseMusic(); 
                    
                    $koopa.off('click', clickHandler);
                    $koopa.off('dblclick', dblClickHandler);
                    isClickEnabled = false;
                    $koopa.css('opacity', 0.5); 
                }
            }

            function enableClick() {
                if (!isClickEnabled) {
                    $koopa.on('click', clickHandler);
                    $koopa.on('dblclick', dblClickHandler);
                    isClickEnabled = true;
                    $koopa.css('opacity', 1);
                }
            }

            // --- Mario Chase Logic (MODIFIED to enforce 80% cap) ---

            function startChase() {
                startScoring();

                if (marioChaseInterval === null) { 
                    startChaseMusic();
                    setGroundSpeed(ORIGINAL_GROUND_DURATION);
                }

                if (marioChaseInterval !== null) return;
                
                $mario.css('animation', 'run-bob 0.4s infinite alternate'); 

                marioChaseInterval = setInterval(() => {
                    $mario.stop(true); 

                    const koopaLeft = parseInt($koopa.css('left'));
                    let marioLeft = parseInt($mario.css('left'));
                    
                    const isTouching = (marioLeft + 55) >= koopaLeft - TOUCH_MARGIN; 
                    
                    if (isTouching) {
                        disableClick();
                        $mario.css('animation', 'none'); 
                        return; 
                    }

                    // CHECK CAP: If Mario is at or past the maximum allowed left position (80% boundary), stop.
                    if (marioLeft >= MARIO_MAX_LEFT_EDGE) {
                         $mario.css('animation', 'none');
                         return;
                    }


                    if (marioLeft < koopaLeft) {
                        // Calculate the next potential position
                        let nextMarioLeft = marioLeft + MARIO_STEP_DISTANCE;

                        // Ensure Mario does not step beyond the cap
                        marioLeft = Math.min(nextMarioLeft, MARIO_MAX_LEFT_EDGE);
                        
                        $mario.css('left', marioLeft + 'px');
                    } else {
                        $mario.css('animation', 'none');
                    }
                    
                }, MARIO_STEP_DURATION);
            }

            function stopAndReturnMario() {
                // Stop Mario's chase timer
                if (marioChaseInterval) {
                    clearInterval(marioChaseInterval);
                    marioChaseInterval = null;
                }
                
                stopChaseMusic(); 
                stopScoring();

                // RESET GROUND SPEED TO NORMAL
                setGroundSpeed(ORIGINAL_GROUND_DURATION);

                // Return Mario to his starting position
                $mario.stop(true).animate(
                    { left: MARIO_START_LEFT + 'px' },
                    300, 
                    'linear',
                    function() {
                        $mario.css('animation', 'none'); 
                        enableClick(); 
                    }
                );
            }

            // --- Double Click Action Function ---
            function dblClickAction() {
                playTapSound();
                
                showMessage("Enjoy our tools. It's totally free");
                
                $koopa.stop(true, true); 
                $koopa.css('animation', 'none'); 
                
                $mario.stop(true, true);
                
                const forwardDistance = 100; 
                const forwardDuration = 3000;
                const returnDuration = 1500;
                const fallDuration = 300; 

                const currentBottom = parseInt($koopa.css('bottom'));
                const koopaStartLeft = parseInt($koopa.css('left'));
                
                let animationChain;

                // 1. CONDITIONAL FALL (0.3s)
                if (currentBottom > groundHeight) {
                    animationChain = $koopa.animate(
                        { bottom: groundHeight + 'px' }, 
                        fallDuration, 
                        'easeInQuad' 
                    );
                } else {
                    animationChain = $koopa;
                }

                startChase();
                
                // INCREASE GROUND SPEED (x2)
                if (marioChaseInterval) { 
                    setGroundSpeed(currentGroundDuration / 2);
                }

                // 2. CHAIN: Koopa Move forward (3s)
                animationChain.animate(
                    { left: koopaStartLeft + forwardDistance + 'px' }, 
                    forwardDuration, 
                    'linear'
                )
                // 3. CHAIN: Koopa Return to original position (1.5s)
                .animate(
                    { left: originalLeft + 'px' }, 
                    returnDuration, 
                    'linear', 
                    function() {
                        restoreKoopaAnimation();
                        stopAndReturnMario();
                    }
                );
            }

            // --- Single Click Action Function ---
            function singleClickAction() {
                playTapSound();

                showMessage("Sorry princess, the website is still under construction");
                
                $koopa.stop(true); 
                $koopa.css('animation', 'none'); 
                
                startChase();
                
                // INCREASE GROUND SPEED (x2)
                if (marioChaseInterval) { 
                    setGroundSpeed(currentGroundDuration / 2);
                }
                
                const currentLeft = parseInt($koopa.css('left'));
                const currentBottom = parseInt($koopa.css('bottom'));
                
                const peakLeft = currentLeft + dragOffset; 
                
                // 1. Jump Up (200ms) 
                $koopa.animate(
                    { 
                        bottom: currentBottom + jumpHeight + 'px', 
                        left: peakLeft + 'px' 
                    }, 
                    200, 
                    'easeOutQuad' 
                ) 
                // 2. Drag Release - Fall to ground (0.3 seconds)
                .animate(
                    { 
                        bottom: groundHeight + 'px', 
                        left: peakLeft + 'px' 
                    }, 
                    300, 
                    'easeInQuad' 
                ) 
                
                // 3. Return to starting point (600ms) 
                .animate(
                    { left: originalLeft + 'px' }, 
                    600, 
                    function() {
                        restoreKoopaAnimation();
                        // If Koopa returns to start, stop Mario and return him
                        if (parseInt($koopa.css('left')) === originalLeft) {
                             stopAndReturnMario();
                        }
                    }
                );
            }
            
            // --- EVENT HANDLERS ---
            
            function dblClickHandler(e) {
                isDoubleClicked = true; 
                dblClickAction();
                setTimeout(() => { isDoubleClicked = false; }, DBLCLICK_DELAY + 50); 
            }

            function clickHandler(e) {
                if (isDoubleClicked) {
                    return; 
                }
                
                singleClickAction();
            }

            // Initial event attachments
            $koopa.on('dblclick', dblClickHandler);
            $koopa.on('click', clickHandler);
            
        });
    </script>
</head>
<body class="pt-16">
    
    <audio id="tapSound" src="files/tap_effect.mp3" preload="auto"></audio>
    <audio id="gameOverSound" src="files/game_over.mp3" preload="auto"></audio>
    <audio id="chaseMusic" src="files/chase_music.mp3" preload="auto" loop></audio> 
    <div class="max-w-xl w-full p-8 text-center bg-white rounded-xl border border-gray-100 shadow-md">

        <div class="mb-6 flex justify-center">
            <svg class="w-16 h-16 text-brand-orange" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.986 21.053l-2.739-6.315h-10.494l-2.739 6.315h16zM15.426 12l-2.715-6.25h-1.422l-2.715 6.25h6.852zM12 2l-7 16h14l-7-16z"/>
            </svg>
        </div>

        <h2 class="text-4xl font-bold text-brand-charcoal mb-4">
            Website Under Construction
        </h2>

        <p class="text-lg text-text-gray mb-8 leading-relaxed">
            We're building something great! Our site will be live very soon. Thank you for your patience.
        </p>

        <a href="mailto:contact@yourdomain.com"
           class="text-base font-medium text-brand-charcoal border-b border-brand-charcoal/50 hover:text-brand-orange transition duration-150">
            Contact us if you have an urgent inquiry
        </a>

    </div>

    <div id="scoreboard">
        <span id="current-score"></span>
        <span id="top-score"></span>
    </div>

    <div id="mario-world-container">
        
        <div id="mario-world-ground"></div>
        
        <div id="koopa" class="character">
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="10" y="26" width="44" height="24" fill="#3CB371"/>
                <rect x="12" y="28" width="40" height="20" fill="#3CB371"/>
                <rect x="18" y="30" width="28" height="16" fill="#3CB371"/>
                <rect x="18" y="32" width="6" height="4" fill="#000000"/>
                <rect x="40" y="32" width="6" height="4" fill="#000000"/>
                <rect x="24" y="40" width="6" height="4" fill="#000000"/>
                <rect x="34" y="40" width="6" height="4" fill="#000000"/>
                
                <rect x="22" y="8" width="20" height="18" fill="#FFD700"/>

                <rect x="24" y="14" width="4" height="4" fill="#FFFFFF"/>
                <rect x="36" y="14" width="4" height="4" fill="#FFFFFF"/>
                <rect x="26" y="16" width="2" height="2" fill="#000000"/>
                <rect x="38" y="16" width="2" height="2" fill="#000000"/>
                
                <rect x="26" y="24" width="12" height="2" fill="#8B4513"/>

                <rect x="44" y="34" width="8" height="10" fill="#FFD700"/>
                <rect x="12" y="34" width="8" height="10" fill="#FFD700"/>

                <rect x="22" y="50" width="8" height ="6" fill="#8B4513"/>
           
     <rect x="34" y="50" width="8" height="6" fill="#8B4513"/>

                <rect x="22" y="6" width="20" height="2" fill="#8B4513"/>
            </svg>
        </div>

        <div id="mario-character" class="character">
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="20" y="8" width="24" height="16" fill="#FF4500"/>
                <rect x="24" y="12" width="16" height="4" fill="#FFFFFF"/>
                <rect x="22" y="18" width="20" height="6" fill="#000000"/>
                
                <rect x="22" y="24" width="20" height="8" fill="#FF4500"/>
                <rect x="26" y="24" width="12" height="4" fill="#000000"/>

                <rect x="22" y="32" width="20" height="16" fill="#00BFFF"/>
                
                <rect x="18" y="36" width="6" height="10" fill="#FFFFFF"/>
                <rect x="40" y="36" width="6" height="10" fill="#FFFFFF"/>
                
                <rect x="24" y="48" width="6" height="8" fill="#8B4513"/>
                <rect x="34" y="48" width="6" height="8" fill="#8B4513"/>
            </svg>
        </div>
    </div>

    <div id="koopa-message-wrapper">
        <div id="koopa-message-content" class="hidden bg-white/90 px-3 py-2 rounded-md text-sm font-bold text-black shadow-md border border-gray-300">
            <p><--This Way to navigate to other pages. </p>
        </div>
    </div>

</body>
</html>