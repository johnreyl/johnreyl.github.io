<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Network Data Details</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body { padding: 2rem; }
pre { background: #f8f9fa; padding: 1rem; border-radius: .5rem; }
#geoMap { width: 100%; height: 400px; border-radius: .5rem; }
</style>
</head>
<body>
<div class="container">
  <h1 class="mb-4">Network Data Details</h1>

  <!-- Connection Details -->
  <div class="card mb-3">
    <div class="card-header">Connection Information</div>
    <div class="card-body">
      <table class="table table-bordered">
        <tbody id="connectionDetails"><tr><td colspan="2">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>

  <!-- Speed Test -->
  <div class="card mb-3">
    <div class="card-header">Speed Test (Ping / Download)</div>
    <div class="card-body">
      <button id="testBtn" class="btn btn-primary mb-2">Run Speed Test</button>
      <pre id="speedResults">No test yet.</pre>
    </div>
  </div>

  <!-- Public IP -->
  <div class="card mb-3">
    <div class="card-header">Public IP Address</div>
    <div class="card-body">
      <p id="ipAddress">Loading...</p>
    </div>
  </div>

  <!-- IP Geolocation -->
  <div class="card mb-3">
    <div class="card-header">IP Geolocation Details</div>
    <div class="card-body">
      <table class="table table-bordered">
        <tbody id="geoDetails"><tr><td colspan="2">Loading geolocation...</td></tr></tbody>
      </table>
      <div id="geoMap" class="mt-3"></div>
    </div>
  </div>

  <!-- Domain Info -->
  <div class="card mb-3">
    <div class="card-header">Domain Information</div>
    <div class="card-body">
      <pre id="domainInfo">Loading...</pre>
    </div>
  </div>

  <!-- Device Info -->
  <div class="card mb-3">
    <div class="card-header">Browser / Device Information</div>
    <div class="card-body">
      <pre id="deviceInfo"></pre>
    </div>
  </div>

  <div class="alert alert-info">
    ⚠️ <strong>Note:</strong> Browsers cannot show Wi-Fi SSID or nearby networks directly. 
    The details below are limited to what the browser allows (Network Information API, IP, and public APIs).
  </div>
</div>

<script>
function updateConnectionDetails() {
  let c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  let $tbl = $("#connectionDetails").empty();
  function addRow(k,v){ $tbl.append(`<tr><th>${k}</th><td>${v}</td></tr>`); }
  if (c) {
    addRow("Connection Type", c.type || 'Unknown');
    addRow("Effective Type", c.effectiveType || 'N/A');
    addRow("Downlink (Mbps)", c.downlink || 'N/A');
    addRow("RTT (ms)", c.rtt || 'N/A');
    addRow("Save Data Mode", c.saveData || false);
  } else { addRow("Connection Info", "Not supported in this browser"); }
  addRow("Online", navigator.onLine);
}

function updateDeviceInfo() {
  let info = {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    cookiesEnabled: navigator.cookieEnabled
  };
  $("#deviceInfo").text(JSON.stringify(info, null, 2));
}

function fetchIP() {
  $.getJSON("https://api.ipify.org?format=json", function(data) {
    $("#ipAddress").text(data.ip);
    fetchDomainInfo(data.ip);
    fetchGeoDetails(data.ip);
  }).fail(function() {
    $("#ipAddress").text("Could not fetch IP.");
    $("#domainInfo").text("Domain info unavailable (IP fetch failed).");
    $("#geoDetails").html("<tr><td colspan='2'>Geolocation unavailable.</td></tr>");
  });
}

function fetchDomainInfo(ip) {
  // For domain info, just display IP and browser location info
  let domain = {
    hostname: window.location.hostname,
    href: window.location.href,
    protocol: window.location.protocol,
    port: window.location.port || "default"
  };
  $("#domainInfo").text(JSON.stringify(domain, null, 2));
}

let map;
let marker;

function fetchGeoDetails(ip) {
  const $tbl = $("#geoDetails"); $tbl.empty();
  $.getJSON("https://ip-api.com/json/" + ip, function(data) {
    function addRow(k,v){ $tbl.append(`<tr><th>${k}</th><td>${v}</td></tr>`); }
    addRow("IP", data.query);
    addRow("ISP", data.isp || 'N/A');
    addRow("Org", data.org || 'N/A');
    addRow("City", data.city || 'N/A');
    addRow("Region", data.regionName || 'N/A');
    addRow("Country", data.country || 'N/A');
    addRow("ZIP", data.zip || 'N/A');
    addRow("Timezone", data.timezone || 'N/A');
    addRow("Latitude", data.lat);
    addRow("Longitude", data.lon);

    if(data.lat && data.lon){
      const lat = data.lat, lon = data.lon;
      if(!map){
        map = L.map('geoMap').setView([lat, lon], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);
        marker = L.marker([lat, lon]).addTo(map)
          .bindPopup(`IP: ${data.query}<br>${data.city}, ${data.regionName}, ${data.country}`)
          .openPopup();
      } else {
        map.setView([lat, lon], 10);
        marker.setLatLng([lat, lon]).setPopupContent(`IP: ${data.query}<br>${data.city}, ${data.regionName}, ${data.country}`).openPopup();
      }
    }
  }).fail(function() {
    $tbl.html("<tr><td colspan='2'>Geolocation fetch failed.</td></tr>");
    $('#geoMap').html('<p>Map unavailable.</p>');
  });
}

function runSpeedTest() {
  const url = "https://speed.cloudflare.com/__down?bytes=5000000";
  let start = performance.now();
  $("#speedResults").text("Running test...");
  fetch(url, { cache: "no-store" })
    .then(res => res.blob())
    .then(blob => {
      let end = performance.now();
      let seconds = (end - start) / 1000;
      let sizeMB = blob.size / (1024 * 1024);
      let mbps = (sizeMB * 8) / seconds;
      $("#speedResults").text(`Downloaded ${sizeMB.toFixed(2)} MB in ${seconds.toFixed(2)} s\n≈ ${mbps.toFixed(2)} Mbps`);
    })
    .catch(err => { $("#speedResults").text("Speed test failed: " + err); });
}

$(function(){
  updateConnectionDetails();
  updateDeviceInfo();
  fetchIP();

  window.addEventListener('online', updateConnectionDetails);
  window.addEventListener('offline', updateConnectionDetails);
  if (navigator.connection) navigator.connection.addEventListener('change', updateConnectionDetails);
  $("#testBtn").on("click", runSpeedTest);
});
</script>
</body>
</html>

