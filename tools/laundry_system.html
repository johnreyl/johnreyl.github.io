<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Laundry Shop System (Cloud/Local Sync)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Professional Color Palette (Inspired by Google/Material) */
        :root {
            --color-primary: #03a9f4; /* Light Blue for Laundry */
            --color-success: #34a853; /* Green */
            --color-warning: #fbbc05; /* Yellow/Warning */
            --color-info: #4285f4; /* Lighter Blue */
            --color-text-subtle: #5f6368; /* Gray Text */
            --color-danger: #ea4335; /* Red */
        }

        body { 
            background-color: #f8f9fa; 
            font-family: 'Roboto', sans-serif; 
            padding-top: 60px; /* Padding for fixed navbar */
        }
        .container { 
            max-width: 1050px; 
            margin-top: 0px; /* Adjusted margin for fixed navbar */
        }
        .card { border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); border-radius: 8px; }
        
        /* Custom Colors */
        .bg-primary { background-color: var(--color-primary) !important; }
        .btn-primary { background-color: var(--color-primary); border-color: var(--color-primary); }
        .text-primary { color: var(--color-primary) !important; }

        /* Tabs and List Styling (Modified for Navbar - old nav-tabs active style is now commented out or overridden) */
        .navbar-nav .nav-link.active {
            font-weight: 700;
            color: white !important; /* Active links in the dark navbar should be highlighted, e.g., bright white */
            border-bottom: 3px solid white;
        }
        
        /* Home Tab Specific Styles */
        .home-banner {
            background: linear-gradient(135deg, #03a9f4, #4285f4); 
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        /* Summary Box Styling */
        .summary-box p {
            font-size: 1.8rem;
        }
        .summary-box small {
            font-size: 0.8rem;
        }
        
        /* Loading indicator for Firebase */
        #loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1050;
        }

        /* Custom Loading Overlay used by signInWithGoogle function */
        #auth-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: none; /* Starts hidden */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        /* Cloud Sync Modal Styling - kept original for Firebase login */
        .start-sync-modal-body {
            text-align: center;
            padding: 30px;
        }
        .google-sign-in-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 10px;
            transition: background-color 0.2s;
        }
        .google-sign-in-btn:hover {
            background-color: #357ae8;
        }
        .guest-button {
            background-color: #e9ecef;
            color: #495057;
            border: 1px solid #ced4da;
            width: 100%;
        }

        /* Toast Message Styling */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1060;
        }
        .custom-toast {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(100%);
        }
        .custom-toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* List Group Styling */
        .list-group-item.list-group-item-danger {
            background-color: #f8d7da !important; 
        }
        .list-group-item.list-group-item-warning {
             background-color: #fff3cd !important;
        }
        .text-revenue { color: #008000 !important; }
        .border-left-revenue { border-left-color: #008000 !important; }
        .summary-box p {
            font-size: 1.5rem !important;
        }
        
        /* New Inventory List Item Styling */
        .inventory-item-row:hover {
            cursor: pointer;
            background-color: #f0f0f0; /* Light highlight on hover */
        }
        
        /* Machine Card Styling */
        .machine-card-item {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .machine-card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .machine-card-item .card-footer a {
            color: white !important;
            text-decoration: underline;
        }
        .machine-card-item .card-footer a:hover {
            opacity: 0.8;
        }
    
    /* --- New ID Card Styling for Generate ID Tab --- */
      .id-card-container {
          width: 320px; /* Standard ID card width */
          height: 200px; /* Standard ID card height */
          border: 1px solid var(--color-primary); /* Border using primary color */
          border-radius: 8px;
          padding: 15px;
          background-color: #ffffff;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          margin: 20px auto;
          font-family: Arial, sans-serif;
          position: relative;
          overflow: hidden;
      }
      .id-card-header {
          background-color: var(--color-primary);
          color: white;
          padding: 3px 0;
          text-align: center;
          font-size: 0.9rem;
          font-weight: bold;
          margin: -15px -15px 10px -15px; /* Adjusting for padding */
      }
      .id-card-photo {
          width: 60px;
          height: 60px;
          border: 1px solid #ccc;
          background-color: #f0f0f0;
          margin-right: 10px;
          border-radius: 4px;
          float: left;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.8rem;
          color: #888;
      }
      .id-card-details {
          overflow: hidden;
      }
      .id-card-details p {
          margin-bottom: 3px;
          font-size: 0.8rem;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }
      .id-card-details strong {
          font-weight: bold;
          display: inline-block;
          width: 60px; /* Aligning labels */
      }
      .id-card-id {
          clear: both;
          text-align: center;
          margin-top: 15px;
          font-size: 1.2rem;
          font-weight: 900;
          color: var(--color-danger);
          border-top: 1px dashed #ccc;
          padding-top: 5px;
      }
      .print-area {
          text-align: center;
          margin-top: 20px;
      }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-soap me-2"></i>LAUNDRY SYSTEM
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true" href="#">
                            <i class="fas fa-home me-2"></i>Home
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="new-order-tab" data-bs-toggle="tab" data-bs-target="#new-order" type="button" role="tab" aria-controls="new-order" aria-selected="false" href="#">
                            <i class="fas fa-plus-circle me-2"></i>New Order
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="order-list-tab" data-bs-toggle="tab" data-bs-target="#order-list" type="button" role="tab" aria-controls="order-list" aria-selected="false" href="#">
                            <i class="fas fa-list-check me-2"></i>Order List
                        </a>
                    </li>
                     <li class="nav-item" role="presentation">
                        <a class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab" aria-controls="inventory" aria-selected="false" href="#">
                            <i class="fas fa-boxes-stacked me-2"></i>Detergents
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="available-machines-tab" data-bs-toggle="tab" data-bs-target="#available-machines" type="button" role="tab" aria-controls="available-machines" aria-selected="false" href="#">Machines</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab" aria-controls="reports" aria-selected="false" href="#">
                            <i class="fas fa-chart-line me-2"></i>Reports
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="workforce-tab" data-bs-toggle="tab" data-bs-target="#workforce" type="button" role="tab" aria-controls="workforce" aria-selected="false" href="#">Workforce</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="customers-tab" data-bs-toggle="tab" data-bs-target="#customers" type="button" role="tab" aria-controls="customers" aria-selected="false" href="#">Customers</a>
                    </li>
                </ul>
                
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button id="home-log-out-btn" class="btn btn-outline-danger mt-2 mt-lg-0">
                            <i class="fas fa-sign-out-alt me-2"></i>Log Out
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div id="loading-indicator" class="d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-primary mt-2" id="loading-text">Connecting...</p>
        </div>

        <div id="auth-loading-overlay">
            <div class="spinner-border text-light mb-3" role="status"></div>
            <p class="text-light">Waiting for Google Sign-In...</p>
        </div>

        <div id="toast-container"></div>
        
        <div class="tab-content">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <div class="home-banner mt-4"> <h2>Welcome to Your Laundry Management System!</h2>
                    <p class="mb-0">Track your orders and inventory. Data is saved securely in the <span id="banner-storage-mode-hidden" class="fw-bold">...</span></p>
                </div>
                
                <div class="row g-4 mb-4" id="summary-statistics">
                    <div class="col-md-4">
                        <div class="card p-3 summary-box border-left-revenue" style="border-left: 5px solid var(--color-primary);">
                            <p class="text-primary fw-bold mb-0" id="total-orders-card">0</p>
                            <small class="text-muted">Total Orders (All Time)</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                         <div class="card p-3 summary-box" style="border-left: 5px solid var(--color-warning);">
                            <p class="text-warning fw-bold mb-0" id="remaining-orders-card">0</p>
                            <small class="text-muted">Orders In Progress</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                         <div class="card p-3 summary-box" style="border-left: 5px solid var(--color-success);">
                            <p class="text-success fw-bold mb-0" id="total-client-payment-card">₱0.00</p>
                            <small class="text-muted">Total Revenue (All Time)</small>
                        </div>
                    </div>
                </div>

                <div class="card p-4">
                    <h5 class="text-primary mb-4"><i class="fas fa-grip me-2"></i>Main System Dashboard</h5>
                    <p class="mb-4">Data storage mode: <span id="banner-storage-mode" class="fw-bold">...</span></p>
                    
                    <div class="row g-3" id="home-buttons-dashboard">
                        <div class="col-md-4"><button data-target-tab="#order-list" class="btn btn-primary w-100 py-3 home-nav-btn"><i class="fas fa-list-check me-2"></i>Laundry Requests</button></div>
                        <div class="col-md-4"><button data-target-tab="#reports" class="btn btn-primary w-100 py-3 home-nav-btn"><i class="fas fa-chart-line me-2"></i>Reports</button></div>
                        <div class="col-md-4"><button data-target-tab="#inventory" class="btn btn-primary w-100 py-3 home-nav-btn"><i class="fas fa-boxes-stacked me-2"></i>Inventory</button></div>
                        
                        <div class="col-md-4"><button data-target-tab="#available-machines" class="btn btn-info w-100 py-3 home-nav-btn"><i class="fas fa-washing-machine me-2"></i>Available Machines</button></div>
                        <div class="col-md-4"><button data-target-tab="#workforce" class="btn btn-info w-100 py-3 home-nav-btn"><i class="fas fa-users-gear me-2"></i>Workforce</button></div>
                        <div class="col-md-4"><button data-target-tab="#customers" class="btn btn-info w-100 py-3 home-nav-btn"><i class="fas fa-user-friends me-2"></i>Customers</button></div>
                        
                        </div>
                </div>

                <div id="home-complex-data" class="d-none">
                     
                    
                    <div class="row g-4">
                        </div>
                </div>
            </div>

            <div class="tab-pane fade" id="new-order" role="tabpanel" aria-labelledby="new-order-tab">
                <div class="card p-4 mt-4"> <h5 class="card-title text-primary mb-3"><i class="fas fa-soap me-2"></i>New Laundry Order Details</h5>
                    <form id="order-form" class="row g-3">
                        
                        <div class="col-12 mt-1 mb-0"><h6 class="text-info"><i class="fas fa-user me-2"></i>Customer Details</h6><hr class="mt-1 mb-2"></div>

                        <div class="col-md-3"><label for="customer-name" class="form-label text-muted-subtle">Customer Name</label><input type="text" class="form-control" id="customer-name" placeholder="e.g., Jane Doe"></div>
                        <div class="col-md-3"><label for="customer-phone-number" class="form-label text-muted-subtle">Phone Number</label><input type="tel" class="form-control" id="customer-phone-number" placeholder="e.g., +1 (555) 123-4567"></div>
                        <div class="col-md-6"><label for="customer-email" class="form-label text-muted-subtle">Customer Email (Optional)</label><input type="email" class="form-control" id="customer-email" placeholder="e.g., customer@example.com"></div>
                        
                        <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-shirt me-2"></i>Service Details & Weight</h6><hr class="mt-1 mb-2"></div>
                        
                        <div class="col-md-3">
                            <label for="service-type" class="form-label text-muted-subtle">Service Type</label>
                            <select class="form-select" id="service-type" required>
                                <option value="Wash & Fold" selected>Wash & Fold</option>
                                <option value="Dry Cleaning">Dry Cleaning</option>
                                <option value="Self Service">Self Service</option>
                                <option value="Pressing Only">Pressing Only</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="load-type" class="form-label text-muted-subtle">Load Type/Preference</label>
                            <select class="form-select" id="load-type" required>
                                <option value="Standard Detergent" selected>Standard Detergent</option>
                                <option value="Sensitive Skin">Sensitive Skin</option>
                                <option value="Organic Wash">Organic Wash</option>
                                <option value="Bleach Added">Bleach Added</option>
                                <option value="Heavy Duty">Heavy Duty</option>
                            </select>
                        </div>
                        <div class="col-md-3"><label for="weight-kg" class="form-label text-muted-subtle">Weight (kg) / Item Count</label><input type="number" step="0.1" min="0" class="form-control" id="weight-kg" required value="0"></div>
                        <div class="col-md-3"><label for="detergent-used" class="form-label text-muted-subtle">Detergent Units Used</label><input type="number" step="0.5" min="0" class="form-control" id="detergent-used" value="1"></div>
                        
                        <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-hand-holding-dollar me-2"></i>Financial & Personnel</h6><hr class="mt-1 mb-2"></div>
                        
                        <div class="col-md-3"><label for="staff-in-charge" class="form-label text-muted-subtle">Staff In Charge</label><input type="text" class="form-control" id="staff-in-charge" placeholder="e.g., Manager A"></div>
                        
                        <div class="col-md-3"><label for="base-cost" class="form-label text-muted-subtle">Base Service Cost (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="base-cost" value="0.00"></div>
                        <div class="col-md-3"><label for="deposit" class="form-label text-muted-subtle">Deposit Received (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="deposit" value="0.00"></div>
                        
                        <div class="col-md-3"><label for="total-price" class="form-label text-muted-subtle">Total Price (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="total-price" value="0.00" required></div>
                        
                        <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-calendar-alt me-2"></i>Pickup & Notes</h6><hr class="mt-1 mb-2"></div>

                        <div class="col-md-3"><label for="pickup-date" class="form-label text-muted-subtle">Est. Pickup Date</label><input type="date" class="form-control" id="pickup-date" required></div>
                        <div class="col-md-3"><label for="pickup-time" class="form-label text-muted-subtle">Est. Pickup Time</label><input type="time" class="form-control" id="pickup-time" value=""></div>

                        <div class="col-md-6"><label for="notes" class="form-label text-muted-subtle">Notes (Stains, Special Instructions)</label><textarea class="form-control" id="notes" rows="1" placeholder="e.g., Stain on collar. Do not use heat dry."></textarea></div>
                        
                        <div class="col-12 text-end"><button type="submit" class="btn btn-primary mt-3"><i class="fas fa-save me-2"></i>Save Order</button></div>
                    </form>
                </div>
            </div>

            <div class="tab-pane fade" id="order-list" role="tabpanel" aria-labelledby="order-list-tab">
                 <div class="card p-4 mb-3 mt-4"> <h5 class="text-primary mb-3"><i class="fas fa-plus-circle me-2"></i>New Order Shortcut</h5>
                     <button id="add-new-order-btn" class="btn btn-success w-100"><i class="fas fa-plus me-2"></i>Add New Laundry Order</button>
                 </div>
                <div class="card rounded-top-0">
                    <ul id="order-list-ul" class="list-group list-group-flush">
                        <li class="list-group-item text-center text-muted-subtle">Orders will load after successful setup.</li>
                    </ul>
                </div>
                
                <div id="order-pagination-controls" class="d-flex justify-content-between align-items-center p-3 border-top bg-light rounded-bottom flex-wrap">
                    <button id="prev-page-btn" class="btn btn-outline-primary btn-sm mb-2 mb-sm-0" disabled><i class="fas fa-chevron-left me-1"></i> Previous</button>
                    <span id="page-info" class="text-muted-subtle mx-auto mb-2 mb-sm-0" style="font-size: 0.9rem;">Page 0 of 0</span>
                    <button id="next-page-btn" class="btn btn-outline-primary btn-sm" disabled>Next <i class="fas fa-chevron-right ms-1"></i></button>
                </div>
            </div>
            
            <div class="tab-pane fade" id="inventory" role="tabpanel" aria-labelledby="inventory-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="inventoryMainTabs" role="tablist"> <li class="nav-item" role="presentation">
                        <button class="nav-link" id="inventory-add-tab" data-bs-toggle="tab" data-bs-target="#tab-inventory-add" type="button" role="tab" aria-controls="tab-inventory-add" aria-selected="false"><i class="fas fa-cart-plus me-2"></i>Add New Stock</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="inventory-view-tab" data-bs-toggle="tab" data-bs-target="#tab-inventory-view" type="button" role="tab" aria-controls="tab-inventory-view" aria-selected="true"><i class="fas fa-boxes-stacked me-2"></i>Current Inventory</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="inventoryMainTabContent">
                    
                    <div class="tab-pane fade show active" id="tab-inventory-view" role="tabpanel" aria-labelledby="inventory-view-tab">
                        
                        <div id="low-stock-alert" class="alert alert-warning d-none" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Low on Stock!</strong> The following items need immediate reordering: 
                            <ul id="low-stock-list" class="mt-2 mb-0"></ul>
                        </div>
        
                        <div class="card mb-4">
                            <div class="card-header bg-white border-bottom p-3">
                                <button class="btn btn-block w-100 text-start d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#inventoryFilterCollapse" aria-expanded="false" aria-controls="inventoryFilterCollapse">
                                    <h5 class="text-primary mb-0"><i class="fas fa-filter me-2"></i>Inventory Filters</h5>
                                    <i class="fas fa-chevron-up text-muted-subtle"></i>
                                </button>
                            </div>
                            <div class="collapse" id="inventoryFilterCollapse">
                                <div class="card-body p-4">
                                    <form id="inventory-filter-form" class="row g-3">
                                        <div class="col-md-4">
                                            <label for="filter-name" class="form-label text-muted-subtle">Item Name/Category</label>
                                            <input type="text" class="form-control" id="filter-name" placeholder="Search name or type...">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="filter-type" class="form-label text-muted-subtle">Item Type</label>
                                            <select class="form-select" id="filter-type">
                                                <option value="">All Types</option>
                                                <option value="Detergent">All Detergents</option>
                                                <option value="Liquid">Liquid</option>
                                                <option value="Powder">Powder</option>
                                                <option value="Pods">Pods/Unit</option>
                                                <option value="Softener">Softener</option>
                                                <option value="Special">Special</option>
                                                </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="filter-vendor" class="form-label text-muted-subtle">Vendor</label>
                                            <input type="text" class="form-control" id="filter-vendor" placeholder="Search vendor name...">
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-outline-secondary me-2" id="clear-inventory-filter-btn"><i class="fas fa-redo me-1"></i> Clear Filter</button>
                                            <button type="submit" class="btn btn-primary"><i class="fas fa-search me-1"></i> Apply Filter</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-list me-2"></i>Current Inventory Stock (Click an item to update)</h5>
                            <ul id="inventory-list" class="list-group list-group-flush">
                                <li class="list-group-item text-center text-muted-subtle">Inventory will load here.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="tab-inventory-add" role="tabpanel" aria-labelledby="inventory-add-tab">
                        
                        <div class="card p-4 mb-4">
                            <h5 class="card-title text-success mb-3"><i class="fas fa-soap me-2"></i>Add New Detergent Stock</h5>
                            
                            <div class="tab-content" id="inventoryFormsTabContent">
                                <form id="detergent-form" class="row g-3">
                                    <div class="col-md-3">
                                        <label for="detergent-name" class="form-label text-muted-subtle">Detergent Name</label>
                                        <input type="text" class="form-control" id="detergent-name" list="detergent-recommendations" placeholder="e.g., Tide Pods" required>
                                        <datalist id="detergent-recommendations"></datalist>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="detergent-type" class="form-label text-muted-subtle">Type</label>
                                        <select class="form-select" id="detergent-type" required>
                                            <option value="Liquid">Liquid</option>
                                            <option value="Powder">Powder</option>
                                            <option value="Pods">Pods/Unit</option>
                                            <option value="Softener">Softener</option>
                                            <option value="Special">Special</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2"><label for="detergent-qty" class="form-label text-muted-subtle">Quantity (Units)</label><input type="number" min="0" class="form-control" id="detergent-qty" required value="1"></div>
                                    <div class="col-md-2"><label for="detergent-cost" class="form-label text-muted-subtle">Cost Per Unit (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="detergent-cost" value="0.00" required></div>
                                    <div class="col-md-2"><label for="detergent-vendor" class="form-label text-muted-subtle">Vendor</label><input type="text" class="form-control" id="detergent-vendor" placeholder="e.g., Supplier X"></div>
                                    
                                    <div class="col-12 text-end"><button type="submit" class="btn btn-success mt-2"><i class="fas fa-boxes-stacked me-2"></i>Add/Update Stock</button></div>
                                </form>
                                
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
                 <div class="row g-4 mt-4"> <div class="col-md-12">
                         <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-chart-line me-2"></i>Financial Overview</h5>
                            
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="card p-3" style="border-left: 5px solid var(--color-success);">
                                        <p class="text-success fw-bold mb-0" id="total-client-payment">₱0.00</p>
                                        <small class="text-muted">Total Client Payments</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card p-3" style="border-left: 5px solid var(--color-danger);">
                                        <p class="text-danger fw-bold mb-0" id="grand-total-cost">₱0.00</p>
                                        <small class="text-muted">Total Estimated Expenses</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card p-3" style="border-left: 5px solid var(--color-info);">
                                        <p class="text-info fw-bold mb-0" id="total-net-revenue">₱0.00</p>
                                        <small class="text-muted">Net Revenue (Est.)</small>
                                    </div>
                                </div>
                                
                                <div class="col-12"><hr></div>

                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="total-orders">0</p>
                                        <small class="text-muted">Total Orders</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="remaining-orders">0</p>
                                        <small class="text-muted">Unfinished Orders</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="total-weight-kg">0.0 kg</p>
                                        <small class="text-muted">Total Weight Processed</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="revenue-per-kg">₱0.00</p>
                                        <small class="text-muted">Revenue Per Kg</small>
                                    </div>
                                </div>

                                <div class="col-12"><hr></div>
                                
                                <div class="col-md-4">
                                    <small class="text-muted">Cost Breakdown:</small>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between">Base Service Cost: <span id="total-cost-est">₱0.00</span></li>
                                        <li class="list-group-item d-flex justify-content-between">Additional Charges: <span id="total-additional-cost">₱0.00</span></li>
                                        <li class="list-group-item d-flex justify-content-between">Est. Detergent/Supplies Cost: <span id="total-detergent-cost">₱0.00</span></li>
                                    </ul>
                                </div>
                            </div>
                            
                            </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="available-machines" role="tabpanel" aria-labelledby="available-machines-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="machineMainTabs" role="tablist"> <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="machines-view-tab" data-bs-toggle="tab" data-bs-target="#tab-machines-view" type="button" role="tab" aria-controls="tab-machines-view" aria-selected="true"><i class="fas fa-th-large me-2"></i>Machines Status</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="machine-add-tab" data-bs-toggle="tab" data-bs-target="#tab-machine-add" type="button" role="tab" aria-controls="tab-machine-add" aria-selected="false"><i class="fas fa-plus-circle me-2"></i>Add New Machine</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="machineMainTabContent">
                    
                    <div class="tab-pane fade show active" id="tab-machines-view" role="tabpanel" aria-labelledby="machines-view-tab">
                         <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-list-check me-2"></i>Current Machine Status Overview</h5>
                            <div class="row g-4" id="machines-grid-list">
                                <div class="col-12 text-center text-muted-subtle" id="machines-grid-placeholder">Machines will load here.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="tab-machine-add" role="tabpanel" aria-labelledby="machine-add-tab">
                         <div class="card p-4 mb-4">
                            <h5 class="text-info card-title mb-3"><i class="fas fa-washing-machine me-2"></i>Add New Machine Setup</h5>
                            <form id="machine-form" class="row g-3">
                                <div class="col-md-3"><label for="machine-name" class="form-label text-muted-subtle">Machine Name/ID</label><input type="text" class="form-control" id="machine-name" placeholder="e.g., Washer #1 / Dryer #A" required></div>
                                <div class="col-md-3">
                                    <label for="machine-type" class="form-label text-muted-subtle">Machine Type</label>
                                    <select class="form-select" id="machine-type" required>
                                        <option value="Washer">Washer</option>
                                        <option value="Dryer">Dryer</option>
                                    </select>
                                </div>
                                <div class="col-md-2"><label for="machine-capacity" class="form-label text-muted-subtle">Capacity (kg)</label><input type="number" step="0.1" min="1" class="form-control" id="machine-capacity" required value="10.0"></div>
                                <div class="col-md-4"><label for="machine-purchase-date" class="form-label text-muted-subtle">Date Purchase</label><input type="date" class="form-control" id="machine-purchase-date"></div>
                                <div class="col-md-9"><label for="machine-notes" class="form-label text-muted-subtle">Notes (Model, Location)</label><textarea class="form-control" id="machine-notes" rows="1"></textarea></div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <div class="form-check form-switch w-100">
                                        <input class="form-check-input" type="checkbox" role="switch" id="machine-under-maintenance">
                                        <label class="form-check-label" for="machine-under-maintenance">Under Maintenance</label>
                                    </div>
                                </div>
                                <div class="col-12 text-end"><button type="submit" class="btn btn-info mt-2"><i class="fas fa-save me-2"></i>Save Machine</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="workforce" role="tabpanel" aria-labelledby="workforce-tab">
                <div class="card p-4 mb-4 mt-4">
                    <h5 class="text-success card-title mb-3"><i class="fas fa-user-plus me-2"></i>Add New Employee</h5>
                    <form id="workforce-form" class="row g-3">
                        <div class="col-md-3"><label for="employee-name" class="form-label text-muted-subtle">Employee Name</label><input type="text" class="form-control" id="employee-name" required placeholder="e.g., John Smith"></div>
                        <div class="col-md-3">
                            <label for="employee-type" class="form-label text-muted-subtle">Employee Type</label>
                            <select class="form-select" id="employee-type" required>
                                <option value="Agent">Agent (Shop)</option>
                                <option value="Delivery">Delivery (Driver)</option>
                                <option value="Driver">Driver (Logistics)</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>
                        <div class="col-md-3"><label for="employee-salary" class="form-label text-muted-subtle">Base Salary (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="employee-salary" value="0.00" required></div>
                        <div class="col-md-3">
                            <label for="employee-rate-type" class="form-label text-muted-subtle">Rate Type</label>
                            <select class="form-select" id="employee-rate-type" required>
                                <option value="Monthly">Monthly Rate</option>
                                <option value="Daily">Daily Rate</option>
                            </select>
                        </div>
                        <div class="col-12 text-end"><button type="submit" class="btn btn-success mt-2"><i class="fas fa-user-check me-2"></i>Add Employee</button></div>
                    </form>
                </div>
                <div class="card p-4">
                    <h5 class="text-primary mb-3"><i class="fas fa-users-gear me-2"></i>Current Workforce</h5>
                    <ul id="workforce-list" class="list-group list-group-flush">
                        <li class="list-group-item text-center text-muted-subtle">Workforce will load here.</li>
                    </ul>
                </div>
            </div>

            <div class="tab-pane fade" id="customers" role="tabpanel" aria-labelledby="customers-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="customerMainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="customer-add-tab" data-bs-toggle="tab" data-bs-target="#tab-customer-add" type="button" role="tab" aria-controls="tab-customer-add" aria-selected="false"><i class="fas fa-address-card me-2"></i>Register New</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="customer-view-tab" data-bs-toggle="tab" data-bs-target="#tab-customer-view" type="button" role="tab" aria-controls="tab-customer-view" aria-selected="true"><i class="fas fa-user-friends me-2"></i>Customer List</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="customer-id-tab" data-bs-toggle="tab" data-bs-target="#tab-customer-id" type="button" role="tab" aria-controls="tab-customer-id" aria-selected="false"><i class="fas fa-qrcode me-2"></i>Generate ID Card</button>
                    </li>
                </ul>

                <div class="tab-content" id="customerMainTabContent">
                    <div class="tab-pane fade" id="tab-customer-add" role="tabpanel" aria-labelledby="customer-add-tab">
                        <div class="card p-4 mb-4"> 
                            <h5 class="text-info card-title mb-3"><i class="fas fa-address-card me-2"></i>Register New Customer</h5>
                            <form id="customer-form" class="row g-3">
                                <div class="col-md-4"><label for="customer-reg-name" class="form-label text-muted-subtle">Full Name</label><input type="text" class="form-control" id="customer-reg-name" required placeholder="e.g., Jane Doe"></div>
                                <div class="col-md-2"><label for="customer-reg-contact" class="form-label text-muted-subtle">Contact Number</label><input type="tel" class="form-control" id="customer-reg-contact" required placeholder="e.g., 09xxxxxxxxx"></div>
                                <div class="col-md-2"><label for="customer-reg-age" class="form-label text-muted-subtle">Age</label><input type="number" min="1" class="form-control" id="customer-reg-age" placeholder="e.g., 35"></div>
                                <div class="col-md-4"><label for="customer-reg-address" class="form-label text-muted-subtle">Address</label><input type="text" class="form-control" id="customer-reg-address" placeholder="e.g., 123 Main St."></div>
                                <div class="col-12 text-end"><button type="submit" class="btn btn-info mt-2"><i class="fas fa-user-check me-2"></i>Register Customer</button></div>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane fade show active" id="tab-customer-view" role="tabpanel" aria-labelledby="customer-view-tab">
                        <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-list me-2"></i>Registered Customer List (Click to Edit)</h5>
                            <ul id="customer-list" class="list-group list-group-flush">
                                <li class="list-group-item text-center text-muted-subtle">Customer list will load here.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="tab-customer-id" role="tabpanel" aria-labelledby="customer-id-tab">
                        <div class="card p-4 mb-4 mt-4">
                            <h5 class="text-primary card-title mb-3"><i class="fas fa-qrcode me-2"></i>Generate Customer ID Card</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="id-customer-select" class="form-label text-muted-subtle">Select Customer</label>
                                    <select class="form-select" id="id-customer-select" required>
                                        <option value="">Select a customer to generate ID</option>
                                    </select>
                                </div>
                                <div class="col-md-6 d-flex align-items-end">
                                    <button type="button" class="btn btn-primary w-100" id="generate-id-card-btn"><i class="fas fa-file-invoice me-2"></i>Generate ID Preview</button>
                                </div>
                            </div>
                            
                            <div id="id-card-print-area" class="id-card-container d-none">
                                <div class="id-card-header">
                                    LAUNDRY SHOP CUSTOMER ID
                                </div>
                                <div class="id-card-photo">
                                    NO PHOTO
                                </div>
                                <div class="id-card-details">
                                    <p><strong>Name:</strong> <span id="id-card-name"></span></p>
                                    <p><strong>Contact:</strong> <span id="id-card-contact"></span></p>
                                    <p><strong>Address:</strong> <span id="id-card-address"></span></p>
                                    <p><strong>Age:</strong> <span id="id-card-age"></span></p>
                                </div>
                                <div class="id-card-id" id="id-card-unique-id">
                                    UNIQUE ID HERE
                                </div>
                            </div>
                            
                            <div class="print-area mt-4 d-none" id="id-card-print-buttons">
                                <button class="btn btn-success" onclick="window.print()"><i class="fas fa-print me-2"></i>Print ID Card</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="orderDetailModalLabel"><i class="fas fa-edit me-2"></i>Order ID: <span id="modal-order-id-display" class="fw-bold">...</span></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-4">
            <form id="order-detail-form" class="row g-3">
                <input type="hidden" id="modal-order-id">
                <input type="hidden" id="modal-order-timestamp">

                <div class="col-12 mt-1 mb-0"><h6 class="text-info"><i class="fas fa-user me-2"></i>Customer Details</h6><hr class="mt-1 mb-2"></div>
                <div class="col-md-4"><label for="modal-customer-name" class="form-label text-muted-subtle">Customer Name</label><input type="text" class="form-control" id="modal-customer-name" required></div>
                <div class="col-md-4"><label for="modal-customer-phone-number" class="form-label text-muted-subtle">Phone</label><input type="tel" class="form-control" id="modal-customer-phone-number"></div>
                <div class="col-md-4"><label for="modal-customer-email" class="form-label text-muted-subtle">Email (Optional)</label><input type="email" class="form-control" id="modal-customer-email"></div>

                <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-shirt me-2"></i>Service & Weight</h6><hr class="mt-1 mb-2"></div>
                <div class="col-md-4">
                    <label for="modal-service-type" class="form-label text-muted-subtle">Service Type</label>
                    <select class="form-select" id="modal-service-type" required>
                        <option value="Wash & Fold">Wash & Fold</option>
                        <option value="Dry Cleaning">Dry Cleaning</option>
                        <option value="Self Service">Self Service</option>
                        <option value="Pressing Only">Pressing Only</option>
                    </select>
                </div>
                <div class="col-md-4"><label for="modal-weight-kg" class="form-label text-muted-subtle">Weight (kg) / Count</label><input type="number" step="0.1" min="0" class="form-control" id="modal-weight-kg" required></div>
                <div class="col-md-4"><label for="modal-detergent-used" class="form-label text-muted-subtle">Detergent Units Used</label><input type="number" step="0.5" min="0" class="form-control" id="modal-detergent-used"></div>
                
                <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-hand-holding-dollar me-2"></i>Financial & Status</h6><hr class="mt-1 mb-2"></div>
                <div class="col-md-3"><label for="modal-base-cost" class="form-label text-muted-subtle">Base Cost (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="modal-base-cost" required></div>
                <div class="col-md-3"><label for="modal-deposit" class="form-label text-muted-subtle">Deposit (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="modal-deposit" required></div>
                <div class="col-md-3"><label for="modal-total-price" class="form-label text-muted-subtle">Total Price (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="modal-total-price" required></div>
                <div class="col-md-3">
                    <label for="modal-status" class="form-label text-muted-subtle">Status</label>
                    <select class="form-select" id="modal-status" required>
                        <option value="Pending">Pending</option>
                        <option value="Washing">Washing</option>
                        <option value="Drying">Drying</option>
                        <option value="Finished">Finished</option>
                        <option value="Collected">Collected</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
                
                <div class="col-md-4">
                    <label for="modal-payment-status" class="form-label text-muted-subtle">Payment Status</label>
                    <select class="form-select" id="modal-payment-status" required>
                        <option value="Unpaid">Unpaid</option>
                        <option value="Partial">Partial (Deposit)</option>
                        <option value="Paid">Paid (Full)</option>
                    </select>
                </div>
                <div class="col-md-4"><label for="modal-staff-in-charge" class="form-label text-muted-subtle">Staff In Charge</label><input type="text" class="form-control" id="modal-staff-in-charge"></div>

                <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-calendar-alt me-2"></i>Pickup & Notes</h6><hr class="mt-1 mb-2"></div>
                <div class="col-md-4"><label for="modal-pickup-date" class="form-label text-muted-subtle">Est. Pickup Date</label><input type="date" class="form-control" id="modal-pickup-date" required></div>
                <div class="col-md-4"><label for="modal-pickup-time" class="form-label text-muted-subtle">Est. Pickup Time</label><input type="time" class="form-control" id="modal-pickup-time"></div>
                <div class="col-md-4"><label for="modal-date-collected" class="form-label text-muted-subtle">Actual Collection Date</label><input type="datetime-local" class="form-control" id="modal-date-collected"></div>
                
                <div class="col-12"><label for="modal-notes" class="form-label text-muted-subtle">Notes (Special Instructions)</label><textarea class="form-control" id="modal-notes" rows="2"></textarea></div>

            </form>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <button type="button" class="btn btn-danger me-auto" id="delete-order-btn"><i class="fas fa-trash-alt me-2"></i>Delete</button>
            <div>
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                 <button type="submit" class="btn btn-primary" form="order-detail-form" id="save-order-changes-btn"><i class="fas fa-save me-2"></i>Save changes</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="inventoryDetailModal" tabindex="-1" aria-labelledby="inventoryDetailModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="inventoryDetailModalLabel"><i class="fas fa-boxes-stacked me-2"></i>Edit Inventory Item: <span id="modal-inventory-name-display" class="fw-bold">...</span></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="inventory-detail-form" class="row g-3">
                <input type="hidden" id="modal-inventory-id">
                
                <div class="col-md-6"><label for="modal-inventory-name" class="form-label text-muted-subtle">Item Name</label><input type="text" class="form-control" id="modal-inventory-name" required></div>
                <div class="col-md-6">
                    <label for="modal-inventory-type" class="form-label text-muted-subtle">Type</label>
                    <select class="form-select" id="modal-inventory-type" required>
                        <option value="Liquid">Liquid</option>
                        <option value="Powder">Powder</option>
                        <option value="Pods">Pods/Unit</option>
                        <option value="Softener">Softener</option>
                        <option value="Special">Special</option>
                    </select>
                </div>
                <div class="col-md-6"><label for="modal-inventory-qty" class="form-label text-muted-subtle">Quantity (Units)</label><input type="number" min="0" class="form-control" id="modal-inventory-qty" required></div>
                <div class="col-md-6"><label for="modal-inventory-cost" class="form-label text-muted-subtle">Cost Per Unit (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="modal-inventory-cost" required></div>
                <div class="col-md-6"><label for="modal-inventory-vendor" class="form-label text-muted-subtle">Vendor</label><input type="text" class="form-control" id="modal-inventory-vendor"></div>
                <div class="col-md-6"><label for="modal-inventory-reorder-level" class="form-label text-muted-subtle">Reorder Level</label><input type="number" min="0" class="form-control" id="modal-inventory-reorder-level" required></div>
            </form>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <button type="button" class="btn btn-danger me-auto" id="delete-inventory-btn"><i class="fas fa-trash-alt me-2"></i>Delete Item</button>
            <div>
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                 <button type="submit" class="btn btn-success" form="inventory-detail-form" id="save-inventory-changes-btn"><i class="fas fa-save me-2"></i>Save changes</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="employeeDetailModal" tabindex="-1" aria-labelledby="employeeDetailModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="employeeDetailModalLabel"><i class="fas fa-user-gear me-2"></i>Edit Employee: <span id="modal-employee-name-display" class="fw-bold">...</span></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="employee-detail-form" class="row g-3">
                <input type="hidden" id="modal-employee-id">
                
                <div class="col-md-6"><label for="modal-employee-name" class="form-label text-muted-subtle">Employee Name</label><input type="text" class="form-control" id="modal-employee-name" required></div>
                <div class="col-md-6">
                    <label for="modal-employee-type" class="form-label text-muted-subtle">Employee Type</label>
                    <select class="form-select" id="modal-employee-type" required>
                        <option value="Agent">Agent (Shop)</option>
                        <option value="Delivery">Delivery (Driver)</option>
                        <option value="Driver">Driver (Logistics)</option>
                        <option value="Manager">Manager</option>
                    </select>
                </div>
                <div class="col-md-6"><label for="modal-employee-salary" class="form-label text-muted-subtle">Base Salary (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="modal-employee-salary" required></div>
                <div class="col-md-6">
                    <label for="modal-employee-rate-type" class="form-label text-muted-subtle">Rate Type</label>
                    <select class="form-select" id="modal-employee-rate-type" required>
                        <option value="Monthly">Monthly Rate</option>
                        <option value="Daily">Daily Rate</option>
                    </select>
                </div>
            </form>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <button type="button" class="btn btn-danger me-auto" id="delete-employee-btn"><i class="fas fa-trash-alt me-2"></i>Fire Employee</button>
            <div>
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                 <button type="submit" class="btn btn-success" form="employee-detail-form" id="save-employee-changes-btn"><i class="fas fa-save me-2"></i>Save changes</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="customerDetailModal" tabindex="-1" aria-labelledby="customerDetailModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title" id="customerDetailModalLabel"><i class="fas fa-user-edit me-2"></i>Edit Customer: <span id="modal-customer-name-display-2" class="fw-bold">...</span></h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="customer-detail-form" class="row g-3">
                <input type="hidden" id="modal-customer-id">
                
                <div class="col-md-12"><label for="modal-customer-name-2" class="form-label text-muted-subtle">Full Name</label><input type="text" class="form-control" id="modal-customer-name-2" required></div>
                <div class="col-md-6"><label for="modal-customer-contact" class="form-label text-muted-subtle">Contact Number</label><input type="tel" class="form-control" id="modal-customer-contact" required></div>
                <div class="col-md-6"><label for="modal-customer-age" class="form-label text-muted-subtle">Age</label><input type="number" min="1" class="form-control" id="modal-customer-age"></div>
                <div class="col-md-12"><label for="modal-customer-address" class="form-label text-muted-subtle">Address</label><input type="text" class="form-control" id="modal-customer-address"></div>
                <div class="col-12"><label for="modal-customer-unique-id" class="form-label text-muted-subtle">System ID</label><input type="text" class="form-control" id="modal-customer-unique-id" readonly></div>
            </form>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <button type="button" class="btn btn-danger me-auto" id="delete-customer-btn"><i class="fas fa-trash-alt me-2"></i>Delete Record</button>
            <div>
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                 <button type="submit" class="btn btn-info" form="customer-detail-form" id="save-customer-changes-btn"><i class="fas fa-save me-2"></i>Save changes</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="startSyncModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="startSyncModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="startSyncModalLabel"><i class="fas fa-cloud me-2"></i>Cloud Sync Setup</h5>
          </div>
          <div class="modal-body start-sync-modal-body">
            <p>Choose a data storage method to begin:</p>
            <button id="google-sign-in-btn" class="google-sign-in-btn"><i class="fab fa-google me-2"></i>Sync with Google (Cloud)</button>
            <p class="text-muted-subtle mt-2 mb-2">or</p>
            <button id="continue-as-guest-btn" class="btn guest-button"><i class="fas fa-desktop me-2"></i>Use Local Storage Only</button>
            <small class="d-block mt-3 text-muted">Cloud Sync requires a Firebase setup in the script. Local storage is browser-only and can be cleared.</small>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // ====================================================================
        // GLOBAL VARIABLES
        // ====================================================================
        let storageMode = 'local'; // 'local' or 'cloud'
        let firebaseApp = null;
        let auth = null;
        let database = null;
        let userId = 'local_user'; // Default user ID for local mode
        const PAGE_SIZE = 10;
        let currentPage = 1;

        // ====================================================================
        // UTILITY FUNCTIONS
        // ====================================================================

        /**
         * Displays a custom toast notification.
         * @param {string} message - The message to display.
         * @param {string} type - 'success', 'error', 'warning', 'info'.
         */
        const showToast = (message, type = 'info') => {
            const container = $('#toast-container');
            const toast = $('<div>').addClass('custom-toast');

            let icon = '';
            let bgColor = '#333';
            switch (type) {
                case 'success': icon = '<i class="fas fa-check-circle me-2"></i>'; bgColor = '#34a853'; break;
                case 'error': icon = '<i class="fas fa-times-circle me-2"></i>'; bgColor = '#ea4335'; break;
                case 'warning': icon = '<i class="fas fa-exclamation-triangle me-2"></i>'; bgColor = '#fbbc05'; break;
                case 'info':
                default: icon = '<i class="fas fa-info-circle me-2"></i>'; bgColor = '#4285f4'; break;
            }

            toast.css('background-color', bgColor);
            toast.html(`${icon}${message}`);
            container.append(toast);

            // Show and hide logic
            setTimeout(() => {
                toast.addClass('show');
            }, 50);

            setTimeout(() => {
                toast.removeClass('show');
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 3000);
        };

        /**
         * Returns a formatted timestamp string.
         * @returns {string} Current timestamp (YYYY-MM-DD HH:mm:ss).
         */
        const getTimestamp = () => {
            const now = new Date();
            return now.toISOString().replace('T', ' ').substring(0, 19);
        };
        
        /**
         * Generates a simple unique ID using timestamp and a random number.
         * @returns {string} Unique ID.
         */
        const generateUniqueID = (prefix = '') => {
            const datePart = Date.now().toString(36); // Base 36 timestamp
            const randomPart = Math.random().toString(36).substring(2, 6); // Random 4 chars
            return prefix + datePart + randomPart;
        };

        // ====================================================================
        // DATA STORAGE & SYNC FUNCTIONS (LOCAL & FIREBASE)
        // ====================================================================

        /**
         * Gets the appropriate storage key based on the storage mode and user ID.
         * @param {string} key - The base key (e.g., 'orders').
         * @returns {string} The full key for localStorage or Firebase path.
         */
        const getStorageKey = (key) => {
            return storageMode === 'cloud' ? `${userId}/${key}` : key;
        };
        
        /**
         * Initializes local data stores if they don't exist.
         */
        const initializeData = () => {
            const keys = ['orders', 'inventory', 'machines', 'workforce', 'customers'];
            keys.forEach(key => {
                if (localStorage.getItem(key) === null) {
                    localStorage.setItem(key, JSON.stringify({}));
                }
            });
        };

        /**
         * Saves data to local storage.
         * @param {string} key - The base key.
         * @param {object} data - The data object to save.
         */
        const saveLocalData = (key, data) => {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                showToast(`Error saving local data for ${key}: ${e.message}`, 'error');
                return false;
            }
        };

        /**
         * Loads data from local storage.
         * @param {string} key - The base key.
         * @returns {object} The loaded data object, or an empty object on error/missing.
         */
        const loadLocalData = (key) => {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : {};
            } catch (e) {
                showToast(`Error loading local data for ${key}: ${e.message}`, 'error');
                return {};
            }
        };

        // --- FIREBASE/CLOUD SYNC FUNCTIONS (Mocked setup for security) ---
        
        // NOTE: Replace these with your actual Firebase configuration!
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        /**
         * Initializes Firebase if not already done.
         */
        const initFirebase = () => {
             if (typeof firebase !== 'undefined' && firebase.apps.length === 0) {
                 try {
                     firebaseApp = firebase.initializeApp(firebaseConfig);
                     auth = firebaseApp.auth();
                     database = firebaseApp.database();
                     showToast('Firebase initialized successfully.', 'success');
                 } catch (e) {
                      // This is a common error if Firebase is already initialized
                      if (!e.message.includes('already been initialized')) {
                         showToast(`Firebase Init Error: ${e.message}`, 'error');
                      }
                 }
             } else if (typeof firebase !== 'undefined' && !firebaseApp) {
                 // Get the already initialized app
                 firebaseApp = firebase.app();
                 auth = firebaseApp.auth();
                 database = firebaseApp.database();
             }
        };

        /**
         * Handles Google Sign-In for Cloud Sync.
         */
        const signInWithGoogle = async () => {
            $('#auth-loading-overlay').fadeIn();
            
            if (typeof firebase === 'undefined' || typeof firebase.auth.GoogleAuthProvider === 'undefined') {
                showToast('Firebase SDKs not loaded. Cannot sign in.', 'error');
                $('#auth-loading-overlay').fadeOut();
                return;
            }

            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                // Auth state observer will handle the rest
            } catch (error) {
                showToast(`Google Sign-In Failed: ${error.message}`, 'error');
                $('#auth-loading-overlay').fadeOut();
            }
        };
        
        /**
         * Writes a data object to Firebase Realtime Database.
         * @param {string} key - The base key (e.g., 'orders').
         * @param {object} data - The data object to save.
         */
        const writeCloudData = (key, data) => {
            if (database) {
                const path = getStorageKey(key);
                database.ref(path).set(data)
                    .then(() => {
                        showToast(`Cloud data saved for ${key}.`, 'success');
                    })
                    .catch(error => {
                        showToast(`Cloud Save Error for ${key}: ${error.message}`, 'error');
                    });
            } else {
                 showToast('Cloud database is not initialized. Cannot save.', 'error');
            }
        };
        
        /**
         * Reads data from Firebase Realtime Database.
         * @param {string} key - The base key.
         * @returns {Promise<object>} A promise that resolves with the data.
         */
        const readCloudData = (key) => {
            return new Promise((resolve, reject) => {
                if (database) {
                    const path = getStorageKey(key);
                    database.ref(path).once('value')
                        .then(snapshot => {
                            resolve(snapshot.val() || {});
                        })
                        .catch(error => {
                            showToast(`Cloud Read Error for ${key}: ${error.message}`, 'error');
                            reject({});
                        });
                } else {
                    reject({});
                }
            });
        };
        
        /**
         * Master sync function: pull cloud data and merge/overwrite local data.
         */
        const syncToCloud = async (isInitialSetup = false) => {
             const keys = ['orders', 'inventory', 'machines', 'workforce', 'customers'];
             let syncSuccess = true;
             
             $('#loading-indicator').removeClass('d-none');
             $('#loading-text').text('Syncing data...');

             for (const key of keys) {
                 try {
                     const cloudData = await readCloudData(key);
                     saveLocalData(key, cloudData); // Overwrite local data with cloud data
                 } catch (e) {
                     syncSuccess = false;
                     // In initial setup, if cloud read fails, we just fall back to local data.
                     if (!isInitialSetup) {
                         showToast(`Failed to sync ${key} from cloud.`, 'error');
                     }
                 }
             }
             
             $('#loading-indicator').addClass('d-none');
             
             if (syncSuccess) {
                 showToast('Cloud Sync successful. All data updated.', 'success');
             }

             // Always refresh UI after attempting sync
             refreshUI();
        };
        
        // ====================================================================
        // ORDER MANAGEMENT FUNCTIONS
        // ====================================================================
        
        /**
         * Saves a new order or updates an existing one.
         * @param {object} newOrder - The order object.
         */
        const saveOrderData = (newOrder) => {
            const orders = loadLocalData('orders');
            orders[newOrder.id] = newOrder;

            if (storageMode === 'local') {
                saveLocalData('orders', orders);
                showToast(`Order ID ${newOrder.id} saved to local storage.`, 'success');
            } else {
                writeCloudData('orders', orders);
            }
             
            refreshUI();
        };

        /**
         * Updates an existing order.
         * @param {object} updatedOrder - The order object with changes.
         */
        const updateOrderData = (updatedOrder) => {
            saveOrderData(updatedOrder);
        };
        
        /**
         * Deletes an order by ID.
         * @param {string} orderId - The ID of the order to delete.
         */
        const deleteOrderData = (orderId) => {
            const orders = loadLocalData('orders');
            delete orders[orderId];
            
            if (storageMode === 'local') {
                saveLocalData('orders', orders);
                showToast(`Order ID ${orderId} deleted locally.`, 'warning');
            } else {
                writeCloudData('orders', orders);
            }
             
            refreshUI();
        };

        /**
         * Renders the order list with pagination.
         */
        const renderOrderList = () => {
            const orders = loadLocalData('orders');
            const ordersArray = Object.values(orders).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const listElement = $('#order-list-ul');
            listElement.empty();
            
            const totalPages = Math.ceil(ordersArray.length / PAGE_SIZE);
            const start = (currentPage - 1) * PAGE_SIZE;
            const end = currentPage * PAGE_SIZE;
            const paginatedOrders = ordersArray.slice(start, end);
            
            $('#page-info').text(`Page ${ordersArray.length === 0 ? 0 : currentPage} of ${totalPages}`);
            $('#prev-page-btn').prop('disabled', currentPage === 1 || ordersArray.length === 0);
            $('#next-page-btn').prop('disabled', currentPage === totalPages || ordersArray.length === 0);

            if (paginatedOrders.length === 0) {
                 listElement.append('<li class="list-group-item text-center text-muted-subtle">No orders found.</li>');
                 return;
            }

            paginatedOrders.forEach(order => {
                let statusClass = '';
                let statusTextClass = '';
                let statusIcon = 'fas fa-spinner fa-spin';

                switch (order.status) {
                    case 'Pending':
                        statusClass = 'list-group-item-light';
                        statusTextClass = 'text-info';
                        statusIcon = 'fas fa-hourglass-start';
                        break;
                    case 'Washing':
                    case 'Drying':
                        statusClass = 'list-group-item-warning';
                        statusTextClass = 'text-warning';
                        statusIcon = 'fas fa-tshirt';
                        break;
                    case 'Finished':
                        statusClass = 'list-group-item-success';
                        statusTextClass = 'text-success';
                        statusIcon = 'fas fa-check-circle';
                        break;
                    case 'Collected':
                        statusClass = 'list-group-item-light';
                        statusTextClass = 'text-muted';
                        statusIcon = 'fas fa-box-open';
                        break;
                    case 'Cancelled':
                        statusClass = 'list-group-item-danger';
                        statusTextClass = 'text-danger';
                        statusIcon = 'fas fa-times-circle';
                        break;
                }

                const priceDisplay = parseFloat(order.totalPrice).toFixed(2);
                const pickupDate = order.pickupDate ? new Date(order.pickupDate).toLocaleDateString() : 'N/A';

                const listItem = `
                    <li class="list-group-item d-flex justify-content-between align-items-center ${statusClass} order-item" data-id="${order.id}" style="cursor: pointer;">
                        <div>
                            <p class="mb-1 fw-bold text-primary">${order.customerName || 'N/A'} <small class="text-muted-subtle ms-2">ID: ${order.id}</small></p>
                            <small class="text-muted"><i class="${statusIcon} me-1 ${statusTextClass}"></i> ${order.status} - ${order.serviceType}</small><br>
                            <small class="text-muted">Est. Pickup: ${pickupDate} @ ${order.pickupTime}</small>
                        </div>
                        <span class="badge bg-primary rounded-pill p-2">₱${priceDisplay}</span>
                    </li>
                `;
                listElement.append(listItem);
            });
        };
        
        /**
         * Calculates and updates the summary statistics on the Home and Reports tabs.
         */
        const calculateDailyStats = () => {
            const orders = loadLocalData('orders');
            const ordersArray = Object.values(orders);

            let totalOrders = ordersArray.length;
            let remainingOrders = 0;
            let totalRevenue = 0;
            let totalWeight = 0;
            let totalBaseCost = 0;
            let totalDetergentCost = 0;

            const inventory = loadLocalData('inventory');

            // Calculate total cost of detergent used across all orders (assuming detergent-used is units)
            const getDetergentCostPerUnit = (type) => {
                const item = Object.values(inventory).find(inv => inv.type === type && inv.name.toLowerCase().includes('detergent'));
                return item ? parseFloat(item.costPerUnit) : 0;
            };
            
            // Simplified cost estimation for reporting purposes (can be expanded)
            const getDefaultCost = (serviceType) => {
                switch (serviceType) {
                    case 'Wash & Fold': return 5.00;
                    case 'Dry Cleaning': return 10.00;
                    case 'Pressing Only': return 3.00;
                    case 'Self Service': return 0.00;
                    default: return 0.00;
                }
            };


            ordersArray.forEach(order => {
                if (order.status !== 'Collected' && order.status !== 'Cancelled') {
                    remainingOrders++;
                }

                if (order.status === 'Collected' || order.paymentStatus === 'Paid' || order.paymentStatus === 'Partial') {
                    totalRevenue += parseFloat(order.totalPrice);
                }
                
                totalWeight += parseFloat(order.weightKg);

                // Cost calculation
                totalBaseCost += getDefaultCost(order.serviceType);
                const detergentCost = parseFloat(order.detergentUsed) * getDetergentCostPerUnit('Detergent');
                totalDetergentCost += detergentCost;
            });
            
            const totalEstimatedCost = totalBaseCost + totalDetergentCost; // Simple sum
            const totalNetRevenue = totalRevenue - totalEstimatedCost;
            const revenuePerKg = totalWeight > 0 ? totalRevenue / totalWeight : 0;
            
            // --- Update HOME Tab ---
            $('#total-orders-card').text(totalOrders);
            $('#remaining-orders-card').text(remainingOrders);
            $('#total-client-payment-card').text(`₱${totalRevenue.toFixed(2)}`);
            
            // --- Update REPORTS Tab ---
            $('#total-client-payment').text(`₱${totalRevenue.toFixed(2)}`);
            $('#grand-total-cost').text(`₱${totalEstimatedCost.toFixed(2)}`);
            $('#total-net-revenue').text(`₱${totalNetRevenue.toFixed(2)}`);
            
            $('#total-orders').text(totalOrders);
            $('#remaining-orders').text(remainingOrders);
            $('#total-weight-kg').text(`${totalWeight.toFixed(1)} kg`);
            $('#revenue-per-kg').text(`₱${revenuePerKg.toFixed(2)}`);
            
            // Cost Breakdown
            $('#total-cost-est').text(`₱${totalBaseCost.toFixed(2)}`);
            $('#total-additional-cost').text(`₱0.00`); // Placeholder for future feature
            $('#total-detergent-cost').text(`₱${totalDetergentCost.toFixed(2)}`);
            
            // Check low stock after loading orders (as order logic relies on inventory)
            checkLowStock();
        };

        // ====================================================================
        // INVENTORY MANAGEMENT FUNCTIONS
        // ====================================================================
        
        /**
         * Saves a new inventory item or updates an existing one.
         * @param {object} item - The inventory item object.
         */
        const saveInventoryData = (item) => {
            const inventory = loadLocalData('inventory');
            inventory[item.id] = item;
            
            if (storageMode === 'local') {
                saveLocalData('inventory', inventory);
                showToast(`${item.name} stock saved locally.`, 'success');
            } else {
                writeCloudData('inventory', inventory);
            }
            
            refreshUI();
        };

        /**
         * Updates an existing inventory item.
         * @param {object} updatedItem - The item object with changes.
         */
        const updateInventoryData = (updatedItem) => {
            saveInventoryData(updatedItem);
        };
        
        /**
         * Deletes an inventory item by ID.
         * @param {string} itemId - The ID of the item to delete.
         */
        const deleteInventoryData = (itemId) => {
            const inventory = loadLocalData('inventory');
            delete inventory[itemId];
            
            if (storageMode === 'local') {
                saveLocalData('inventory', inventory);
                showToast(`Inventory item deleted locally.`, 'warning');
            } else {
                writeCloudData('inventory', inventory);
            }
             
            refreshUI();
        };

        /**
         * Renders the inventory list based on current filters.
         */
        const renderInventoryList = () => {
            const inventory = loadLocalData('inventory');
            let inventoryArray = Object.values(inventory).sort((a, b) => a.name.localeCompare(b.name));
            const listElement = $('#inventory-list');
            listElement.empty();
            
            // Apply Filters
            const filterName = $('#filter-name').val()?.toLowerCase() || '';
            const filterType = $('#filter-type').val()?.toLowerCase() || '';
            const filterVendor = $('#filter-vendor').val()?.toLowerCase() || '';
            
            inventoryArray = inventoryArray.filter(item => {
                const nameMatch = item.name.toLowerCase().includes(filterName);
                const typeMatch = filterType === '' || item.type.toLowerCase().includes(filterType);
                const vendorMatch = filterVendor === '' || item.vendor.toLowerCase().includes(filterVendor);
                return nameMatch && typeMatch && vendorMatch;
            });
            

            if (inventoryArray.length === 0) {
                 listElement.append('<li class="list-group-item text-center text-muted-subtle">No inventory items found matching the filter.</li>');
                 return;
            }

            inventoryArray.forEach(item => {
                const qty = parseFloat(item.qty);
                const reorder = parseFloat(item.reorderLevel);
                let statusClass = '';

                if (qty <= 0) {
                    statusClass = 'list-group-item-danger';
                } else if (qty <= reorder) {
                    statusClass = 'list-group-item-warning';
                } else {
                    statusClass = 'list-group-item-light';
                }
                
                const costDisplay = parseFloat(item.costPerUnit).toFixed(2);

                const listItem = `
                    <li class="list-group-item d-flex justify-content-between align-items-center inventory-item-row ${statusClass}" data-id="${item.id}">
                        <div>
                            <p class="mb-1 fw-bold text-dark">${item.name}</p>
                            <small class="text-muted">Type: ${item.type} | Vendor: ${item.vendor}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-primary rounded-pill me-2">${qty} units</span>
                            <small class="text-muted d-block">Cost/Unit: ₱${costDisplay}</small>
                        </div>
                    </li>
                `;
                listElement.append(listItem);
            });
            
            // Update recommendations list (for adding new detergent)
             const recommendationsList = $('#detergent-recommendations');
             recommendationsList.empty();
             const uniqueNames = new Set(inventoryArray.map(item => item.name));
             uniqueNames.forEach(name => {
                 recommendationsList.append(`<option value="${name}">`);
             });
             
        };
        
        /**
         * Checks inventory levels and displays a low stock alert if necessary.
         */
        const checkLowStock = () => {
             const inventory = loadLocalData('inventory');
             const lowStockItems = Object.values(inventory).filter(item => parseFloat(item.qty) <= parseFloat(item.reorderLevel));
             const alertBox = $('#low-stock-alert');
             const list = $('#low-stock-list');
             
             list.empty();
             
             if (lowStockItems.length > 0) {
                 lowStockItems.forEach(item => {
                     list.append(`<li>${item.name} (Current: ${item.qty}, Reorder: ${item.reorderLevel})</li>`);
                 });
                 alertBox.removeClass('d-none');
             } else {
                 alertBox.addClass('d-none');
             }
        };

        // ====================================================================
        // MACHINE MANAGEMENT FUNCTIONS
        // ====================================================================
        
        /**
         * Saves a new machine or updates an existing one.
         * @param {object} machine - The machine object.
         */
        const saveMachineData = (machine) => {
            const machines = loadLocalData('machines');
            machines[machine.id] = machine;
            
            if (storageMode === 'local') {
                saveLocalData('machines', machines);
                showToast(`Machine ${machine.name} saved locally.`, 'success');
            } else {
                writeCloudData('machines', machines);
            }
             
            renderMachinesGrid();
        };

        /**
         * Updates the status of an existing machine (Maintenance Toggle).
         * @param {string} machineId - The ID of the machine.
         * @param {boolean} isUnderMaintenance - New maintenance status.
         */
        const updateMachineStatus = (machineId, isUnderMaintenance) => {
            const machines = loadLocalData('machines');
            if (machines[machineId]) {
                machines[machineId].isUnderMaintenance = isUnderMaintenance;
                
                if (storageMode === 'local') {
                    saveLocalData('machines', machines);
                    showToast(`Machine ${machines[machineId].name} status updated.`, 'info');
                } else {
                    writeCloudData('machines', machines);
                }
                
                renderMachinesGrid();
            }
        };

        /**
         * Renders the machines grid list.
         */
        const renderMachinesGrid = () => {
            const machines = loadLocalData('machines');
            const machinesArray = Object.values(machines).sort((a, b) => a.name.localeCompare(b.name));
            const gridElement = $('#machines-grid-list');
            gridElement.empty();
            
            if (machinesArray.length === 0) {
                 gridElement.append('<div class="col-12 text-center text-muted-subtle" id="machines-grid-placeholder">No machines registered.</div>');
                 return;
            }

            machinesArray.forEach(machine => {
                const isUnderMaintenance = machine.isUnderMaintenance;
                let cardClass = isUnderMaintenance ? 'bg-danger' : (machine.type === 'Washer' ? 'bg-primary' : 'bg-info');
                let cardIcon = machine.type === 'Washer' ? 'fas fa-washing-machine' : 'fas fa-dryer';
                let statusText = isUnderMaintenance ? 'Under Maintenance' : 'Available';
                
                if (isUnderMaintenance) cardIcon = 'fas fa-screwdriver-wrench';

                const cardHtml = `
                    <div class="col-md-4">
                        <div class="card machine-card-item text-white ${cardClass}" data-id="${machine.id}" style="height: 100%;">
                            <div class="card-body">
                                <h5 class="card-title"><i class="${cardIcon} me-2"></i>${machine.name}</h5>
                                <p class="card-text mb-1">Type: ${machine.type}</p>
                                <p class="card-text mb-1">Capacity: ${machine.capacity} kg</p>
                                <p class="card-text mb-0">Status: <span class="fw-bold">${statusText}</span></p>
                            </div>
                            <div class="card-footer d-flex justify-content-between align-items-center">
                                <a href="#" class="text-white toggle-maintenance-btn" data-id="${machine.id}" data-status="${isUnderMaintenance ? 'true' : 'false'}">
                                    ${isUnderMaintenance ? 'Mark as Available' : 'Mark for Maintenance'}
                                </a>
                                <small class="text-white">${new Date(machine.purchaseDate).getFullYear() || 'N/A'}</small>
                            </div>
                        </div>
                    </div>
                `;
                gridElement.append(cardHtml);
            });
        };
        
        // ====================================================================
        // WORKFORCE MANAGEMENT FUNCTIONS
        // ====================================================================
        
        /**
         * Saves a new employee or updates an existing one.
         * @param {object} employee - The employee object.
         */
        const saveEmployeeData = (employee) => {
            const workforce = loadLocalData('workforce');
            workforce[employee.id] = employee;
            
            if (storageMode === 'local') {
                saveLocalData('workforce', workforce);
                showToast(`Employee ${employee.name} saved locally.`, 'success');
            } else {
                writeCloudData('workforce', workforce);
            }
             
            renderWorkforceList();
        };

        /**
         * Updates an existing employee.
         * @param {object} updatedEmployee - The employee object with changes.
         */
        const updateEmployeeData = (updatedEmployee) => {
            saveEmployeeData(updatedEmployee);
        };
        
        /**
         * Deletes an employee by ID.
         * @param {string} employeeId - The ID of the employee to delete.
         */
        const deleteEmployeeData = (employeeId) => {
            const workforce = loadLocalData('workforce');
            const employeeName = workforce[employeeId] ? workforce[employeeId].name : 'Employee';
            delete workforce[employeeId];
            
            if (storageMode === 'local') {
                saveLocalData('workforce', workforce);
                showToast(`${employeeName} record deleted.`, 'warning');
            } else {
                writeCloudData('workforce', workforce);
            }
             
            renderWorkforceList();
        };

        /**
         * Renders the workforce list.
         */
        const renderWorkforceList = () => {
            const workforce = loadLocalData('workforce');
            const workforceArray = Object.values(workforce).sort((a, b) => a.name.localeCompare(b.name));
            const listElement = $('#workforce-list');
            listElement.empty();
            
            if (workforceArray.length === 0) {
                 listElement.append('<li class="list-group-item text-center text-muted-subtle">No employees registered.</li>');
                 return;
            }

            workforceArray.forEach(employee => {
                const salaryDisplay = parseFloat(employee.salary).toFixed(2);
                
                const listItem = `
                    <li class="list-group-item d-flex justify-content-between align-items-center workforce-item-row" data-id="${employee.id}" style="cursor: pointer;">
                        <div>
                            <p class="mb-1 fw-bold text-dark">${employee.name}</p>
                            <small class="text-muted">Role: ${employee.type} | Rate: ${employee.rateType}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-success rounded-pill p-2">₱${salaryDisplay}</span>
                        </div>
                    </li>
                `;
                listElement.append(listItem);
            });
        };
        
        // ====================================================================
        // CUSTOMER MANAGEMENT FUNCTIONS
        // ====================================================================
        
        /**
         * Saves a new customer or updates an existing one.
         * @param {object} customer - The customer object.
         */
        const saveCustomerData = (customer) => {
            const customers = loadLocalData('customers');
            customers[customer.id] = customer;
            
            if (storageMode === 'local') {
                saveLocalData('customers', customers);
                showToast(`Customer ${customer.name} saved locally.`, 'success');
            } else {
                writeCloudData('customers', customers);
            }
             
            renderCustomersList();
        };

        /**
         * Updates an existing customer.
         * @param {object} updatedCustomer - The customer object with changes.
         */
        const updateCustomerData = (updatedCustomer) => {
            saveCustomerData(updatedCustomer);
        };
        
        /**
         * Deletes a customer by ID.
         * @param {string} customerId - The ID of the customer to delete.
         */
        const deleteCustomerData = (customerId) => {
            const customers = loadLocalData('customers');
            const customerName = customers[customerId] ? customers[customerId].name : 'Customer';
            delete customers[customerId];
            
            if (storageMode === 'local') {
                saveLocalData('customers', customers);
                showToast(`${customerName} record deleted.`, 'warning');
            } else {
                writeCloudData('customers', customers);
            }
             
            renderCustomersList();
        };

        /**
         * Renders the customer list and updates the ID generation select.
         */
        const renderCustomersList = () => {
            const customers = loadLocalData('customers');
            const customersArray = Object.values(customers).sort((a, b) => a.name.localeCompare(b.name));
            const listElement = $('#customer-list');
            const selectElement = $('#id-customer-select');
            listElement.empty();
            selectElement.empty();
            selectElement.append('<option value="">Select a customer to generate ID</option>');
            
            if (customersArray.length === 0) {
                 listElement.append('<li class="list-group-item text-center text-muted-subtle">No customers registered.</li>');
                 return;
            }

            customersArray.forEach(customer => {
                // List rendering
                const listItem = `
                    <li class="list-group-item d-flex justify-content-between align-items-center customer-item-row" data-id="${customer.id}" style="cursor: pointer;">
                        <div>
                            <p class="mb-1 fw-bold text-dark">${customer.name}</p>
                            <small class="text-muted">Contact: ${customer.contact} | ID: ${customer.uniqueID}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-info rounded-pill p-2">${customer.age || 'N/A'} yo</span>
                        </div>
                    </li>
                `;
                listElement.append(listItem);
                
                // Select rendering
                selectElement.append(`<option value="${customer.id}">${customer.name} (ID: ${customer.uniqueID})</option>`);
            });
        };
        
        /**
         * Populates and shows the ID card for printing.
         * @param {object} customer - The customer object.
         */
        const renderIDCard = (customer) => {
            $('#id-card-name').text(customer.name);
            $('#id-card-contact').text(customer.contact);
            $('#id-card-address').text(customer.address || 'N/A');
            $('#id-card-age').text(customer.age || 'N/A');
            $('#id-card-unique-id').text(customer.uniqueID);
            
            $('#id-card-print-area').removeClass('d-none');
            $('#id-card-print-buttons').removeClass('d-none');
        };

        // ====================================================================
        // MASTER UI REFRESH FUNCTION
        // ====================================================================

        const refreshUI = () => {
            // Recalculate and update stats (Home & Reports)
            calculateDailyStats(); 
            // Render Lists
            renderOrderList();
            renderInventoryList();
            renderMachinesGrid();
            renderWorkforceList();
            renderCustomersList();
        };

        // ====================================================================
        // EVENT HANDLERS & INITIALIZATION
        // ====================================================================

        const main = () => {
            // 1. Initial Data Setup (Only if local storage is empty)
            initializeData();
            
            // 2. Determine Storage Mode & Start Sync Modal
            if (localStorage.getItem('storageMode')) {
                storageMode = localStorage.getItem('storageMode');
            }
            
            if (storageMode === 'local' && localStorage.getItem('hasSeenSyncModal') === null) {
                // Show modal if it's the first time or if the user explicitly logged out
                 const syncModal = new bootstrap.Modal(document.getElementById('startSyncModal'));
                 syncModal.show();
            } else {
                 $('#banner-storage-mode').text(storageMode === 'cloud' ? 'Cloud Sync (via Firebase)' : 'Local Browser Storage');
                 $('#banner-storage-mode-hidden').text(storageMode === 'cloud' ? 'Cloud' : 'Local Storage');
                 
                 // If cloud mode is set, try to re-authenticate/re-initialize
                 if (storageMode === 'cloud') {
                     initFirebase();
                     // Set up Firebase auth state observer
                     if (auth) {
                         auth.onAuthStateChanged(user => {
                             if (user) {
                                 // User is signed in.
                                 userId = user.uid;
                                 syncToCloud(true); // Initial sync from cloud
                             } else {
                                 // User is signed out. Fall back to local, show modal again
                                 storageMode = 'local';
                                 userId = 'local_user';
                                 localStorage.setItem('storageMode', 'local');
                                 showToast('Logged out from Cloud Sync. Switched to Local Storage.', 'warning');
                                 const syncModal = new bootstrap.Modal(document.getElementById('startSyncModal'));
                                 syncModal.show();
                             }
                         });
                     } else {
                         // Fallback if auth isn't initialized correctly
                         showToast('Firebase Authentication not available. Defaulting to Local Storage.', 'error');
                         storageMode = 'local';
                         userId = 'local_user';
                     }
                 }
                 
                 // Refresh UI for local data display
                 refreshUI();
            }
            
            // --- Sync Modal Event Handlers ---
            
            $('#continue-as-guest-btn').on('click', function() {
                storageMode = 'local';
                userId = 'local_user';
                localStorage.setItem('storageMode', 'local');
                localStorage.setItem('hasSeenSyncModal', 'true');
                $('#startSyncModal').modal('hide');
                $('#banner-storage-mode').text('Local Browser Storage');
                $('#banner-storage-mode-hidden').text('Local Storage');
                showToast('Continuing with Local Storage Mode.', 'info');
                refreshUI();
            });

            $('#google-sign-in-btn').on('click', function() {
                initFirebase();
                if (firebaseApp) {
                     signInWithGoogle();
                     // Auth state observer handles the mode switch and sync upon successful sign-in
                } else {
                     showToast('Firebase initialization failed. Cannot connect to Cloud.', 'error');
                }
                localStorage.setItem('hasSeenSyncModal', 'true'); // Assume user has chosen a path
                $('#startSyncModal').modal('hide');
            });
            
            // --- General Navigation Handlers ---
            
            // Home Dashboard Nav Buttons
            $('.home-nav-btn').on('click', function() {
                 const targetTabId = $(this).data('target-tab');
                 const targetTabTrigger = $(`a[data-bs-target="${targetTabId}"]`);
                 
                 // Use Bootstrap's native tab method to switch
                 const tab = new bootstrap.Tab(targetTabTrigger[0]);
                 tab.show();
                 
                 // Update the active class manually if necessary, and ensure mobile menu collapses
                 $('.navbar-nav .nav-link').removeClass('active');
                 targetTabTrigger.addClass('active');
                 $('#navbarNav').collapse('hide');
            });

            // "Add New Order" shortcut on Order List tab
            $('#add-new-order-btn').on('click', function() {
                const targetTabTrigger = $(`a[data-bs-target="#new-order"]`);
                const tab = new bootstrap.Tab(targetTabTrigger[0]);
                tab.show();
                $('.navbar-nav .nav-link').removeClass('active');
                targetTabTrigger.addClass('active');
            });
            
            // Tab change event: ensures active class is correctly set on navbar links
            $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
                 // Remove active class from all nav links
                 $('.navbar-nav .nav-link').removeClass('active');
                 // Add active class to the newly shown tab's link
                 $(this).addClass('active');
            });


            // --- Order Tab Handlers ---
            
            // New Order Form Submission
            $('#order-form').on('submit', function(e) {
                e.preventDefault();
                
                const newOrder = {
                    id: generateUniqueID('ORD'),
                    customerName: $('#customer-name').val().trim() || 'Guest Customer',
                    customerPhoneNumber: $('#customer-phone-number').val().trim(),
                    customerEmail: $('#customer-email').val().trim(),
                    serviceType: $('#service-type').val(),
                    loadType: $('#load-type').val(),
                    weightKg: parseFloat($('#weight-kg').val() || 0),
                    detergentUsed: parseFloat($('#detergent-used').val() || 0),
                    staffInCharge: $('#staff-in-charge').val().trim(),
                    baseCost: parseFloat($('#base-cost').val() || 0),
                    deposit: parseFloat($('#deposit').val() || 0),
                    totalPrice: parseFloat($('#total-price').val() || 0),
                    pickupDate: $('#pickup-date').val(),
                    pickupTime: $('#pickup-time').val(),
                    notes: $('#notes').val().trim(),
                    timestamp: getTimestamp(),
                    status: 'Pending', // Default status for a new order
                    paymentStatus: (parseFloat($('#deposit').val() || 0) > 0) ? 'Partial' : 'Unpaid',
                    dateCollected: '' // Will be updated when collected
                };
                
                saveOrderData(newOrder);
                
                // Reset form
                this.reset();
                $('#weight-kg').val('0');
                $('#detergent-used').val('1');
                $('#base-cost').val('0.00');
                $('#deposit').val('0.00');
                $('#total-price').val('0.00');
            });

            // Order List Item Click (Open Detail Modal)
            $('#order-list-ul').on('click', '.order-item', function() {
                const orderId = $(this).data('id');
                const orders = loadLocalData('orders');
                const order = orders[orderId];
                
                if (!order) {
                    showToast('Order not found.', 'error');
                    return;
                }
                
                // Populate Modal Fields
                $('#modal-order-id-display').text(order.id);
                $('#modal-order-id').val(order.id);
                $('#modal-order-timestamp').val(order.timestamp);
                
                $('#modal-customer-name').val(order.customerName);
                $('#modal-customer-phone-number').val(order.customerPhoneNumber);
                $('#modal-customer-email').val(order.customerEmail);
                $('#modal-service-type').val(order.serviceType);
                $('#modal-weight-kg').val(order.weightKg);
                $('#modal-detergent-used').val(order.detergentUsed);
                
                $('#modal-base-cost').val(parseFloat(order.baseCost).toFixed(2));
                $('#modal-deposit').val(parseFloat(order.deposit).toFixed(2));
                $('#modal-total-price').val(parseFloat(order.totalPrice).toFixed(2));
                $('#modal-status').val(order.status);
                $('#modal-payment-status').val(order.paymentStatus);
                $('#modal-staff-in-charge').val(order.staffInCharge);
                
                $('#modal-pickup-date').val(order.pickupDate);
                $('#modal-pickup-time').val(order.pickupTime);
                $('#modal-date-collected').val(order.dateCollected);
                $('#modal-notes').val(order.notes);

                $('#orderDetailModal').modal('show');
            });

            // Order Detail Modal - Save Button
            $('#order-detail-form').on('submit', function(e) {
                e.preventDefault();
                
                const updatedOrder = {
                    id: $('#modal-order-id').val(),
                    customerName: $('#modal-customer-name').val().trim(),
                    customerPhoneNumber: $('#modal-customer-phone-number').val().trim(),
                    customerEmail: $('#modal-customer-email').val().trim(),
                    serviceType: $('#modal-service-type').val(),
                    loadType: $('#modal-load-type').val(),
                    weightKg: parseFloat($('#modal-weight-kg').val() || 0),
                    detergentUsed: parseFloat($('#modal-detergent-used').val() || 0),
                    staffInCharge: $('#modal-staff-in-charge').val().trim(),
                    baseCost: parseFloat($('#modal-base-cost').val() || 0),
                    deposit: parseFloat($('#modal-deposit').val() || 0),
                    totalPrice: parseFloat($('#modal-total-price').val() || 0),
                    pickupDate: $('#modal-pickup-date').val(),
                    pickupTime: $('#modal-pickup-time').val(),
                    notes: $('#modal-notes').val().trim(),
                    timestamp: $('#modal-order-timestamp').val(),
                    status: $('#modal-status').val(),
                    paymentStatus: $('#modal-payment-status').val(),
                    dateCollected: $('#modal-date-collected').val()
                };
                
                updateOrderData(updatedOrder);
                $('#orderDetailModal').modal('hide');
            });
            
            // Order Detail Modal - Delete Button
            $('#delete-order-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this order?')) {
                    const orderId = $('#modal-order-id').val();
                    deleteOrderData(orderId);
                    $('#orderDetailModal').modal('hide');
                 }
            });
            
            // Pagination Handlers
            $('#prev-page-btn').on('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    renderOrderList();
                }
            });
            $('#next-page-btn').on('click', function() {
                const orders = loadLocalData('orders');
                const totalPages = Math.ceil(Object.keys(orders).length / PAGE_SIZE);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderOrderList();
                }
            });
            
            // --- Inventory Tab Handlers ---
            
            // Inventory Add Form Submission
            $('#detergent-form').on('submit', function(e) {
                e.preventDefault();
                
                const itemName = $('#detergent-name').val().trim();
                const inventory = loadLocalData('inventory');
                
                // Check if item already exists by name (case-insensitive)
                const existingItem = Object.values(inventory).find(item => item.name.toLowerCase() === itemName.toLowerCase());
                
                const itemData = {
                    name: itemName,
                    type: $('#detergent-type').val(),
                    qty: parseFloat($('#detergent-qty').val() || 0),
                    costPerUnit: parseFloat($('#detergent-cost').val() || 0),
                    vendor: $('#detergent-vendor').val().trim(),
                    reorderLevel: 5, // Default reorder level
                };
                
                if (existingItem) {
                    // Update existing item
                    itemData.id = existingItem.id;
                    itemData.qty = parseFloat(existingItem.qty) + itemData.qty; // Add new stock to existing quantity
                    itemData.reorderLevel = existingItem.reorderLevel; // Keep existing reorder level
                    showToast(`Adding ${itemData.qty - parseFloat(existingItem.qty)} units to existing stock.`, 'info');
                } else {
                    // New item
                    itemData.id = generateUniqueID('INV');
                }
                
                saveInventoryData(itemData);
                this.reset();
                $('#detergent-qty').val('1');
                $('#detergent-cost').val('0.00');
            });
            
            // Inventory Filter Form Submission
            $('#inventory-filter-form').on('submit', function(e) {
                e.preventDefault();
                renderInventoryList();
            });
            
            // Clear Inventory Filter Button
            $('#clear-inventory-filter-btn').on('click', function() {
                $('#filter-name').val('');
                $('#filter-type').val('');
                $('#filter-vendor').val('');
                renderInventoryList();
            });
            
            // Inventory List Item Click (Open Detail Modal)
            $('#inventory-list').on('click', '.inventory-item-row', function() {
                const itemId = $(this).data('id');
                const inventory = loadLocalData('inventory');
                const item = inventory[itemId];
                
                if (!item) {
                    showToast('Inventory item not found.', 'error');
                    return;
                }
                
                // Populate Modal Fields
                $('#modal-inventory-id').val(item.id);
                $('#modal-inventory-name-display').text(item.name);
                
                $('#modal-inventory-name').val(item.name);
                $('#modal-inventory-type').val(item.type);
                $('#modal-inventory-qty').val(parseFloat(item.qty));
                $('#modal-inventory-cost').val(parseFloat(item.costPerUnit).toFixed(2));
                $('#modal-inventory-vendor').val(item.vendor);
                $('#modal-inventory-reorder-level').val(parseFloat(item.reorderLevel));

                $('#inventoryDetailModal').modal('show');
            });

            // Inventory Detail Modal - Save Button
            $('#inventory-detail-form').on('submit', function(e) {
                e.preventDefault();
                
                const updatedItem = {
                    id: $('#modal-inventory-id').val(),
                    name: $('#modal-inventory-name').val().trim(),
                    type: $('#modal-inventory-type').val(),
                    qty: parseFloat($('#modal-inventory-qty').val() || 0),
                    costPerUnit: parseFloat($('#modal-inventory-cost').val() || 0),
                    vendor: $('#modal-inventory-vendor').val().trim(),
                    reorderLevel: parseFloat($('#modal-inventory-reorder-level').val() || 0),
                };
                
                updateInventoryData(updatedItem);
                $('#inventoryDetailModal').modal('hide');
            });
            
            // Inventory Detail Modal - Delete Button
            $('#delete-inventory-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this inventory item?')) {
                    const itemId = $('#modal-inventory-id').val();
                    deleteInventoryData(itemId);
                    $('#inventoryDetailModal').modal('hide');
                 }
            });
            
            // --- Machine Tab Handlers ---
            
            // Machine Add Form Submission
            $('#machine-form').on('submit', function(e) {
                e.preventDefault();
                
                const newMachine = {
                    id: generateUniqueID('MCH'),
                    name: $('#machine-name').val().trim(),
                    type: $('#machine-type').val(),
                    capacity: parseFloat($('#machine-capacity').val() || 0),
                    purchaseDate: $('#machine-purchase-date').val(),
                    notes: $('#machine-notes').val().trim(),
                    isUnderMaintenance: $('#machine-under-maintenance').is(':checked'),
                };
                
                saveMachineData(newMachine);
                this.reset();
                $('#machine-capacity').val('10.0');
            });
            
            // Machine Status Toggle Click
            $('#machines-grid-list').on('click', '.toggle-maintenance-btn', function(e) {
                 e.preventDefault();
                 const machineId = $(this).data('id');
                 const currentStatus = $(this).data('status') === 'true';
                 
                 const newStatus = !currentStatus;
                 updateMachineStatus(machineId, newStatus);
            });
            
            // --- Workforce Tab Handlers ---
            
            // Workforce Add Form Submission
            $('#workforce-form').on('submit', function(e) {
                e.preventDefault();
                
                const newEmployee = {
                    id: generateUniqueID('EMP'),
                    name: $('#employee-name').val().trim(),
                    type: $('#employee-type').val(),
                    salary: parseFloat($('#employee-salary').val() || 0),
                    rateType: $('#employee-rate-type').val(),
                };
                
                saveEmployeeData(newEmployee);
                this.reset();
                $('#employee-salary').val('0.00');
            });
            
            // Workforce List Item Click (Open Detail Modal)
            $('#workforce-list').on('click', '.workforce-item-row', function() {
                const employeeId = $(this).data('id');
                const workforce = loadLocalData('workforce');
                const employee = workforce[employeeId];
                
                if (!employee) {
                    showToast('Employee not found.', 'error');
                    return;
                }
                
                // Populate Modal Fields
                $('#modal-employee-id').val(employee.id);
                $('#modal-employee-name-display').text(employee.name);
                
                $('#modal-employee-name').val(employee.name);
                $('#modal-employee-type').val(employee.type);
                $('#modal-employee-salary').val(parseFloat(employee.salary).toFixed(2));
                $('#modal-employee-rate-type').val(employee.rateType);

                $('#employeeDetailModal').modal('show');
            });

            // Employee Detail Modal - Save Button
            $('#employee-detail-form').on('submit', function(e) {
                e.preventDefault();
                
                const updatedEmployee = {
                    id: $('#modal-employee-id').val(),
                    name: $('#modal-employee-name').val().trim(),
                    type: $('#modal-employee-type').val(),
                    salary: parseFloat($('#modal-employee-salary').val() || 0),
                    rateType: $('#modal-employee-rate-type').val(),
                };
                
                updateEmployeeData(updatedEmployee);
                $('#employeeDetailModal').modal('hide');
            });
            
            // Employee Detail Modal - Delete Button
            $('#delete-employee-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this employee record?')) {
                    const employeeId = $('#modal-employee-id').val();
                    deleteEmployeeData(employeeId);
                    $('#employeeDetailModal').modal('hide');
                 }
            });
            
            // --- Customer Tab Handlers ---
            
            // Customer Register Form Submission
            $('#customer-form').on('submit', function(e) {
                e.preventDefault();
                
                const newCustomer = {
                    id: generateUniqueID('CUS'),
                    uniqueID: generateUniqueID('ID'),
                    name: $('#customer-reg-name').val().trim(),
                    contact: $('#customer-reg-contact').val().trim(),
                    age: parseInt($('#customer-reg-age').val()) || null,
                    address: $('#customer-reg-address').val().trim(),
                };
                
                saveCustomerData(newCustomer);
                this.reset();
            });
            
            // Customer List Item Click (Open Detail Modal)
            $('#customer-list').on('click', '.customer-item-row', function() {
                const customerId = $(this).data('id');
                const customers = loadLocalData('customers');
                const customer = customers[customerId];
                
                if (!customer) {
                    showToast('Customer not found.', 'error');
                    return;
                }
                
                // Populate Modal Fields
                $('#modal-customer-id').val(customer.id);
                $('#modal-customer-name-display-2').text(customer.name);
                
                $('#modal-customer-name-2').val(customer.name);
                $('#modal-customer-contact').val(customer.contact);
                $('#modal-customer-age').val(customer.age);
                $('#modal-customer-address').val(customer.address);
                $('#modal-customer-unique-id').val(customer.uniqueID);

                $('#customerDetailModal').modal('show');
            });
            
            // Customer ID Card Generate Button
            $('#generate-id-card-btn').on('click', function() {
                 const customerId = $('#id-customer-select').val();
                 if (!customerId) {
                     showToast('Please select a customer first.', 'warning');
                     $('#id-card-print-area').addClass('d-none');
                     $('#id-card-print-buttons').addClass('d-none');
                     return;
                 }
                 
                 const customers = loadLocalData('customers');
                 const customer = customers[customerId];
                 renderIDCard(customer);
            });


            // Customer Detail Modal - Save Button
            $('#customer-detail-form').on('submit', function(e) {
                e.preventDefault();
                
                const updatedCustomer = {
                    id: $('#modal-customer-id').val(),
                    uniqueID: $('#modal-customer-unique-id').val(),
                    name: $('#modal-customer-name-2').val().trim(),
                    contact: $('#modal-customer-contact').val().trim(),
                    age: parseInt($('#modal-customer-age').val()) || null,
                    address: $('#modal-customer-address').val().trim(),
                };
                
                updateCustomerData(updatedCustomer);
                $('#customerDetailModal').modal('hide');
                renderCustomersList();
            });

            // Customer Detail Modal - Delete Button
            $('#delete-customer-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this customer record?')) {
                    const customerId = $('#modal-customer-id').val();
                    deleteCustomerData(customerId);
                    $('#customerDetailModal').modal('hide');
                 }
            });

            // Log Out Button
            $('#home-log-out-btn').on('click', function() {
                if (confirm('Are you sure you want to log out? This will clear local data unless you use Cloud Sync.')) {
                    // Reset storage mode preference and clear local data
                    localStorage.removeItem('storageMode');
                    localStorage.removeItem('hasSeenSyncModal');
                    // Reloads the page to restart the sync flow
                    location.reload(); 
                }
            });
            
            // Mobile Menu Uncollapse Logic
            $('.navbar-nav a.nav-link').on('click', function () {
                const navbarCollapse = $('#navbarNav');
                // Use Bootstrap's native collapse method on the navbarCollapse element
                if (navbarCollapse.hasClass('show')) {
                    navbarCollapse.collapse('hide');
                }
            });


        };

        // Initialize the application once the document is fully loaded
        $(document).ready(main);

    </script>
</body>
</html>