<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Laundry Shop System (Cloud/Local Sync)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Professional Color Palette (Inspired by Google/Material) */
        :root {
            --color-primary: #03a9f4; /* Light Blue for Laundry */
            --color-success: #34a853; /* Green */
            --color-warning: #fbbc05; /* Yellow/Warning */
            --color-info: #4285f4; /* Lighter Blue */
            --color-text-subtle: #5f6368; /* Gray Text */
            --color-danger: #ea4335; /* Red */
        }

        body { 
            background-color: #f8f9fa; 
            font-family: 'Roboto', sans-serif; 
            padding-top: 60px; /* Padding for fixed navbar */
        }
        .container { 
            max-width: 1050px; 
            margin-top: 0px; /* Adjusted margin for fixed navbar */
        }
        .card { border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); border-radius: 8px; }
        
        /* Custom Colors */
        .bg-primary { background-color: var(--color-primary) !important; }
        .btn-primary { background-color: var(--color-primary); border-color: var(--color-primary); }
        .text-primary { color: var(--color-primary) !important; }

        /* Tabs and List Styling (Modified for Navbar - old nav-tabs active style is now commented out or overridden) */
        .navbar-nav .nav-link.active {
            font-weight: 700;
            color: white !important; /* Active links in the dark navbar should be highlighted, e.g., bright white */
            border-bottom: 3px solid white;
        }
        
        /* Home Tab Specific Styles */
        .home-banner {
            background: linear-gradient(135deg, #03a9f4, #4285f4); 
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        /* Summary Box Styling */
        .summary-box p {
            font-size: 1.8rem;
        }
        .summary-box small {
            font-size: 0.8rem;
        }
        
        /* Loading indicator for Firebase */
        #loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1050;
        }

        /* Custom Loading Overlay used by signInWithGoogle function */
        #auth-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            display: none; /* Starts hidden */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        /* Cloud Sync Modal Styling - kept original for Firebase login */
        .start-sync-modal-body {
            text-align: center;
            padding: 30px;
        }
        .google-sign-in-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 10px;
            transition: background-color 0.2s;
        }
        .google-sign-in-btn:hover {
            background-color: #357ae8;
        }
        .guest-button {
            background-color: #e9ecef;
            color: #495057;
            border: 1px solid #ced4da;
            width: 100%;
        }

        /* Toast Message Styling */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1060;
        }
        .custom-toast {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(100%);
        }
        .custom-toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* List Group Styling */
        .list-group-item.list-group-item-danger {
            background-color: #f8d7da !important; 
        }
        .list-group-item.list-group-item-warning {
             background-color: #fff3cd !important;
        }
        .text-revenue { color: #008000 !important; }
        .border-left-revenue { border-left-color: #008000 !important; }
        .summary-box p {
            font-size: 1.5rem !important;
        }
        
        /* New Inventory List Item Styling */
        .inventory-item-row:hover {
            cursor: pointer;
            background-color: #f0f0f0; /* Light highlight on hover */
        }
        
        /* Machine Card Styling */
        .machine-card-item {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .machine-card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .machine-card-item .card-footer a {
            color: white !important;
            text-decoration: underline;
        }
        .machine-card-item .card-footer a:hover {
            opacity: 0.8;
        }
    
    /* --- New ID Card Styling for Generate ID Tab --- */
      .id-card-container {
          width: 320px; /* Standard ID card width */
          height: 200px; /* Standard ID card height */
          border: 1px solid var(--color-primary); /* Border using primary color */
          border-radius: 8px;
          padding: 15px;
          background-color: #ffffff;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          margin: 20px auto;
          font-family: Arial, sans-serif;
          position: relative;
          overflow: hidden;
      }
      .id-card-header {
          background-color: var(--color-primary);
          color: white;
          padding: 3px 0;
          text-align: center;
          font-size: 0.9rem;
          font-weight: bold;
          margin: -15px -15px 10px -15px; /* Adjusting for padding */
      }
      .id-card-photo {
          width: 60px;
          height: 60px;
          border: 1px solid #ccc;
          background-color: #f0f0f0;
          margin-right: 10px;
          border-radius: 4px;
          float: left;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.8rem;
          color: #888;
      }
      .id-card-details {
          overflow: hidden;
      }
      .id-card-details p {
          margin-bottom: 3px;
          font-size: 0.8rem;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }
      .id-card-details strong {
          font-weight: bold;
          display: inline-block;
          width: 60px; /* Aligning labels */
      }
      .id-card-id {
          clear: both;
          text-align: center;
          margin-top: 15px;
          font-size: 1.2rem;
          font-weight: 900;
          color: var(--color-danger);
          border-top: 1px dashed #ccc;
          padding-top: 5px;
      }
      .print-area {
          text-align: center;
          margin-top: 20px;
      }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-soap me-2"></i>LAUNDRY SYSTEM
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true" href="#">
                            <i class="fas fa-home me-2"></i>Home
                        </a>
                    </li>
                    
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="orders-group-tab" data-bs-toggle="tab" data-bs-target="#orders-group" type="button" role="tab" aria-controls="orders-group" aria-selected="false" href="#">
                            <i class="fas fa-file-invoice me-2"></i>Orders
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab" aria-controls="inventory" aria-selected="false" href="#">
                            <i class="fas fa-boxes-stacked me-2"></i>Detergents
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="available-machines-tab" data-bs-toggle="tab" data-bs-target="#available-machines" type="button" role="tab" aria-controls="available-machines" aria-selected="false" href="#">Machines</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab" aria-controls="reports" aria-selected="false" href="#">
                            <i class="fas fa-chart-line me-2"></i>Reports
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="workforce-tab" data-bs-toggle="tab" data-bs-target="#workforce" type="button" role="tab" aria-controls="workforce" aria-selected="false" href="#">Workforce</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="customers-tab" data-bs-toggle="tab" data-bs-target="#customers" type="button" role="tab" aria-controls="customers" aria-selected="false" href="#">Customers</a>
                    </li>
                </ul>
                
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button id="home-log-out-btn" class="btn btn-outline-danger mt-2 mt-lg-0">
                            <i class="fas fa-sign-out-alt me-2"></i>Log Out
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div id="loading-indicator" class="d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-primary mt-2" id="loading-text">Connecting...</p>
        </div>

        <div id="auth-loading-overlay">
            <div class="spinner-border text-light mb-3" role="status"></div>
            <p class="text-light">Waiting for Google Sign-In...</p>
        </div>

        <div id="toast-container"></div>
        
        <div class="tab-content">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <div class="home-banner mt-4"> <h2>Welcome to Your Laundry Management System!</h2>
                    <p class="mb-0">Track your orders and inventory. Data is saved securely in the <span id="banner-storage-mode-hidden" class="fw-bold">...</span></p>
                </div>
                
                <div class="row g-4 mb-4" id="summary-statistics">
                    <div class="col-md-4">
                        <div class="card p-3 summary-box border-left-revenue" style="border-left: 5px solid var(--color-primary);">
                            <p class="text-primary fw-bold mb-0" id="total-orders-card">0</p>
                            <small class="text-muted">Total Orders (All Time)</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                         <div class="card p-3 summary-box" style="border-left: 5px solid var(--color-warning);">
                            <p class="text-warning fw-bold mb-0" id="remaining-orders-card">0</p>
                            <small class="text-muted">Orders In Progress</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                         <div class="card p-3 summary-box" style="border-left: 5px solid var(--color-success);">
                            <p class="text-success fw-bold mb-0" id="total-client-payment-card">₱0.00</p>
                            <small class="text-muted">Total Revenue (All Time)</small>
                        </div>
                    </div>
                </div>

                <div class="card p-4">
                    <h5 class="text-primary mb-4"><i class="fas fa-grip me-2"></i>Main System Dashboard</h5>
                    <p class="mb-4">Data storage mode: <span id="banner-storage-mode" class="fw-bold">...</span></p>
                    
                    <div class="row g-3" id="home-buttons-dashboard">
                        <div class="col-md-4"><button data-target-tab="#orders-group" class="btn btn-primary w-100 py-3 home-nav-btn"><i class="fas fa-list-check me-2"></i>Laundry Requests</button></div>
                        <div class="col-md-4"><button data-target-tab="#reports" class="btn btn-primary w-100 py-3 home-nav-btn"><i class="fas fa-chart-line me-2"></i>Reports</button></div>
                        <div class="col-md-4"><button data-target-tab="#inventory" class="btn btn-primary w-100 py-3 home-nav-btn"><i class="fas fa-boxes-stacked me-2"></i>Inventory</button></div>
                        
                        <div class="col-md-4"><button data-target-tab="#available-machines" class="btn btn-info w-100 py-3 home-nav-btn"><i class="fas fa-washing-machine me-2"></i>Available Machines</button></div>
                        <div class="col-md-4"><button data-target-tab="#workforce" class="btn btn-info w-100 py-3 home-nav-btn"><i class="fas fa-users-gear me-2"></i>Workforce</button></div>
                        <div class="col-md-4"><button data-target-tab="#customers" class="btn btn-info w-100 py-3 home-nav-btn"><i class="fas fa-user-friends me-2"></i>Customers</button></div>
                        
                        </div>
                </div>

                <div id="home-complex-data" class="d-none">
                     
                    
                    <div class="row g-4">
                        </div>
                </div>
            </div>

            <div class="tab-pane fade" id="orders-group" role="tabpanel" aria-labelledby="orders-group-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="orderSubTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="new-order-sub-tab" data-bs-toggle="tab" data-bs-target="#sub-new-order" type="button" role="tab" aria-controls="sub-new-order" aria-selected="true">
                            <i class="fas fa-plus-circle me-2"></i>New Order
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="order-list-sub-tab" data-bs-toggle="tab" data-bs-target="#sub-order-list" type="button" role="tab" aria-controls="sub-order-list" aria-selected="false">
                            <i class="fas fa-list-check me-2"></i>Order List
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="orderSubTabContent">
                    
<div class="tab-pane fade show active" id="sub-new-order" role="tabpanel" aria-labelledby="new-order-sub-tab">
    <div class="card p-4"> 
        <h5 class="card-title text-primary mb-3"><i class="fas fa-plus-circle me-2"></i>New Laundry Order Details</h5>
        <form id="order-form" class="row g-3">
            
            <div class="col-12 mt-1 mb-0"><h6 class="text-info"><i class="fas fa-user-check me-2"></i>Customer & Details</h6><hr class="mt-1 mb-2"></div>

            <div class="col-md-6">
                <label for="customer-dropdown" class="form-label text-primary">Select Registered Customer <span class="text-danger">*</span></label>
                <select class="form-select" id="customer-dropdown" required>
                    <option value="" selected disabled>-- Choose Customer --</option>
                    </select>
            </div>
            
            <div class="col-md-6">
                <label class="form-label text-muted-subtle">Selected Customer Information:</label>
                <div class="card border-0 p-2 bg-light">
                    <p class="mb-1" style="font-size: 0.9rem;">
                        <strong><i class="fas fa-user me-1"></i> Name:</strong> <span id="display-customer-name" class="fw-bold">N/A</span>
                    </p>
                    <p class="mb-1" style="font-size: 0.9rem;">
                        <strong><i class="fas fa-phone me-1"></i> Contact:</strong> <span id="display-customer-contact">N/A</span>
                    </p>
                    <p class="mb-1" style="font-size: 0.9rem;">
                        <strong><i class="fas fa-map-marker-alt me-1"></i> Address:</strong> <span id="display-customer-address">N/A</span>
                    </p>
                    <p class="mb-0" style="font-size: 0.9rem;">
                        <strong><i class="fas fa-calendar-alt me-1"></i> Date Reg:</strong> <span id="display-customer-datereg">N/A</span>
                    </p>
                </div>
            </div>

            <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-tools me-2"></i>Operation Details</h6><hr class="mt-1 mb-2"></div>
            
            <div class="col-md-4">
                <label for="machine-dropdown" class="form-label text-muted-subtle">Select Available Machine <span class="text-danger">*</span></label>
                <select class="form-select" id="machine-dropdown" required>
                    <option value="" selected disabled>-- Choose Machine --</option>
                    </select>
                <div class="form-text">In-use machines will be disabled.</div>
            </div>
            
            <div class="col-md-4">
                <label for="detergent-dropdown" class="form-label text-muted-subtle">Detergent Choice <span class="text-danger">*</span></label>
                <select class="form-select" id="detergent-dropdown" required>
                    <option value="" selected disabled>-- Select Detergent --</option>
                    </select>
            </div>
            
            <div class="col-md-4">
                <label for="staff-dropdown" class="form-label text-muted-subtle">Staff In Charge <span class="text-danger">*</span></label>
                <select class="form-select" id="staff-dropdown" required>
                    <option value="" selected disabled>-- Select Staff --</option>
                    </select>
            </div>
            
            <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-shirt me-2"></i>Service Details</h6><hr class="mt-1 mb-2"></div>
            
            <div class="col-md-3">
                <label for="service-type" class="form-label text-muted-subtle">Service Type</label>
                <select class="form-select" id="service-type" required>
                    <option value="Wash & Fold" selected>Wash & Fold</option>
                    <option value="Dry Cleaning">Dry Cleaning</option>
                    <option value="Self Service">Self Service</option>
                </select>
            </div>
            <div class="col-md-3"><label for="weight-kg" class="form-label text-muted-subtle">Weight (kg) / Item Count</label><input type="number" step="0.1" min="0" class="form-control" id="weight-kg" required value="0"></div>
            <div class="col-md-3"><label for="base-cost" class="form-label text-muted-subtle">Base Service Cost (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="base-cost" value="0.00"></div>
            <div class="col-md-3"><label for="total-price" class="form-label text-muted-subtle">Total Price (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="total-price" value="0.00" required></div>
            
            <div class="col-12 mt-3 mb-0"><h6 class="text-info"><i class="fas fa-calendar-alt me-2"></i>Pickup & Notes</h6><hr class="mt-1 mb-2"></div>

            <div class="col-md-3"><label for="pickup-date" class="form-label text-muted-subtle">Est. Pickup Date</label><input type="date" class="form-control" id="pickup-date" required></div>
            <div class="col-md-3"><label for="pickup-time" class="form-label text-muted-subtle">Est. Pickup Time</label><input type="time" class="form-control" id="pickup-time" value=""></div>

            <div class="col-md-6"><label for="notes" class="form-label text-muted-subtle">Notes (Stains, Special Instructions)</label><textarea class="form-control" id="notes" rows="1" placeholder="e.g., Stain on collar. Do not use heat dry."></textarea></div>
            
            <div class="col-12 text-end"><button type="submit" class="btn btn-primary mt-3"><i class="fas fa-save me-2"></i>Save Order</button></div>
        </form>
    </div>
</div>
<div class="tab-pane fade" id="sub-order-list" role="tabpanel" aria-labelledby="order-list-sub-tab">
                        <div class="card p-4 mb-3 mt-4"> 
                            <h5 class="text-primary mb-3"><i class="fas fa-plus-circle me-2"></i>New Order Shortcut</h5>
                            <button id="add-new-order-btn" data-target-sub-tab="#sub-new-order" class="btn btn-success w-100"><i class="fas fa-plus me-2"></i>Add New Laundry Order</button>
                        </div>
                        <div class="card rounded-top-0">
                            <ul id="order-list-ul" class="list-group list-group-flush">
                                <li class="list-group-item text-center text-muted-subtle">Orders will load after successful setup.</li>
                            </ul>
                        </div>
                        
                        <div id="order-pagination-controls" class="d-flex justify-content-between align-items-center p-3 border-top bg-light rounded-bottom flex-wrap">
                            <button id="prev-page-btn" class="btn btn-outline-primary btn-sm mb-2 mb-sm-0" disabled><i class="fas fa-chevron-left me-1"></i> Previous</button>
                            <span id="page-info" class="text-muted-subtle mx-auto mb-2 mb-sm-0" style="font-size: 0.9rem;">Page 0 of 0</span>
                            <button id="next-page-btn" class="btn btn-outline-primary btn-sm" disabled>Next <i class="fas fa-chevron-right ms-1"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="inventory" role="tabpanel" aria-labelledby="inventory-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="inventoryMainTabs" role="tablist"> <li class="nav-item" role="presentation">
                        <button class="nav-link" id="inventory-add-tab" data-bs-toggle="tab" data-bs-target="#tab-inventory-add" type="button" role="tab" aria-controls="tab-inventory-add" aria-selected="false"><i class="fas fa-cart-plus me-2"></i>Add New Stock</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="inventory-view-tab" data-bs-toggle="tab" data-bs-target="#tab-inventory-view" type="button" role="tab" aria-controls="tab-inventory-view" aria-selected="true"><i class="fas fa-boxes-stacked me-2"></i>Current Inventory</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="inventoryMainTabContent">
                    
                    <div class="tab-pane fade show active" id="tab-inventory-view" role="tabpanel" aria-labelledby="inventory-view-tab">
                        
                        <div id="low-stock-alert" class="alert alert-warning d-none" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Low on Stock!</strong> The following items need immediate reordering: 
                            <ul id="low-stock-list" class="mt-2 mb-0"></ul>
                        </div>
        
                        <div class="card mb-4">
                            <div class="card-header bg-white border-bottom p-3">
                                <button class="btn btn-block w-100 text-start d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#inventoryFilterCollapse" aria-expanded="false" aria-controls="inventoryFilterCollapse">
                                    <h5 class="text-primary mb-0"><i class="fas fa-filter me-2"></i>Inventory Filters</h5>
                                    <i class="fas fa-chevron-up text-muted-subtle"></i>
                                </button>
                            </div>
                            <div class="collapse" id="inventoryFilterCollapse">
                                <div class="card-body p-4">
                                    <form id="inventory-filter-form" class="row g-3">
                                        <div class="col-md-4">
                                            <label for="filter-name" class="form-label text-muted-subtle">Item Name/Category</label>
                                            <input type="text" class="form-control" id="filter-name" placeholder="Search name or type...">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="filter-type" class="form-label text-muted-subtle">Item Type</label>
                                            <select class="form-select" id="filter-type">
                                                <option value="">All Types</option>
                                                <option value="Detergent">All Detergents</option>
                                                <option value="Liquid">Liquid</option>
                                                <option value="Powder">Powder</option>
                                                <option value="Pods">Pods/Unit</option>
                                                <option value="Softener">Softener</option>
                                                <option value="Special">Special</option>
                                                </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="filter-vendor" class="form-label text-muted-subtle">Vendor</label>
                                            <input type="text" class="form-control" id="filter-vendor" placeholder="Search vendor name...">
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-outline-secondary me-2" id="clear-inventory-filter-btn"><i class="fas fa-redo me-1"></i> Clear Filter</button>
                                            <button type="submit" class="btn btn-primary"><i class="fas fa-search me-1"></i> Apply Filter</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-list me-2"></i>Current Inventory Stock (Click an item to update)</h5>
                            <ul id="inventory-list" class="list-group list-group-flush">
                                <li class="list-group-item text-center text-muted-subtle">Inventory will load here.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="tab-inventory-add" role="tabpanel" aria-labelledby="inventory-add-tab">
                        
                        <div class="card p-4 mb-4">
                            <h5 class="card-title text-success mb-3"><i class="fas fa-soap me-2"></i>Add New Detergent Stock</h5>
                            
                            <div class="tab-content" id="inventoryFormsTabContent">
                                <form id="detergent-form" class="row g-3">
                                    <div class="col-md-3">
                                        <label for="detergent-name" class="form-label text-muted-subtle">Detergent Name</label>
                                        <input type="text" class="form-control" id="detergent-name" list="detergent-recommendations" placeholder="e.g., Tide Pods" required>
                                        <datalist id="detergent-recommendations"></datalist>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="detergent-type" class="form-label text-muted-subtle">Type</label>
                                        <select class="form-select" id="detergent-type" required>
                                            <option value="Liquid">Liquid</option>
                                            <option value="Powder">Powder</option>
                                            <option value="Pods">Pods/Unit</option>
                                            <option value="Softener">Softener</option>
                                            <option value="Special">Special</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2"><label for="detergent-qty" class="form-label text-muted-subtle">Quantity (Units)</label><input type="number" min="0" class="form-control" id="detergent-qty" required value="1"></div>
                                    <div class="col-md-2"><label for="detergent-cost" class="form-label text-muted-subtle">Cost Per Unit (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="detergent-cost" value="0.00" required></div>
                                    <div class="col-md-2"><label for="detergent-vendor" class="form-label text-muted-subtle">Vendor</label><input type="text" class="form-control" id="detergent-vendor" placeholder="e.g., Supplier X"></div>
                                    
                                    <div class="col-12 text-end"><button type="submit" class="btn btn-success mt-2"><i class="fas fa-boxes-stacked me-2"></i>Add/Update Stock</button></div>
                                </form>
                                
                                </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
                 <div class="row g-4 mt-4"> 
                    <div class="col-md-12">
                        
                        <div class="card p-4 mb-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-calendar-alt me-2"></i>Filter Reports by Date</h5>
                            <form id="report-filter-form" class="row g-3">
                                <div class="col-md-5">
                                    <label for="filter-start-date" class="form-label text-muted-subtle">Start Date</label>
                                    <input type="date" class="form-control" id="filter-start-date">
                                </div>
                                <div class="col-md-5">
                                    <label for="filter-end-date" class="form-label text-muted-subtle">End Date</label>
                                    <input type="date" class="form-control" id="filter-end-date">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter me-2"></i>Filter</button>
                                </div>
                                <div class="col-12 text-end">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="clear-report-filter-btn"><i class="fas fa-redo me-1"></i>Clear Filter</button>
                                </div>
                            </form>
                        </div>
                        <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-chart-line me-2"></i>Financial Overview</h5>
                            
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="card p-3" style="border-left: 5px solid var(--color-success);">
                                        <p class="text-success fw-bold mb-0" id="total-client-payment">₱0.00</p>
                                        <small class="text-muted">Total Client Payments</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card p-3" style="border-left: 5px solid var(--color-danger);">
                                        <p class="text-danger fw-bold mb-0" id="grand-total-cost">₱0.00</p>
                                        <small class="text-muted">Total Estimated Expenses</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card p-3" style="border-left: 5px solid var(--color-info);">
                                        <p class="text-info fw-bold mb-0" id="total-net-revenue">₱0.00</p>
                                        <small class="text-muted">Net Revenue (Est.)</small>
                                    </div>
                                </div>
                                
                                <div class="col-12"><hr></div>

                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="total-orders">0</p>
                                        <small class="text-muted">Total Orders</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="remaining-orders">0</p>
                                        <small class="text-muted">Unfinished Orders</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="total-weight-kg">0.0 kg</p>
                                        <small class="text-muted">Total Weight Processed</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card p-3">
                                        <p class="text-dark fw-bold mb-0" id="revenue-per-kg">₱0.00</p>
                                        <small class="text-muted">Revenue Per Kg</small>
                                    </div>
                                </div>

                                <div class="col-12"><hr></div>
                                
                                <div class="col-md-4">
                                    <small class="text-muted">Cost Breakdown:</small>
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between">Base Service Cost: <span id="total-cost-est">₱0.00</span></li>
                                        <li class="list-group-item d-flex justify-content-between">Additional Charges: <span id="total-additional-cost">₱0.00</span></li>
                                        <li class="list-group-item d-flex justify-content-between">Est. Detergent/Supplies Cost: <span id="total-detergent-cost">₱0.00</span></li>
                                    </ul>
                                </div>
                            </div>
                            
                            </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="available-machines" role="tabpanel" aria-labelledby="available-machines-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="machineMainTabs" role="tablist"> <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="machines-view-tab" data-bs-toggle="tab" data-bs-target="#tab-machines-view" type="button" role="tab" aria-controls="tab-machines-view" aria-selected="true"><i class="fas fa-th-large me-2"></i>Machines Status</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="machine-add-tab" data-bs-toggle="tab" data-bs-target="#tab-machine-add" type="button" role="tab" aria-controls="tab-machine-add" aria-selected="false"><i class="fas fa-plus-circle me-2"></i>Add New Machine</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="machineMainTabContent">
                    
                    <div class="tab-pane fade show active" id="tab-machines-view" role="tabpanel" aria-labelledby="machines-view-tab">
                         <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-list-check me-2"></i>Current Machine Status Overview</h5>
                            <div class="row g-4" id="machines-grid-list">
                                <div class="col-12 text-center text-muted-subtle" id="machines-grid-placeholder">Machines will load here.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="tab-machine-add" role="tabpanel" aria-labelledby="machine-add-tab">
                         <div class="card p-4 mb-4">
                            <h5 class="text-info card-title mb-3"><i class="fas fa-washing-machine me-2"></i>Add New Machine Setup</h5>
                            <form id="machine-form" class="row g-3">
                                <div class="col-md-3"><label for="machine-name" class="form-label text-muted-subtle">Machine Name/ID</label><input type="text" class="form-control" id="machine-name" placeholder="e.g., Washer #1 / Dryer #A" required></div>
                                <div class="col-md-3">
                                    <label for="machine-type" class="form-label text-muted-subtle">Machine Type</label>
                                    <select class="form-select" id="machine-type" required>
                                        <option value="Washer">Washer</option>
                                        <option value="Dryer">Dryer</option>
                                    </select>
                                </div>
                                <div class="col-md-2"><label for="machine-capacity" class="form-label text-muted-subtle">Capacity (kg)</label><input type="number" step="0.1" min="1" class="form-control" id="machine-capacity" required value="10.0"></div>
                                <div class="col-md-4"><label for="machine-purchase-date" class="form-label text-muted-subtle">Date Purchase</label><input type="date" class="form-control" id="machine-purchase-date"></div>
                                <div class="col-md-9"><label for="machine-notes" class="form-label text-muted-subtle">Notes (Model, Location)</label><textarea class="form-control" id="machine-notes" rows="1"></textarea></div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <div class="form-check form-switch w-100">
                                        <input class="form-check-input" type="checkbox" role="switch" id="machine-under-maintenance">
                                        <label class="form-check-label" for="machine-under-maintenance">Under Maintenance</label>
                                    </div>
                                </div>
                                <div class="col-12 text-end"><button type="submit" class="btn btn-info mt-2"><i class="fas fa-save me-2"></i>Save Machine</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="workforce" role="tabpanel" aria-labelledby="workforce-tab">
                <div class="card p-4 mb-4 mt-4">
                    <h5 class="text-success card-title mb-3"><i class="fas fa-user-plus me-2"></i>Add New Employee</h5>
                    <form id="workforce-form" class="row g-3">
                        <div class="col-md-3"><label for="employee-name" class="form-label text-muted-subtle">Employee Name</label><input type="text" class="form-control" id="employee-name" required placeholder="e.g., John Smith"></div>
                        <div class="col-md-3">
                            <label for="employee-type" class="form-label text-muted-subtle">Employee Type</label>
                            <select class="form-select" id="employee-type" required>
                                <option value="Agent">Agent (Shop)</option>
                                <option value="Delivery">Delivery (Driver)</option>
                                <option value="Driver">Driver (Logistics)</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>
                        <div class="col-md-3"><label for="employee-salary" class="form-label text-muted-subtle">Base Salary (₱)</label><input type="number" step="0.01" min="0" class="form-control" id="employee-salary" value="0.00" required></div>
                        <div class="col-md-3">
                            <label for="employee-rate-type" class="form-label text-muted-subtle">Rate Type</label>
                            <select class="form-select" id="employee-rate-type" required>
                                <option value="Monthly">Monthly Rate</option>
                                <option value="Daily">Daily Rate</option>
                            </select>
                        </div>
                        <div class="col-12 text-end"><button type="submit" class="btn btn-success mt-2"><i class="fas fa-user-check me-2"></i>Add Employee</button></div>
                    </form>
                </div>
                <div class="card p-4">
                    <h5 class="text-primary mb-3"><i class="fas fa-users-gear me-2"></i>Current Workforce</h5>
                    <ul id="workforce-list" class="list-group list-group-flush">
                        <li class="list-group-item text-center text-muted-subtle">Workforce will load here.</li>
                    </ul>
                </div>
            </div>
            
            <div class="tab-pane fade" id="customers" role="tabpanel" aria-labelledby="customers-tab">
                <ul class="nav nav-tabs mb-4 mt-4" id="customerMainTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="customer-add-tab" data-bs-toggle="tab" data-bs-target="#tab-customer-add" type="button" role="tab" aria-controls="tab-customer-add" aria-selected="false"><i class="fas fa-address-card me-2"></i>Register New</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="customer-view-tab" data-bs-toggle="tab" data-bs-target="#tab-customer-view" type="button" role="tab" aria-controls="tab-customer-view" aria-selected="true"><i class="fas fa-user-friends me-2"></i>Customer List</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="customer-id-tab" data-bs-toggle="tab" data-bs-target="#tab-customer-id" type="button" role="tab" aria-controls="tab-customer-id" aria-selected="false"><i class="fas fa-qrcode me-2"></i>Generate ID Card</button>
                    </li>
                </ul>

                <div class="tab-content" id="customerMainTabContent">
                    
                    <div class="tab-pane fade" id="tab-customer-add" role="tabpanel" aria-labelledby="customer-add-tab">
                        <div class="card p-4 mb-4">
                            <h5 class="text-info card-title mb-3"><i class="fas fa-address-card me-2"></i>Register New Customer</h5>
                            <form id="customer-form" class="row g-3">
                                <div class="col-md-4"><label for="customer-reg-name" class="form-label text-muted-subtle">Full Name</label><input type="text" class="form-control" id="customer-reg-name" required placeholder="e.g., Jane Doe"></div>
                                <div class="col-md-2"><label for="customer-reg-contact" class="form-label text-muted-subtle">Contact Number</label><input type="tel" class="form-control" id="customer-reg-contact" required placeholder="e.g., 09xxxxxxxxx"></div>
                                <div class="col-md-2"><label for="customer-reg-age" class="form-label text-muted-subtle">Age</label><input type="number" min="1" class="form-control" id="customer-reg-age" placeholder="e.g., 35"></div>
                                <div class="col-md-4"><label for="customer-reg-address" class="form-label text-muted-subtle">Address</label><input type="text" class="form-control" id="customer-reg-address" placeholder="e.g., 123 Main St."></div>
                                <div class="col-12 text-end"><button type="submit" class="btn btn-info mt-2"><i class="fas fa-user-check me-2"></i>Register Customer</button></div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade show active" id="tab-customer-view" role="tabpanel" aria-labelledby="customer-view-tab">
                        <div class="card p-4">
                            <h5 class="text-primary mb-3"><i class="fas fa-list me-2"></i>Registered Customer List (Click to Edit)</h5>
                            <ul id="customer-list" class="list-group list-group-flush">
                                <li class="list-group-item text-center text-muted-subtle">Customers will load here.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="tab-pane fade" id="tab-customer-id" role="tabpanel" aria-labelledby="customer-id-tab">
                        <div class="card p-4 mb-4">
                            <h5 class="text-info card-title mb-3"><i class="fas fa-qrcode me-2"></i>Customer ID Card Generator</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="id-customer-select" class="form-label text-muted-subtle">Select Customer to Print ID</label>
                                    <select class="form-select" id="id-customer-select" required>
                                        <option value="" selected disabled>-- Choose Customer --</option>
                                        </select>
                                </div>
                                <div class="col-md-6 d-flex align-items-end">
                                    <button type="button" class="btn btn-outline-info w-100" id="generate-id-btn" disabled><i class="fas fa-id-card me-2"></i>Generate/Preview ID</button>
                                </div>
                            </div>
                            
                            <div id="id-card-preview" class="id-card-container d-none">
                                <div class="id-card-header">LAUNDRY CUSTOMER LOYALTY CARD</div>
                                <div class="id-card-photo"><i class="fas fa-camera"></i> Photo</div>
                                <div class="id-card-details">
                                    <p><strong>Name:</strong> <span id="id-display-name">N/A</span></p>
                                    <p><strong>Contact:</strong> <span id="id-display-contact">N/A</span></p>
                                    <p><strong>Address:</strong> <span id="id-display-address">N/A</span></p>
                                    <p><strong>Reg. Date:</strong> <span id="id-display-datereg">N/A</span></p>
                                </div>
                                <div class="id-card-id">ID: <span id="id-display-id">CID-XXXXX</span></div>
                            </div>
                            
                            <div class="print-area d-none" id="id-card-print-area">
                                <button type="button" class="btn btn-primary mt-3"><i class="fas fa-print me-2"></i>Print ID Card</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="orderDetailModalLabel"><i class="fas fa-file-invoice me-2"></i>Order Details: <span id="modal-order-id"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="modal-order-content"></div>
                    <form id="modal-order-update-form" class="row g-3 mt-3">
                        <div class="col-md-6">
                            <label for="modal-update-status" class="form-label text-muted-subtle">Update Status</label>
                            <select class="form-select" id="modal-update-status" required>
                                <option value="Pending">Pending</option>
                                <option value="Washing">Washing</option>
                                <option value="Drying">Drying</option>
                                <option value="Folding">Folding</option>
                                <option value="Ready for Pickup">Ready for Pickup</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="modal-update-payment" class="form-label text-muted-subtle">Payment Status</label>
                            <select class="form-select" id="modal-update-payment" required>
                                <option value="Unpaid">Unpaid</option>
                                <option value="Partially Paid">Partially Paid</option>
                                <option value="Paid">Paid</option>
                            </select>
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Save Changes</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-order-btn"><i class="fas fa-trash me-2"></i>Delete Order</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="inventoryDetailModal" tabindex="-1" aria-labelledby="inventoryDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="inventoryDetailModalLabel"><i class="fas fa-box me-2"></i>Update Stock: <span id="modal-inventory-name"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modal-inventory-update-form" class="row g-3">
                        <input type="hidden" id="modal-inventory-id">
                        <div class="col-md-6">
                            <label for="modal-inventory-qty" class="form-label text-muted-subtle">New Quantity (Units)</label>
                            <input type="number" min="0" class="form-control" id="modal-inventory-qty" required>
                        </div>
                        <div class="col-md-6">
                            <label for="modal-inventory-cost" class="form-label text-muted-subtle">Cost Per Unit (₱)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="modal-inventory-cost" required>
                        </div>
                        <div class="col-12">
                            <label for="modal-inventory-vendor" class="form-label text-muted-subtle">Vendor</label>
                            <input type="text" class="form-control" id="modal-inventory-vendor">
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-info mt-2"><i class="fas fa-save me-2"></i>Update Stock</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-inventory-btn"><i class="fas fa-trash me-2"></i>Delete Item</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="machineDetailModal" tabindex="-1" aria-labelledby="machineDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="machineDetailModalLabel"><i class="fas fa-washing-machine me-2"></i>Machine Status: <span id="modal-machine-name"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modal-machine-update-form" class="row g-3">
                        <input type="hidden" id="modal-machine-id">
                        <div class="col-md-6">
                            <label for="modal-machine-status" class="form-label text-muted-subtle">Current Status</label>
                            <select class="form-select" id="modal-machine-status" required>
                                <option value="available">Available</option>
                                <option value="in-use">In Use</option>
                                <option value="maintenance">Under Maintenance</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="modal-machine-capacity" class="form-label text-muted-subtle">Capacity (kg)</label>
                            <input type="number" step="0.1" min="1" class="form-control" id="modal-machine-capacity" required>
                        </div>
                        <div class="col-12">
                            <label for="modal-machine-notes" class="form-label text-muted-subtle">Notes (Model, Location)</label>
                            <textarea class="form-control" id="modal-machine-notes" rows="1"></textarea>
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-warning mt-2 text-dark"><i class="fas fa-save me-2"></i>Update Status</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-machine-btn"><i class="fas fa-trash me-2"></i>Remove Machine</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="employeeDetailModal" tabindex="-1" aria-labelledby="employeeDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="employeeDetailModalLabel"><i class="fas fa-user-gear me-2"></i>Update Employee: <span id="modal-employee-name"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modal-employee-update-form" class="row g-3">
                        <input type="hidden" id="modal-employee-id">
                        <div class="col-md-6">
                            <label for="modal-employee-type" class="form-label text-muted-subtle">Employee Type</label>
                            <select class="form-select" id="modal-employee-type" required>
                                <option value="Agent">Agent (Shop)</option>
                                <option value="Delivery">Delivery (Driver)</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="modal-employee-salary" class="form-label text-muted-subtle">Base Salary (₱)</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="modal-employee-salary" required>
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-success mt-2"><i class="fas fa-save me-2"></i>Update Employee</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-employee-btn"><i class="fas fa-trash me-2"></i>Remove Employee</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="customerDetailModal" tabindex="-1" aria-labelledby="customerDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="customerDetailModalLabel"><i class="fas fa-user-edit me-2"></i>Update Customer: <span id="modal-customer-name"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modal-customer-update-form" class="row g-3">
                        <input type="hidden" id="modal-customer-id">
                        <div class="col-md-6">
                            <label for="modal-customer-contact" class="form-label text-muted-subtle">Contact Number</label>
                            <input type="tel" class="form-control" id="modal-customer-contact" required>
                        </div>
                        <div class="col-md-6">
                            <label for="modal-customer-address" class="form-label text-muted-subtle">Address</label>
                            <input type="text" class="form-control" id="modal-customer-address">
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-info mt-2"><i class="fas fa-save me-2"></i>Update Customer</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-customer-btn"><i class="fas fa-trash me-2"></i>Remove Customer</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="cloudSyncModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="cloudSyncModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="cloudSyncModalLabel"><i class="fas fa-cloud me-2"></i>Cloud Sync Setup</h5>
                </div>
                <div class="modal-body start-sync-modal-body">
                    <p class="text-muted">Choose your data storage mode. You can change this later in settings (not yet implemented).</p>
                    <button id="sync-google-btn" class="google-sign-in-btn">
                        <i class="fab fa-google me-2"></i>Sign in with Google (Cloud Sync)
                    </button>
                    <button id="sync-local-btn" class="btn guest-button">
                        <i class="fas fa-desktop me-2"></i>Continue Locally (Local Storage)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- DATA MANAGEMENT (Mock Data for Local Storage) ---
        let storageMode = 'local'; // Default to local until explicitly set
        let ORDERS = [];
        let INVENTORY = [];
        let MACHINES = [];
        let WORKFORCE = [];
        let CUSTOMERS = [];
        const PAGE_SIZE = 10;
        let currentPage = 1;

        // Utility to save to Local Storage (synchronously)
        function saveDataLocally() {
            localStorage.setItem('orders', JSON.stringify(ORDERS));
            localStorage.setItem('inventory', JSON.stringify(INVENTORY));
            localStorage.setItem('machines', JSON.stringify(MACHINES));
            localStorage.setItem('workforce', JSON.stringify(WORKFORCE));
            localStorage.setItem('customers', JSON.stringify(CUSTOMERS));
            // console.log("Data saved locally.");
            showToast('Data saved locally!', 'success');
        }

        // Utility to load from Local Storage (synchronously)
        function loadDataLocally() {
            ORDERS = JSON.parse(localStorage.getItem('orders')) || [];
            INVENTORY = JSON.parse(localStorage.getItem('inventory')) || [];
            MACHINES = JSON.parse(localStorage.getItem('machines')) || [];
            WORKFORCE = JSON.parse(localStorage.getItem('workforce')) || [];
            CUSTOMERS = JSON.parse(localStorage.getItem('customers')) || [];
            // console.log("Data loaded locally.");
        }

        // Function to show a custom toast message
        function showToast(message, type = 'info') {
            const toastContainer = $('#toast-container');
            const toast = $(`<div class="custom-toast bg-${type}">${message}</div>`);
            
            toastContainer.append(toast);

            setTimeout(() => {
                toast.addClass('show');
            }, 10); // Small delay for CSS transition to work

            setTimeout(() => {
                toast.removeClass('show');
                setTimeout(() => {
                    toast.remove();
                }, 500); // Wait for transition to finish before removing
            }, 3000);
        }
        
        // Utility to generate unique ID
        function generateId(prefix) {
            return prefix + Math.random().toString(36).substring(2, 9).toUpperCase();
        }
        
        // --- DATA CRUD FUNCTIONS (Mocks) ---
        
        // Order CRUD (Mocked)
        function saveOrder(order) {
            if (order.id) {
                const index = ORDERS.findIndex(o => o.id === order.id);
                if (index !== -1) ORDERS[index] = order;
            } else {
                order.id = generateId('ORD');
                order.dateCreated = new Date().toISOString().substring(0, 10);
                ORDERS.unshift(order); // Add to the front for easier viewing
            }
            saveDataLocally();
            renderOrderList();
            renderSummaryStats();
            return order.id;
        }

        function deleteOrderData(id) {
            ORDERS = ORDERS.filter(o => o.id !== id);
            saveDataLocally();
            renderOrderList();
            renderSummaryStats();
            showToast(`Order ${id} deleted.`, 'danger');
        }

        // Inventory CRUD (Mocked)
        function saveInventoryItem(item) {
            let existingItem = INVENTORY.find(i => i.name.toLowerCase() === item.name.toLowerCase());
            if (existingItem) {
                existingItem.quantity = parseFloat(existingItem.quantity) + parseFloat(item.quantity);
                existingItem.costPerUnit = item.costPerUnit;
                existingItem.vendor = item.vendor;
                showToast(`Stock updated for ${item.name}.`, 'warning');
            } else {
                item.id = generateId('INV');
                item.quantity = parseFloat(item.quantity);
                item.minStockLevel = 5; // Default for mock
                INVENTORY.push(item);
                showToast(`New item ${item.name} added.`, 'success');
            }
            saveDataLocally();
            renderInventoryList();
            renderLowStockAlert();
            populateOrderDropdowns(); // Refresh dropdown on new stock add/update
        }
        
        function updateInventoryItem(id, updates) {
            const index = INVENTORY.findIndex(i => i.id === id);
            if (index !== -1) {
                INVENTORY[index] = { ...INVENTORY[index], ...updates };
                saveDataLocally();
                renderInventoryList();
                renderLowStockAlert();
                populateOrderDropdowns(); // Re-populate order dropdowns to update stock count
                showToast(`Inventory item updated.`, 'info');
            }
        }

        // NEW: Function to deduct 1 unit from inventory
        function deductInventory(detergentId) {
            const item = INVENTORY.find(i => i.id === detergentId);
            if (item && item.quantity > 0) {
                const updates = { quantity: item.quantity - 1 };
                // Call the existing update function to handle saving, rendering, and dropdown refresh
                updateInventoryItem(detergentId, updates);
                showToast(`Deducted 1 unit of ${item.name} from inventory.`, 'success');
            } else if (item) {
                 showToast(`${item.name} is out of stock! Deduction failed.`, 'danger');
            }
        }
        
        function deleteInventoryItem(id) {
            INVENTORY = INVENTORY.filter(i => i.id !== id);
            saveDataLocally();
            renderInventoryList();
            renderLowStockAlert();
            populateOrderDropdowns(); // Refresh dropdown after deletion
            showToast(`Inventory item deleted.`, 'danger');
        }
        
        // Machine CRUD (Mocked)
        function saveMachine(machine) {
            if (machine.id) {
                const index = MACHINES.findIndex(m => m.id === machine.id);
                if (index !== -1) MACHINES[index] = machine;
            } else {
                machine.id = generateId('MCH');
                machine.status = 'available';
                MACHINES.push(machine);
                showToast(`New machine ${machine.name} added.`, 'success');
            }
            saveDataLocally();
            renderMachineGrid();
            populateOrderDropdowns(); // Refresh machine dropdowns
        }

        // NEW: Utility to update only the status
        function updateMachineStatus(machineId, status) {
            const machine = MACHINES.find(m => m.id === machineId);
            if (machine) {
                machine.status = status;
                saveMachine(machine); // Reuses the save/update logic
                showToast(`Machine ${machine.name} status set to ${status}.`, 'info');
            }
        }
        
        function deleteMachineData(id) {
            MACHINES = MACHINES.filter(m => m.id !== id);
            saveDataLocally();
            renderMachineGrid();
            populateOrderDropdowns(); // Refresh machine dropdowns
            showToast(`Machine deleted.`, 'danger');
        }

        // Workforce CRUD (Mocked)
        function saveEmployee(employee) {
            if (!employee.id) {
                employee.id = generateId('EMP');
                employee.dateHired = new Date().toISOString().substring(0, 10);
                WORKFORCE.push(employee);
                showToast(`New employee ${employee.name} added.`, 'success');
            } else {
                const index = WORKFORCE.findIndex(e => e.id === employee.id);
                if (index !== -1) WORKFORCE[index] = employee;
                showToast(`Employee ${employee.name} updated.`, 'info');
            }
            saveDataLocally();
            renderWorkforceList();
            populateOrderDropdowns(); // Refresh staff dropdown
        }
        
        function deleteEmployeeData(id) {
            WORKFORCE = WORKFORCE.filter(e => e.id !== id);
            saveDataLocally();
            renderWorkforceList();
            populateOrderDropdowns(); // Refresh staff dropdown
            showToast(`Employee deleted.`, 'danger');
        }

        // Customer CRUD (Mocked)
        function saveCustomer(customer) {
            if (!customer.id) {
                customer.id = generateId('CUS');
                customer.dateRegistered = new Date().toISOString().substring(0, 10);
                CUSTOMERS.push(customer);
                showToast(`New customer ${customer.name} registered.`, 'success');
            } else {
                const index = CUSTOMERS.findIndex(c => c.id === customer.id);
                if (index !== -1) CUSTOMERS[index] = customer;
                showToast(`Customer ${customer.name} updated.`, 'info');
            }
            saveDataLocally();
            renderCustomerList();
            populateOrderDropdowns(); // Refresh customer dropdown
        }

        function updateCustomerData(id, updates) {
            const index = CUSTOMERS.findIndex(c => c.id === id);
            if (index !== -1) {
                CUSTOMERS[index] = { ...CUSTOMERS[index], ...updates };
                saveDataLocally();
                renderCustomerList();
                populateOrderDropdowns(); // Refresh customer dropdown
                showToast(`Customer updated.`, 'info');
            }
        }
        
        function deleteCustomerData(id) {
            CUSTOMERS = CUSTOMERS.filter(c => c.id !== id);
            saveDataLocally();
            renderCustomerList();
            populateOrderDropdowns(); // Refresh customer dropdown
            showToast(`Customer deleted.`, 'danger');
        }

        // --- RENDERING FUNCTIONS ---

        function renderSummaryStats(ordersList = ORDERS) {
            // Use provided list or default to all orders
            const ordersToUse = ordersList;
            
            const totalOrders = ordersToUse.length;
            const remainingOrders = ordersToUse.filter(o => o.status !== 'Completed' && o.status !== 'Cancelled').length;
            const totalClientPayment = ordersToUse.reduce((sum, o) => sum + parseFloat(o.totalPrice || 0), 0);

            // --- Home Tab Stats (Only update All-Time data) ---
            if (ordersList === ORDERS) {
                $('#total-orders-card').text(totalOrders);
                $('#remaining-orders-card').text(remainingOrders);
                $('#total-client-payment-card').text('₱' + totalClientPayment.toFixed(2));
            }
            
            // --- Reports Tab Stats ---
            const totalCost = ordersToUse.reduce((sum, o) => sum + parseFloat(o.baseCost || 0), 0); // Using a simplified total cost for mock
            const totalWeight = ordersToUse.reduce((sum, o) => sum + parseFloat(o.weightKg || 0), 0);
            
            $('#total-orders').text(totalOrders);
            $('#remaining-orders').text(remainingOrders);
            $('#total-client-payment').text('₱' + totalClientPayment.toFixed(2));
            $('#total-weight-kg').text(totalWeight.toFixed(1) + ' kg');
            $('#revenue-per-kg').text(totalWeight > 0 ? '₱' + (totalClientPayment / totalWeight).toFixed(2) : '₱0.00');

            // Simplified cost breakdown (needs real implementation)
            const totalDetergentCost = INVENTORY.reduce((sum, item) => sum + (item.costPerUnit * (10 - item.quantity)), 0); // Mock usage
            $('#total-cost-est').text('₱' + totalCost.toFixed(2));
            $('#total-additional-cost').text('₱0.00'); // Mock
            $('#total-detergent-cost').text('₱' + totalDetergentCost.toFixed(2));
            $('#grand-total-cost').text('₱' + (totalCost + totalDetergentCost).toFixed(2));
            $('#total-net-revenue').text('₱' + (totalClientPayment - (totalCost + totalDetergentCost)).toFixed(2));
        }

        function renderOrderList() {
            const list = $('#order-list-ul');
            list.empty();
            
            const filteredOrders = ORDERS.sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated));
            const totalPages = Math.ceil(filteredOrders.length / PAGE_SIZE);
            
            currentPage = Math.min(currentPage, totalPages > 0 ? totalPages : 1);
            
            const start = (currentPage - 1) * PAGE_SIZE;
            const end = start + PAGE_SIZE;
            const paginatedOrders = filteredOrders.slice(start, end);

            if (paginatedOrders.length === 0) {
                list.append('<li class="list-group-item text-center text-muted-subtle">No orders found.</li>');
            } else {
                paginatedOrders.forEach(order => {
                    let statusClass = 'list-group-item-light';
                    if (order.status === 'Ready for Pickup') statusClass = 'list-group-item-warning';
                    if (order.status === 'Completed') statusClass = 'list-group-item-success';
                    if (order.status === 'Cancelled') statusClass = 'list-group-item-danger';
                    if (order.status === 'Washing' || order.status === 'Drying') statusClass = 'list-group-item-info';

                    list.append(`
                        <li class="list-group-item ${statusClass} d-flex justify-content-between align-items-center order-list-item" data-id="${order.id}" style="cursor: pointer;">
                            <div>
                                <strong>#${order.id}</strong> - ${order.customerName} (${order.dateCreated})
                                <small class="text-muted d-block">${order.serviceType} / ${order.weightKg}kg</small>
                            </div>
                            <div>
                                <span class="badge bg-secondary me-2">₱${parseFloat(order.totalPrice).toFixed(2)}</span>
                                <span class="badge bg-primary">${order.status}</span>
                            </div>
                        </li>
                    `);
                });
            }
            
            $('#page-info').text(`Page ${currentPage} of ${totalPages}`);
            $('#prev-page-btn').prop('disabled', currentPage === 1 || totalPages === 0);
            $('#next-page-btn').prop('disabled', currentPage === totalPages || totalPages === 0);
            
            // Re-attach event listeners for dynamic content
            $('.order-list-item').on('click', handleOrderView);
        }
        
        function renderInventoryList() {
            const list = $('#inventory-list');
            list.empty();
            
            const filterName = $('#filter-name').val()?.toLowerCase() || '';
            const filterType = $('#filter-type').val()?.toLowerCase() || '';
            const filterVendor = $('#filter-vendor').val()?.toLowerCase() || '';
            
            const filteredInventory = INVENTORY.filter(item => {
                return (
                    (filterName === '' || item.name.toLowerCase().includes(filterName) || item.type.toLowerCase().includes(filterName)) &&
                    (filterType === '' || item.type.toLowerCase() === filterType) &&
                    (filterVendor === '' || item.vendor.toLowerCase().includes(filterVendor))
                );
            }).sort((a, b) => a.name.localeCompare(b.name));

            if (filteredInventory.length === 0) {
                list.append('<li class="list-group-item text-center text-muted-subtle">No inventory items match the filter.</li>');
            } else {
                filteredInventory.forEach(item => {
                    let statusClass = 'list-group-item-light';
                    if (item.quantity <= item.minStockLevel) statusClass = 'list-group-item-danger';
                    
                    list.append(`
                        <li class="list-group-item ${statusClass} d-flex justify-content-between align-items-center inventory-item-row" data-id="${item.id}">
                            <div>
                                <strong>${item.name}</strong> (${item.type})
                                <small class="text-muted d-block">Cost/Unit: ₱${parseFloat(item.costPerUnit).toFixed(2)}</small>
                            </div>
                            <div>
                                <span class="badge bg-info me-2">Qty: ${item.quantity}</span>
                                <span class="badge bg-secondary">${item.vendor || 'N/A'}</span>
                            </div>
                        </li>
                    `);
                });
            }
            
            // Re-attach event listeners
            $('.inventory-item-row').on('click', handleInventoryView);
        }
        
        function renderLowStockAlert() {
            const lowStockItems = INVENTORY.filter(item => item.quantity <= item.minStockLevel);
            const alertDiv = $('#low-stock-alert');
            const list = $('#low-stock-list');
            list.empty();
            
            if (lowStockItems.length > 0) {
                lowStockItems.forEach(item => {
                    list.append(`<li>${item.name} (${item.type}) - Only ${item.quantity} left.</li>`);
                });
                alertDiv.removeClass('d-none');
            } else {
                alertDiv.addClass('d-none');
            }
        }
        
        function renderMachineGrid() {
            const grid = $('#machines-grid-list');
            grid.empty();
            
            if (MACHINES.length === 0) {
                grid.append('<div class="col-12 text-center text-muted-subtle">No machines registered.</div>');
                return;
            }
            
            MACHINES.sort((a, b) => a.name.localeCompare(b.name)).forEach(machine => {
                let statusBg = 'bg-success'; // available
                let statusText = 'Available';
                if (machine.status === 'in-use') {
                    statusBg = 'bg-warning';
                    statusText = 'In Use';
                } else if (machine.status === 'maintenance') {
                    statusBg = 'bg-danger';
                    statusText = 'Maint.';
                }
                
                grid.append(`
                    <div class="col-md-4">
                        <div class="card machine-card-item h-100" data-id="${machine.id}" style="border: 1px solid ${statusBg === 'bg-danger' ? 'var(--color-danger)' : statusBg === 'bg-warning' ? 'var(--color-warning)' : 'var(--color-success)'};">
                            <div class="card-body">
                                <h5 class="card-title">${machine.name} <span class="badge ${statusBg}">${statusText}</span></h5>
                                <p class="card-text mb-1"><i class="fas fa-box me-1"></i> ${machine.type}</p>
                                <p class="card-text mb-1"><i class="fas fa-weight-hanging me-1"></i> Capacity: ${machine.capacity} kg</p>
                                <p class="card-text mb-0"><small class="text-muted">Notes: ${machine.notes || 'N/A'}</small></p>
                            </div>
                            <div class="card-footer ${statusBg} text-white">
                                <a href="#" class="d-block update-machine-status" data-id="${machine.id}">Update Status <i class="fas fa-arrow-right ms-1"></i></a>
                            </div>
                        </div>
                    </div>
                `);
            });
            
            // Re-attach event listener
            $('.update-machine-status').on('click', handleMachineView);
        }

        function renderWorkforceList() {
            const list = $('#workforce-list');
            list.empty();
            
            if (WORKFORCE.length === 0) {
                list.append('<li class="list-group-item text-center text-muted-subtle">No employees registered.</li>');
                return;
            }
            
            WORKFORCE.sort((a, b) => a.name.localeCompare(b.name)).forEach(employee => {
                const badgeClass = employee.type === 'Manager' ? 'bg-primary' : employee.type === 'Delivery' ? 'bg-warning text-dark' : 'bg-info';
                
                list.append(`
                    <li class="list-group-item d-flex justify-content-between align-items-center workforce-item-row" data-id="${employee.id}" style="cursor: pointer;">
                        <div>
                            <strong>${employee.name}</strong> (${employee.dateHired})
                            <small class="text-muted d-block">Rate: ₱${parseFloat(employee.baseSalary).toFixed(2)} / ${employee.rateType}</small>
                        </div>
                        <span class="badge ${badgeClass}">${employee.type}</span>
                    </li>
                `);
            });
            
            // Re-attach event listener
            $('.workforce-item-row').on('click', handleEmployeeView);
        }

        function renderCustomerList() {
            const list = $('#customer-list');
            list.empty();
            const idSelect = $('#id-customer-select');
            idSelect.empty().append('<option value="" selected disabled>-- Choose Customer --</option>');

            if (CUSTOMERS.length === 0) {
                list.append('<li class="list-group-item text-center text-muted-subtle">No customers registered.</li>');
                $('#generate-id-btn').prop('disabled', true);
                return;
            }
            
            CUSTOMERS.sort((a, b) => a.name.localeCompare(b.name)).forEach(customer => {
                list.append(`
                    <li class="list-group-item d-flex justify-content-between align-items-center customer-item-row" data-id="${customer.id}" style="cursor: pointer;">
                        <div>
                            <strong>${customer.name}</strong> (${customer.id})
                            <small class="text-muted d-block">Contact: ${customer.contact || 'N/A'}</small>
                        </div>
                        <span class="badge bg-secondary">${customer.dateRegistered}</span>
                    </li>
                `);
                
                idSelect.append(`<option value="${customer.id}">${customer.name} (${customer.id})</option>`);
            });
            
            $('#generate-id-btn').prop('disabled', false);

            // Re-attach event listener
            $('.customer-item-row').on('click', handleCustomerView);
            
            // Also need to re-populate the customer dropdown in the order tab
            populateOrderDropdowns();
        }
        
        // --- EVENT HANDLERS ---
        
        function handleOrderView(event) {
            const orderId = $(event.currentTarget).data('id');
            const order = ORDERS.find(o => o.id === orderId);
            
            if (order) {
                $('#modal-order-id').text(order.id);
                $('#modal-update-status').val(order.status);
                $('#modal-update-payment').val(order.paymentStatus || 'Unpaid');
                
                const content = `
                    <p class="mb-1"><strong>Customer:</strong> ${order.customerName}</p>
                    <p class="mb-1"><strong>Service:</strong> ${order.serviceType} (${order.weightKg} kg)</p>
                    <p class="mb-1"><strong>Price:</strong> ₱${parseFloat(order.totalPrice).toFixed(2)} (Deposit: ₱${parseFloat(order.deposit || 0).toFixed(2)})</p>
                    <p class="mb-1"><strong>Pickup:</strong> ${order.pickupDate} at ${order.pickupTime}</p>
                    <p class="mb-1"><strong>Staff:</strong> ${order.staffInCharge || 'N/A'}</p>
                    <p class="mb-0"><strong>Notes:</strong> ${order.notes || 'None'}</p>
                    <input type="hidden" id="modal-order-hidden-id" value="${order.id}">
                `;
                $('#modal-order-content').html(content);
                
                // Set the ID for the delete button
                $('#delete-order-btn').data('id', order.id);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
                modal.show();
            }
        }
        
        function handleInventoryView(event) {
            const itemId = $(event.currentTarget).data('id');
            const item = INVENTORY.find(i => i.id === itemId);
            
            if (item) {
                $('#modal-inventory-name').text(item.name);
                $('#modal-inventory-id').val(item.id);
                $('#modal-inventory-qty').val(item.quantity);
                $('#modal-inventory-cost').val(item.costPerUnit);
                $('#modal-inventory-vendor').val(item.vendor);
                
                // Set the ID for the delete button
                $('#delete-inventory-btn').data('id', item.id);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('inventoryDetailModal'));
                modal.show();
            }
        }
        
        function handleMachineView(event) {
            event.preventDefault();
            const machineId = $(event.currentTarget).data('id');
            const machine = MACHINES.find(m => m.id === machineId);

            if (machine) {
                $('#modal-machine-name').text(machine.name);
                $('#modal-machine-id').val(machine.id);
                $('#modal-machine-status').val(machine.status);
                $('#modal-machine-capacity').val(machine.capacity);
                $('#modal-machine-notes').val(machine.notes);

                // Set the ID for the delete button
                $('#delete-machine-btn').data('id', machine.id);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('machineDetailModal'));
                modal.show();
            }
        }

        function handleEmployeeView(event) {
            const employeeId = $(event.currentTarget).data('id');
            const employee = WORKFORCE.find(e => e.id === employeeId);

            if (employee) {
                $('#modal-employee-name').text(employee.name);
                $('#modal-employee-id').val(employee.id);
                $('#modal-employee-type').val(employee.type);
                $('#modal-employee-salary').val(employee.baseSalary);

                // Set the ID for the delete button
                $('#delete-employee-btn').data('id', employee.id);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('employeeDetailModal'));
                modal.show();
            }
        }

        function handleCustomerView(event) {
            const customerId = $(event.currentTarget).data('id');
            const customer = CUSTOMERS.find(c => c.id === customerId);

            if (customer) {
                $('#modal-customer-name').text(customer.name);
                $('#modal-customer-id').val(customer.id);
                $('#modal-customer-contact').val(customer.contact);
                $('#modal-customer-address').val(customer.address);

                // Set the ID for the delete button
                $('#delete-customer-btn').data('id', customer.id);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('customerDetailModal'));
                modal.show();
            }
        }
        
        // --- INITIALIZATION & MAIN FUNCTION ---
        
        // --- START: NEW JAVASCRIPT LOGIC FOR ORDER TAB ---

        // MOCK DATA (Replace with actual data retrieval from your system/database)
        const MOCK_CUSTOMERS = [
            { id: 'CUST001', name: 'Alice Johnson', contact: '0917-123-4567', address: '123 Main St, Quezon City', dateRegistered: '2023-01-15' },
            { id: 'CUST002', name: 'Bob Williams', contact: '0918-987-6543', address: '456 Elm St, Makati', dateRegistered: '2023-03-22' },
            { id: 'CUST003', name: 'Jane Doe', contact: '0999-555-1212', address: '789 Oak St, Manila', dateRegistered: '2024-05-01' }
        ];

        const MOCK_MACHINES = [
            { id: 'M01', name: 'Washer #1 (10kg)', status: 'available' },
            { id: 'M02', name: 'Washer #2 (15kg)', status: 'in-use' }, // This will be disabled
            { id: 'M03', name: 'Dryer #A (20kg)', status: 'available' }
        ];

        const MOCK_STAFF = [
            { id: 'S001', name: 'Maria Dela Cruz (Agent)', type: 'Agent' },
            { id: 'S002', name: 'Ramon Garcia (Manager)', type: 'Manager' },
            { id: 'S003', name: 'Sofia Reyes (Delivery)', type: 'Delivery' }
        ];

        // Function to populate the Customer, Machine, and Staff dropdowns
        function populateOrderDropdowns() {
            const customerDropdown = $('#customer-dropdown');
            const machineDropdown = $('#machine-dropdown');
            const staffDropdown = $('#staff-dropdown');
            const detergentDropdown = $('#detergent-dropdown'); // Added

            // Clear existing options, keeping the default disabled one
            customerDropdown.find('option:not(:first)').remove();
            machineDropdown.find('option:not(:first)').remove();
            staffDropdown.find('option:not(:first)').remove();
            detergentDropdown.find('option:not(:first)').remove(); // Added

            // Use the actual CUSTOMERS array (from local storage load) if available, otherwise use mock
            const customerSource = CUSTOMERS.length > 0 ? CUSTOMERS : MOCK_CUSTOMERS;
            
            // 1. Populate Customer Dropdown
            customerSource.forEach(customer => {
                customerDropdown.append(
                    `<option value="${customer.id}" 
                             data-name="${customer.name}"
                             data-contact="${customer.contact || 'N/A'}"
                             data-address="${customer.address || 'N/A'}"
                             data-datereg="${customer.dateRegistered || 'N/A'}">
                             ${customer.name} (${customer.id})
                    </option>`
                );
            });

            // Use the actual MACHINES array if available, otherwise use mock
            const machineSource = MACHINES.length > 0 ? MACHINES : MOCK_MACHINES;

            // 2. Populate Machine Dropdown (with status check)
            machineSource.forEach(machine => {
                const statusText = machine.status === 'available' ? 'Available' : (machine.status === 'in-use' ? 'In Use' : 'Maint.');
                const disabledAttr = machine.status !== 'available' ? 'disabled' : '';
                const statusClass = machine.status === 'available' ? 'text-success' : 'text-danger';

                machineDropdown.append(
                    `<option value="${machine.id}" ${disabledAttr} class="${statusClass}">${machine.name} - [${statusText}]</option>`
                );
            });

            // Use the actual WORKFORCE array if available, otherwise use mock
            const staffSource = WORKFORCE.length > 0 ? WORKFORCE : MOCK_STAFF;

            // 3. Populate Staff Dropdown (from agents workforce)
            staffSource.forEach(staff => {
                staffDropdown.append(
                    `<option value="${staff.id}">${staff.name}</option>`
                );
            });

            // 4. Populate Detergent Dropdown (from INVENTORY)
            // Filter inventory for detergents/softeners/pods
            const detergentInventory = INVENTORY.filter(item => 
                item.type === 'Liquid' || 
                item.type === 'Powder' || 
                item.type === 'Pods' || 
                item.type === 'Softener' || 
                item.type === 'Special'
            ).sort((a, b) => a.name.localeCompare(b.name));
            
            // Add the "No Detergent" option first (use unique ID 'NO_DETERGENT' for value and 'N/A' for inventory-id)
            detergentDropdown.append(
                `<option value="NO_DETERGENT (Customer's Own)" data-inventory-id="N/A">No Detergent (Customer's Own)</option>`
            );

            detergentInventory.forEach(item => {
                const disabledAttr = item.quantity < 1 ? 'disabled' : '';
                const stockText = item.quantity < 1 ? ' (OUT OF STOCK)' : ` (Qty: ${item.quantity})`;
                const stockClass = item.quantity < 1 ? 'text-danger' : 'text-success';
                
                // Value stores the displayed name, data-inventory-id stores the ID for deduction
                detergentDropdown.append(
                    `<option value="${item.name} (${item.type})" 
                             data-inventory-id="${item.id}"
                             class="${stockClass}"
                             ${disabledAttr}>
                             ${item.name} (${item.type})${stockText}
                    </option>`
                );
            });
        }

        // Function for Customer Detail Display (Event Handler)
        function handleCustomerSelection() {
            // Listen for changes in the customer dropdown
            $('#customer-dropdown').off('change').on('change', function() {
                const selectedOption = $(this).find('option:selected');
                
                // Get details from data attributes of the selected option
                const name = selectedOption.data('name');
                const contact = selectedOption.data('contact');
                const address = selectedOption.data('address');
                const dateRegistered = selectedOption.data('datereg');

                if (name) {
                    // Update the display labels with the customer's details
                    $('#display-customer-name').text(name);
                    $('#display-customer-contact').text(contact);
                    $('#display-customer-address').text(address);
                    $('#display-customer-datereg').text(dateRegistered);
                } else {
                    // Reset to default if no customer is selected
                    $('#display-customer-name').text('N/A');
                    $('#display-customer-contact').text('N/A');
                    $('#display-customer-address').text('N/A');
                    $('#display-customer-datereg').text('N/A');
                }
            });
        }
        
        // Override the default order form submission to use the new fields
        function handleOrderFormSubmission(event) {
             event.preventDefault();
             
             // Get Customer Name from the selected option's data attribute
             const selectedCustomerOption = $('#customer-dropdown option:selected');
             const customerId = $('#customer-dropdown').val();
             const customerName = selectedCustomerOption.data('name') || 'Unregistered Customer';
             
             const selectedMachineId = $('#machine-dropdown').val();
             const selectedDetergentOption = $('#detergent-dropdown option:selected');
             const detergentName = selectedDetergentOption.val();
             const detergentInventoryId = selectedDetergentOption.data('inventory-id'); // Inventory ID for deduction

             const newOrder = {
                 // New Fields
                 customerName: customerName,
                 customerId: customerId,
                 machineId: selectedMachineId,
                 detergent: detergentName,
                 staffInCharge: $('#staff-dropdown option:selected').text(), // Get text for display
                 
                 // Existing Fields (Renamed/Adjusted as needed)
                 serviceType: $('#service-type').val(),
                 weightKg: parseFloat($('#weight-kg').val()),
                 baseCost: parseFloat($('#base-cost').val()),
                 totalPrice: parseFloat($('#total-price').val()),
                 
                 pickupDate: $('#pickup-date').val(),
                 pickupTime: $('#pickup-time').val(),
                 notes: $('#notes').val(),
                 
                 // Default Statuses
                 status: 'Pending',
                 paymentStatus: 'Unpaid',
                 dateCreated: new Date().toISOString().substring(0, 10)
             };
             
             const orderId = saveOrder(newOrder);

             // --- NEW LOGIC FOR AUTOMATIC UPDATES ---
             if (selectedMachineId) {
                // 1. Set Machine Status to 'in-use'
                updateMachineStatus(selectedMachineId, 'in-use');
             }

             if (detergentInventoryId && detergentInventoryId !== 'N/A') {
                // 2. Deduct 1 unit from Inventory
                deductInventory(detergentInventoryId);
             }
             // --- END NEW LOGIC ---

             // Reset form
             $('#order-form')[0].reset();
             // Manually reset dynamically displayed customer details
             $('#display-customer-name').text('N/A');
             $('#display-customer-contact').text('N/A');
             $('#display-customer-address').text('N/A');
             $('#display-customer-datereg').text('N/A');
             
             // Switch to order list tab after submission
             bootstrap.Tab.getOrCreateInstance(document.getElementById('order-list-sub-tab')).show();
        }

        // --- END: NEW JAVASCRIPT LOGIC FOR ORDER TAB ---


        function main() {
            // 1. Initial Load from Local Storage
            loadDataLocally();
            
            // 2. Determine Storage Mode
            const savedStorageMode = localStorage.getItem('storageMode');
            if (!savedStorageMode) {
                // Show sync modal on first load
                const syncModal = new bootstrap.Modal(document.getElementById('cloudSyncModal'));
                syncModal.show();
                
                $('#sync-local-btn').on('click', function() {
                    localStorage.setItem('storageMode', 'local');
                    storageMode = 'local';
                    $('#banner-storage-mode').text('Local Storage (Browser)');
                    $('#banner-storage-mode-hidden').text('Local Storage (Browser)');
                    syncModal.hide();
                    // Proceed with rendering and event binding after setting mode
                    initializeDashboardAndEvents();
                });
                
                $('#sync-google-btn').on('click', function() {
                    // MOCK: This would trigger Firebase sign-in
                    showToast('Cloud Sync is a premium feature, starting locally...', 'warning');
                    localStorage.setItem('storageMode', 'local');
                    storageMode = 'local';
                    $('#banner-storage-mode').text('Local Storage (Browser)');
                    $('#banner-storage-mode-hidden').text('Local Storage (Browser)');
                    syncModal.hide();
                    // Proceed with rendering and event binding after setting mode
                    initializeDashboardAndEvents();
                });
            } else {
                // Already set, proceed directly
                storageMode = savedStorageMode;
                $('#banner-storage-mode').text(storageMode === 'local' ? 'Local Storage (Browser)' : 'Cloud Sync (Google)');
                $('#banner-storage-mode-hidden').text(storageMode === 'local' ? 'Local Storage (Browser)' : 'Cloud Sync (Google)');
                initializeDashboardAndEvents();
            }
        }
        
        function initializeDashboardAndEvents() {
            // 3. Initial Renderings
            renderSummaryStats();
            renderOrderList();
            renderInventoryList();
            renderLowStockAlert();
            renderMachineGrid();
            renderWorkforceList();
            renderCustomerList();
            
            // 4. Attach Event Listeners
            
            // Report Date Filter Handlers
            $('#report-filter-form').on('submit', function(e) {
                e.preventDefault();
                const startDateStr = $('#filter-start-date').val();
                const endDateStr = $('#filter-end-date').val();
                
                if (!startDateStr || !endDateStr) {
                    showToast('Please select both Start and End Dates.', 'danger');
                    return;
                }

                // Parse dates and adjust for comparison (end date to end of day)
                const startDate = new Date(startDateStr);
                // Set endDate to 23:59:59 to include orders on that day
                const endDate = new Date(endDateStr);
                endDate.setHours(23, 59, 59, 999); 
                
                if (startDate > endDate) {
                    showToast('Start Date cannot be after End Date.', 'danger');
                    return;
                }

                // Filter the orders
                const filteredOrders = ORDERS.filter(order => {
                    const orderDate = new Date(order.dateCreated);
                    // order.dateCreated is stored as 'YYYY-MM-DD', so orderDate is 00:00:00 UTC
                    // The comparison works because orderDate is effectively at the start of the day
                    return orderDate >= startDate && orderDate <= endDate;
                });
                
                renderSummaryStats(filteredOrders);
                showToast(`Reports filtered from ${startDateStr} to ${endDateStr}. (${filteredOrders.length} orders)`, 'info');
            });
            
            $('#clear-report-filter-btn').on('click', function() {
                $('#report-filter-form')[0].reset();
                renderSummaryStats(ORDERS); // Re-render with all orders
                showToast('Date filter cleared. Showing all-time data.', 'info');
            });

            // New Order Tab Dropdowns and Submission
            populateOrderDropdowns(); // Re-populate with fresh data including newly registered customers
            handleCustomerSelection();
            $('#order-form').off('submit').on('submit', handleOrderFormSubmission);
            
            // Order List Pagination
            $('#prev-page-btn').on('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    renderOrderList();
                }
            });

            $('#next-page-btn').on('click', function() {
                const totalPages = Math.ceil(ORDERS.length / PAGE_SIZE);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderOrderList();
                }
            });

            // Order List Item Click (Re-attached in renderOrderList, but for initial load too)
            $('.order-list-item').on('click', handleOrderView);

            // New Order Shortcut Button
            $('#add-new-order-btn').on('click', function() {
                bootstrap.Tab.getOrCreateInstance(document.getElementById('new-order-sub-tab')).show();
            });

            // Order Update/Delete Handlers (Modal)
            $('#modal-order-update-form').on('submit', function(e) {
                e.preventDefault();
                const id = $('#modal-order-hidden-id').val();
                const order = ORDERS.find(o => o.id === id);
                if (order) {
                    order.status = $('#modal-update-status').val();
                    order.paymentStatus = $('#modal-update-payment').val();
                    
                    // If status changes from 'Completed'/'Cancelled' to anything else (or vice-versa), 
                    // we should update machine status and refresh order dropdowns. 
                    // Simple logic here: if status is changed, update machine status to 'available' if 'Completed'
                    if (order.status === 'Completed' || order.status === 'Cancelled') {
                        // Free up machine if it exists
                        updateMachineStatus(order.machineId, 'available');
                    } else if (order.status !== 'Pending' && order.status !== 'Ready for Pickup') {
                        // Assume machine goes into use if status is Washing/Drying/Folding
                        updateMachineStatus(order.machineId, 'in-use');
                    }
                    
                    saveOrder(order);
                    $('#orderDetailModal').modal('hide');
                    showToast(`Order ${id} updated to ${order.status}.`, 'info');
                }
            });

            $('#delete-order-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                    const order = ORDERS.find(o => o.id === $(this).data('id'));
                    if (order && order.machineId) {
                         // Free up machine if it exists
                        updateMachineStatus(order.machineId, 'available');
                    }
                    deleteOrderData(order.id);
                    $('#orderDetailModal').modal('hide');
                 }
            });

            // Inventory Form Submission
            $('#detergent-form').on('submit', function(e) {
                e.preventDefault();
                const newItem = {
                    name: $('#detergent-name').val().trim(),
                    type: $('#detergent-type').val(),
                    quantity: $('#detergent-qty').val(),
                    costPerUnit: $('#detergent-cost').val(),
                    vendor: $('#detergent-vendor').val().trim()
                };
                saveInventoryItem(newItem);
                $('#detergent-form')[0].reset();
                $('#detergent-qty').val('1'); // Reset quantity default
                $('#detergent-cost').val('0.00'); // Reset cost default
                
                // Switch to view tab
                bootstrap.Tab.getOrCreateInstance(document.getElementById('inventory-view-tab')).show();
            });
            
            // Inventory Filter/Clear
            $('#inventory-filter-form').on('submit', function(e) { e.preventDefault(); renderInventoryList(); });
            $('#clear-inventory-filter-btn').on('click', function() { 
                $('#inventory-filter-form')[0].reset();
                renderInventoryList();
            });
            
            // Inventory Update/Delete Handlers (Modal)
            $('#modal-inventory-update-form').on('submit', function(e) {
                e.preventDefault();
                const id = $('#modal-inventory-id').val();
                const updates = {
                    quantity: parseFloat($('#modal-inventory-qty').val()),
                    costPerUnit: parseFloat($('#modal-inventory-cost').val()),
                    vendor: $('#modal-inventory-vendor').val().trim()
                };
                updateInventoryItem(id, updates);
                $('#inventoryDetailModal').modal('hide');
            });
            
            $('#delete-inventory-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this inventory item?')) {
                    const itemId = $(this).data('id');
                    deleteInventoryItem(itemId);
                    $('#inventoryDetailModal').modal('hide');
                 }
            });

            // Machine Form Submission
            $('#machine-form').on('submit', function(e) {
                e.preventDefault();
                const newMachine = {
                    name: $('#machine-name').val().trim(),
                    type: $('#machine-type').val(),
                    capacity: parseFloat($('#machine-capacity').val()),
                    purchaseDate: $('#machine-purchase-date').val(),
                    notes: $('#machine-notes').val().trim(),
                    status: $('#machine-under-maintenance').prop('checked') ? 'maintenance' : 'available'
                };
                saveMachine(newMachine);
                $('#machine-form')[0].reset();
                $('#machine-capacity').val('10.0');
                
                // Switch to view tab
                bootstrap.Tab.getOrCreateInstance(document.getElementById('machines-view-tab')).show();
            });

            // Machine Update/Delete Handlers (Modal)
            $('#modal-machine-update-form').on('submit', function(e) {
                e.preventDefault();
                const id = $('#modal-machine-id').val();
                const updates = {
                    status: $('#modal-machine-status').val(),
                    capacity: parseFloat($('#modal-machine-capacity').val()),
                    notes: $('#modal-machine-notes').val().trim()
                };
                saveMachine({ id: id, ...MACHINES.find(m => m.id === id), ...updates });
                $('#machineDetailModal').modal('hide');
            });
            
            $('#delete-machine-btn').on('click', function() {
                 if (confirm('Are you sure you want to remove this machine record?')) {
                    const machineId = $(this).data('id');
                    deleteMachineData(machineId);
                    $('#machineDetailModal').modal('hide');
                 }
            });
            
            // Workforce Form Submission
            $('#workforce-form').on('submit', function(e) {
                e.preventDefault();
                const newEmployee = {
                    name: $('#employee-name').val().trim(),
                    type: $('#employee-type').val(),
                    baseSalary: parseFloat($('#employee-salary').val()),
                    rateType: $('#employee-rate-type').val()
                };
                saveEmployee(newEmployee);
                $('#workforce-form')[0].reset();
                $('#employee-salary').val('0.00');
            });
            
            // Employee Update/Delete Handlers (Modal)
            $('#modal-employee-update-form').on('submit', function(e) {
                e.preventDefault();
                const id = $('#modal-employee-id').val();
                const employee = WORKFORCE.find(e => e.id === id);
                if (employee) {
                    employee.type = $('#modal-employee-type').val();
                    employee.baseSalary = parseFloat($('#modal-employee-salary').val());
                    saveEmployee(employee);
                    $('#employeeDetailModal').modal('hide');
                }
            });
            
            $('#delete-employee-btn').on('click', function() {
                 if (confirm('Are you sure you want to remove this employee record?')) {
                    const employeeId = $(this).data('id');
                    deleteEmployeeData(employeeId);
                    $('#employeeDetailModal').modal('hide');
                 }
            });
            
            // Customer Form Submission
            $('#customer-form').on('submit', function(e) {
                e.preventDefault();
                const newCustomer = {
                    name: $('#customer-reg-name').val().trim(),
                    contact: $('#customer-reg-contact').val().trim(),
                    age: $('#customer-reg-age').val(),
                    address: $('#customer-reg-address').val().trim()
                };
                saveCustomer(newCustomer);
                $('#customer-form')[0].reset();
                
                // Switch to view tab
                bootstrap.Tab.getOrCreateInstance(document.getElementById('customer-view-tab')).show();
            });
            
            // Customer Update/Delete Handlers (Modal)
            $('#modal-customer-update-form').on('submit', function(e) {
                e.preventDefault();
                const id = $('#modal-customer-id').val();
                const updates = {
                    contact: $('#modal-customer-contact').val().trim(),
                    address: $('#modal-customer-address').val().trim()
                };
                updateCustomerData(id, updates);
                $('#customerDetailModal').modal('hide');
            });
            
            $('#delete-customer-btn').on('click', function() {
                 if (confirm('Are you sure you want to delete this customer record?')) {
                    const customerId = $('#modal-customer-id').val();
                    deleteCustomerData(customerId);
                    $('#customerDetailModal').modal('hide');
                 }
            });

            // ID Card Generation Logic
            $('#id-customer-select').on('change', function() {
                const customerId = $(this).val();
                if (customerId) {
                    $('#generate-id-btn').prop('disabled', false).text('Generate/Preview ID');
                } else {
                    $('#generate-id-btn').prop('disabled', true).text('Generate/Preview ID');
                }
            });
            
            $('#generate-id-btn').on('click', function() {
                const customerId = $('#id-customer-select').val();
                const customer = CUSTOMERS.find(c => c.id === customerId);
                
                if (customer) {
                    $('#id-display-name').text(customer.name);
                    $('#id-display-contact').text(customer.contact || 'N/A');
                    $('#id-display-address').text(customer.address || 'N/A');
                    $('#id-display-datereg').text(customer.dateRegistered || 'N/A');
                    $('#id-display-id').text(customer.id);
                    
                    $('#id-card-preview').removeClass('d-none');
                    $('#id-card-print-area').removeClass('d-none');
                } else {
                    $('#id-card-preview').addClass('d-none');
                    $('#id-card-print-area').addClass('d-none');
                    showToast('Please select a valid customer.', 'danger');
                }
            });
            
            // Log Out Button
            $('#home-log-out-btn').on('click', function() {
                if (confirm('Are you sure you want to log out? This will clear local data unless you use Cloud Sync.')) {
                    // Reset storage mode preference and clear local data
                    localStorage.removeItem('storageMode');
                    localStorage.removeItem('hasSeenSyncModal');
                    // Reloads the page to restart the sync flow
                    location.reload(); 
                }
            });
            
            // Mobile Menu Uncollapse Logic 
            $('.navbar-nav a.nav-link').on('click', function () {
                const navbarCollapse = $('#navbarNav');
                // Use Bootstrap's native collapse method on the navbarCollapse element
                if (navbarCollapse.hasClass('show')) {
                    navbarCollapse.collapse('hide');
                }
            });


        };

        // Initialize the application once the document is fully loaded
        $(document).ready(main);

    </script>
</body>
</html>