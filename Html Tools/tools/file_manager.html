<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Cloud Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        #console {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
        }
        table input {
            width: 100%;
            border: none;
            padding: 5px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>CSV Cloud Manager</h2>
        <input type="file" id="file-input" class="form-control mb-3">
        <button id="upload-btn" class="btn btn-primary mb-3">Upload CSV to Cloud</button>
        <button id="load-btn" class="btn btn-secondary mb-3">Load CSV from Cloud</button>
        <button id="save-btn" class="btn btn-success mb-3">Save Changes to Cloud</button>

        <div id="csv-table" class="table-responsive"></div>
        <div id="console"></div>
    </div>

    <script>
        $(document).ready(function() {
            // Puter cloud file path
            const cloudFolder = 'my-csv-files';
            const cloudFile = `${cloudFolder}/data.csv`;

            // Initialize Puter
            puter.init();

            // Redirect puter.print to console div
            puter.print = function(msg) {
                $('#console').append(msg + '<br>');
                $('#console').scrollTop($('#console')[0].scrollHeight);
            };

            // Upload CSV file to Puter cloud
            $('#upload-btn').click(async function() {
                const fileInput = document.getElementById('file-input');
                if (!fileInput.files.length) {
                    alert('Please select a CSV file first.');
                    return;
                }
                const file = fileInput.files[0];
                try {
                    await puter.fs.write(cloudFile, await file.text());
                    puter.print(`"${file.name}" uploaded to cloud as "${cloudFile}"`);
                } catch (error) {
                    puter.print('Error uploading CSV: ' + error.message);
                }
            });

            // Load CSV from Puter cloud
            $('#load-btn').click(async function() {
                try {
                    const file = await puter.fs.read(cloudFile);
                    const text = await file.text();
                    const rows = text.split('\n').map(r => r.split(','));

                    let table = '<table class="table table-bordered table-sm"><thead><tr>';
                    rows[0].forEach(col => table += `<th>${col}</th>`);
                    table += '</tr></thead><tbody>';

                    rows.slice(1).forEach((row, rowIndex) => {
                        table += '<tr>';
                        row.forEach((cell, colIndex) => {
                            table += `<td><input type="text" value="${cell}" data-row="${rowIndex}" data-col="${colIndex}"></td>`;
                        });
                        table += '</tr>';
                    });

                    table += '</tbody></table>';
                    $('#csv-table').html(table);
                    puter.print(`CSV loaded from cloud: "${cloudFile}"`);
                } catch (error) {
                    puter.print('Error loading CSV: ' + error.message);
                }
            });

            // Save changes back to Puter cloud
            $('#save-btn').click(async function() {
                try {
                    const rows = [];
                    $('#csv-table table tbody tr').each(function() {
                        const row = [];
                        $(this).find('td input').each(function() {
                            row.push($(this).val());
                        });
                        rows.push(row.join(','));
                    });
                    const csvContent = rows.join('\n');
                    await puter.fs.write(cloudFile, csvContent);
                    puter.print(`CSV saved to cloud: "${cloudFile}"`);
                } catch (error) {
                    puter.print('Error saving CSV: ' + error.message);
                }
            });
        });
    </script>
</body>
</html>

