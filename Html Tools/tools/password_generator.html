<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Password Generator</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"/>
<style>
body { padding: 1.5rem; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #f7fafc; }
.pw-box { font-family: "Courier New", Courier, monospace; font-size: 1.1rem; letter-spacing: .06rem; }
.strength-bar { height: 8px; border-radius: 4px; background: #e9ecef; overflow: hidden; }
.strength-fill { height: 100%; transition: width .25s ease; background: #c6f6d5; }
.small-muted { font-size: .85rem; color:#6c757d; }
</style>
</head>
<body>
<div class="container">
  <h3 class="mb-3">Password Generator</h3>

  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Generated Password</label>
            <div class="input-group">
              <input id="passwordOutput" class="form-control pw-box" readonly aria-label="Generated password">
              <button id="toggleShow" class="btn btn-outline-secondary" title="Show/Hide"><i class="bi bi-eye"></i> Show</button>
              <button id="copyBtn" class="btn btn-primary">Copy</button>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-2">
              <div class="small-muted">Entropy: <span id="entropy">0</span> bits • Strength: <strong id="strengthLabel">—</strong></div>
              <div style="width:45%;">
                <div class="strength-bar">
                  <div id="strengthFill" class="strength-fill" style="width:0%"></div>
                </div>
              </div>
            </div>
          </div>

          <hr/>

          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label">Length: <span id="lenDisplay">16</span></label>
              <input type="range" id="lengthRange" min="4" max="128" value="16" class="form-range">
              <input type="number" id="lengthNumber" min="4" max="128" value="16" class="form-control mt-2">
            </div>

            <div class="col-md-6">
              <label class="form-label">Options</label>
              <div class="row">
                <div class="col-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="chLower" checked><label class="form-check-label" for="chLower">Lowercase</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="chUpper" checked><label class="form-check-label" for="chUpper">Uppercase</label></div>
                </div>
                <div class="col-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="chNumbers" checked><label class="form-check-label" for="chNumbers">Numbers</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="chSymbols"><label class="form-check-label" for="chSymbols">Symbols</label></div>
                </div>
              </div>
              <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" id="chExcludeAmbiguous">
                <label class="form-check-label" for="chExcludeAmbiguous">Exclude ambiguous characters (O,0,l,1,I)</label>
              </div>
              <div class="form-check mt-1">
                <input class="form-check-input" type="checkbox" id="chEnforce">
                <label class="form-check-label" for="chEnforce">Enforce at least one character from each selected type</label>
              </div>
              <div class="form-check mt-1">
                <input class="form-check-input" type="checkbox" id="chPronounceable">
                <label class="form-check-label" for="chPronounceable">Pronounceable password (syllables)</label>
              </div>
              <div class="form-check mt-1">
                <input class="form-check-input" type="checkbox" id="chIdeaOnly">
                <label class="form-check-label" for="chIdeaOnly">Use idea only (do not mix with random characters)</label>
              </div>
              <div class="form-check mt-1">
                <input class="form-check-input" type="checkbox" id="chCustomBlacklist">
                <label class="form-check-label" for="chCustomBlacklist">Use custom blacklist</label>
              </div>
              <input id="customBlacklist" class="form-control mt-1" placeholder="Characters to exclude" disabled>
            </div>

            <div class="col-12">
              <label class="form-label">Idea / Seed (optional)</label>
              <input id="ideaInput" class="form-control" placeholder="A word or phrase to incorporate (e.g. ProjectX)">
              <div class="small-muted mt-1">If present, filtered characters from your idea will be injected or used as a seed.</div>
            </div>
          </div>

          <div class="mt-3 d-flex gap-2">
            <button id="generateBtn" class="btn btn-success">Generate</button>
            <button id="generateBtn2" class="btn btn-outline-success">Generate ×5</button>
            <button id="saveCsv" class="btn btn-outline-secondary ms-auto">Export history CSV</button>
          </div>

          <div class="mt-3">
            <strong>History</strong>
            <div id="historyBox" class="small-muted mt-2" style="max-height:160px; overflow:auto; background:#fff; border:1px solid #e9ecef; padding:.5rem;"></div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function($){
  const LOWER="abcdefghijklmnopqrstuvwxyz";
  const UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const DIGITS="0123456789";
  const SYMBOLS="!@#$%^&*()-_=+[]{};:,.<>/?|~";
  const AMBIGUOUS="O0oIl1";

  function filterExcludeAmbiguous(s){ return s.split('').filter(c=>!AMBIGUOUS.includes(c)).join(''); }
  function secureRandomInt(max){ const array=new Uint32Array(1); window.crypto.getRandomValues(array); return array[0]%max; }

  function buildPool(opts){
    let pool="";
    if(opts.lower) pool+=LOWER;
    if(opts.upper) pool+=UPPER;
    if(opts.numbers) pool+=DIGITS;
    if(opts.symbols) pool+=SYMBOLS;
    if(opts.excludeAmbiguous) pool=filterExcludeAmbiguous(pool);
    if(opts.customBlacklist) pool=pool.split('').filter(c=>!opts.customBlacklist.includes(c)).join('');
    pool=Array.from(new Set(pool.split(''))).join('');
    return pool;
  }

  function pickRandomChars(pool,n){ const out=[]; for(let i=0;i<n;i++) out.push(pool[secureRandomInt(pool.length)]); return out; }

  function injectIdeaChars(pwArr, ideaChars){
    if(!ideaChars||ideaChars.length===0) return pwArr;
    let N=pwArr.length;
    let count=Math.min(ideaChars.length,N);
    const shuffledIdea=ideaChars.slice();
    for(let i=shuffledIdea.length-1;i>0;i--){
      const j=secureRandomInt(i+1); [shuffledIdea[i],shuffledIdea[j]]=[shuffledIdea[j],shuffledIdea[i]];
    }
    const positions=new Set();
    while(positions.size<count) positions.add(secureRandomInt(N));
    const posArr=Array.from(positions);
    for(let i=0;i<posArr.length;i++) pwArr[posArr[i]]=shuffledIdea[i];
    return pwArr;
  }

  function estimateEntropy(poolSize,length){ if(poolSize<=0||length<=0) return 0; return +(length*Math.log2(poolSize)).toFixed(2); }
  function strengthLabel(bits){ if(bits<28)return 'Very weak'; if(bits<36)return 'Weak'; if(bits<60)return 'Reasonable'; if(bits<128)return 'Strong'; return 'Very strong'; }

  function generatePassword(length,opts,idea){
    let pool=buildPool(opts);
    if(pool.length===0) return {error:'Character pool empty — select at least one class.'};
    let pwArr=[];

    if(opts.pronounceable){
      const vowels='aeiou';
      const consonants='bcdfghjklmnpqrstvwxyz';
      for(let i=0;i<length;i++){
        pwArr.push(i%2===0?consonants[secureRandomInt(consonants.length)]:vowels[secureRandomInt(vowels.length)]);
      }
    } else if(opts.ideaOnly && idea){
      const candidatePool=opts.excludeAmbiguous?filterExcludeAmbiguous(idea):idea;
      const filtered=Array.from(candidatePool);
      while(pwArr.length<length) pwArr= pwArr.concat(filtered);
      pwArr=pwArr.slice(0,length);
    } else {
      const requiredChars=[];
      if(opts.enforce){
        if(opts.lower) requiredChars.push(opts.excludeAmbiguous?filterExcludeAmbiguous(LOWER):LOWER);
        if(opts.upper) requiredChars.push(opts.excludeAmbiguous?filterExcludeAmbiguous(UPPER):UPPER);
        if(opts.numbers) requiredChars.push(opts.excludeAmbiguous?filterExcludeAmbiguous(DIGITS):DIGITS);
        if(opts.symbols) requiredChars.push(opts.excludeAmbiguous?filterExcludeAmbiguous(SYMBOLS):SYMBOLS);
      }
      const reqChosen=[];
      requiredChars.forEach(set=>{ if(set.length>0) reqChosen.push(set[secureRandomInt(set.length)]); });
      const remain=Math.max(0,length-reqChosen.length);
      pwArr=pickRandomChars(pool,remain);
      pwArr=pwArr.concat(reqChosen);

      for(let i=pwArr.length-1;i>0;i--){ const j=secureRandomInt(i+1); [pwArr[i],pwArr[j]]=[pwArr[j],pwArr[i]]; }

      if(idea && idea.trim().length>0){
        const candidatePool=opts.excludeAmbiguous?filterExcludeAmbiguous(pool):pool;
        const filtered=Array.from(idea).filter(ch=>candidatePool.includes(ch));
        if(filtered.length>0) pwArr=injectIdeaChars(pwArr,filtered);
      }
      if(pwArr.length>length) pwArr=pwArr.slice(0,length);
    }

    return {password:pwArr.join(''), poolSize:pool.length};
  }

  $(function(){
    const $lenRange=$('#lengthRange'), $lenNumber=$('#lengthNumber'), $lenDisplay=$('#lenDisplay');
    const $generate=$('#generateBtn'), $generate5=$('#generateBtn2'), $copyBtn=$('#copyBtn');
    const $pwOut=$('#passwordOutput'), $toggleShow=$('#toggleShow');
    const $entropy=$('#entropy'), $strengthLabel=$('#strengthLabel'), $strengthFill=$('#strengthFill');
    const $history=$('#historyBox');
    const historyArr=[];

    function readOptions(){
      return {
        lower: $('#chLower').is(':checked'),
        upper: $('#chUpper').is(':checked'),
        numbers: $('#chNumbers').is(':checked'),
        symbols: $('#chSymbols').is(':checked'),
        excludeAmbiguous: $('#chExcludeAmbiguous').is(':checked'),
        enforce: $('#chEnforce').is(':checked'),
        pronounceable: $('#chPronounceable').is(':checked'),
        ideaOnly: $('#chIdeaOnly').is(':checked'),
        customBlacklist: $('#chCustomBlacklist').is(':checked') ? $('#customBlacklist').val() : ''
      };
    }

    function updateStrengthDisplay(poolSize,length){
      const bits=estimateEntropy(poolSize,length);
      $entropy.text(bits);
      const label=strengthLabel(bits);
      $strengthLabel.text(label);
      let color='#c6f6d5';
      if(bits<36) color='#fde68a';
      if(bits<28) color='#fca5a5';
      if(bits>=60) color='#86efac';
      $strengthFill.css('width',Math.min(100,Math.round(bits/200*100))+'%').css('background',color);
    }

    function setPasswordToUI(pw,poolSize,length){
      $pwOut.val(pw);
      updateStrengthDisplay(poolSize,length);
      historyArr.unshift({pw,ts:new Date().toLocaleString()});
      refreshHistory();
    }

    function refreshHistory(){
      $history.empty();
      historyArr.slice(0,50).forEach((h,i)=>{
        const $line=$('<div>').addClass('d-flex justify-content-between align-items-center py-1');
        $line.append($('<div>').text(h.pw).css({'font-family':'monospace','font-size':'.95rem'}));
        const $btns=$('<div>');
        const $copy=$('<button class="btn btn-sm btn-outline-secondary me-1">Copy</button>').on('click',()=>{navigator.clipboard.writeText(h.pw)});
        const $del=$('<button class="btn btn-sm btn-outline-danger">X</button>').on('click',()=>{historyArr.splice(i,1);refreshHistory();});
        $btns.append($copy).append($del);
        $line.append($btns);
        $history.append($line);
      });
    }

    $lenRange.on('input change',function(){ const v=+this.value; $lenNumber.val(v); $lenDisplay.text(v); });
    $lenNumber.on('change input',function(){ let v=parseInt(this.value,10)||16; if(v<this.min)v=this.min;if(v>this.max)v=this.max;$lenRange.val(v);$lenDisplay.text(v);this.value=v;});

    $generate.on('click',function(){
      const length=parseInt($lenNumber.val(),10);
      const opts=readOptions();
      const ideaRaw=$('#ideaInput').val()||'';
      const res=generatePassword(length,opts,ideaRaw);
      if(res.error){ alert(res.error); return; }
      setPasswordToUI(res.password,res.poolSize,length);
    });

    $generate5.on('click',function(){
      const length=parseInt($lenNumber.val(),10);
      const opts=readOptions();
      const ideaRaw=$('#ideaInput').val()||'';
      for(let i=0;i<5;i++){
        const res=generatePassword(length,opts,ideaRaw);
        if(res.error){ alert(res.error); return; }
        historyArr.unshift({pw:res.password,ts:new Date().toLocaleString()});
      }
      if(historyArr.length>0) setPasswordToUI(historyArr[0].pw,buildPool(opts).length,length);
      refreshHistory();
    });

    $copyBtn.on('click',function(){
      const val=$pwOut.val(); if(!val) return;
      navigator.clipboard.writeText(val).then(()=>{$copyBtn.text('Copied').prop('disabled',true);setTimeout(()=>{$copyBtn.text('Copy').prop('disabled',false)},1200);});
    });

    let shown=false;
    $toggleShow.on('click',function(){ shown=!shown; if(shown){$pwOut.attr('type','text');$(this).html('<i class="bi bi-eye-slash"></i> Hide');} else {$pwOut.attr('type','text');$(this).html('<i class="bi bi-eye"></i> Show');} });

    $('#chCustomBlacklist').on('change',function(){ $('#customBlacklist').prop('disabled',!this.checked); });

    $('#saveCsv').on('click',function(){
      if(historyArr.length===0) return alert('No history to save.');
      const rows=[['password','timestamp']].concat(historyArr.map(h=>[h.pw,h.ts]));
      const csv=rows.map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob=new Blob([csv],{type:'text/csv'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='password_history.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    $('#generateBtn').click();
  });
})(jQuery);
</script>
</body>
</html>

